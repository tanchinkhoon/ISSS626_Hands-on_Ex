<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="TAN Chin Khoon">
<meta name="dcterms.date" content="2025-10-23">

<title>Take-home Ex03 â€“ ISSS626</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ff63373b1067ca6f91cf1456aa1f00a2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ISSS626</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex09/Hand-on_Ex09">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex08/Hand-on_Ex08">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex07/Hand-on_Ex07">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex06/Hand-on_Ex06">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex05/Hand-on_Ex05b">
 <span class="dropdown-text">Hands-on Exercise 5b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex05/Hand-on_Ex05a">
 <span class="dropdown-text">Hands-on Exercise 5a</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex04/Hand-on_Ex04">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex03/Hand-on_Ex03">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex02/Hand-on_Ex02">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex01/Hand-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../In-Class_Ex09/in-class_ex09">
 <span class="dropdown-text">In-class Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex08/in-class_ex08">
 <span class="dropdown-text">In-class Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex07/in-class_ex07">
 <span class="dropdown-text">In-class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex06/in-class_ex06">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex05/in-class_ex05b">
 <span class="dropdown-text">In-class Exercise 5b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex05/in-class_ex05">
 <span class="dropdown-text">In-class Exercise 5a</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex04/in-class_ex04">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex03b/in-class_Ex03b">
 <span class="dropdown-text">In-class Exercise 3b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex03/in-class_Ex03a">
 <span class="dropdown-text">In-class Exercise 3a</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../Take-home_Ex02/take-home_ex02">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Take-home_Ex01/take-home_ex01">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tanchinkhoon/"> <i class="bi bi-linkedin" role="img" aria-label="Linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tanchinkhoon/ISSS626_Hands-on_Ex"> <i class="bi bi-github" role="img" aria-label="Github">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#research-questions" id="toc-research-questions" class="nav-link" data-scroll-target="#research-questions"><span class="header-section-number">2</span> Research Questions</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data"><span class="header-section-number">3</span> The Data</a></li>
  <li><a href="#setup-the-environment" id="toc-setup-the-environment" class="nav-link" data-scroll-target="#setup-the-environment"><span class="header-section-number">4</span> Setup the Environment</a></li>
  <li><a href="#geocoding-for-geometric" id="toc-geocoding-for-geometric" class="nav-link" data-scroll-target="#geocoding-for-geometric"><span class="header-section-number">5</span> Geocoding for Geometric</a>
  <ul>
  <li><a href="#geocoding-hdb-resale-transactions-by-addresses" id="toc-geocoding-hdb-resale-transactions-by-addresses" class="nav-link" data-scroll-target="#geocoding-hdb-resale-transactions-by-addresses"><span class="header-section-number">5.1</span> Geocoding HDB resale transactions by addresses</a>
  <ul class="collapse">
  <li><a href="#load-and-filter-to-study-window-and-flat-type" id="toc-load-and-filter-to-study-window-and-flat-type" class="nav-link" data-scroll-target="#load-and-filter-to-study-window-and-flat-type"><span class="header-section-number">5.1.1</span> Load and filter to study window and flat type</a></li>
  <li><a href="#normalise-street-tokens" id="toc-normalise-street-tokens" class="nav-link" data-scroll-target="#normalise-street-tokens"><span class="header-section-number">5.1.2</span> Normalise street tokens</a></li>
  <li><a href="#define-onemap-address-geocoder-with-caching" id="toc-define-onemap-address-geocoder-with-caching" class="nav-link" data-scroll-target="#define-onemap-address-geocoder-with-caching"><span class="header-section-number">5.1.3</span> Define OneMap address geocoder with caching</a></li>
  <li><a href="#enforce-one-record-per-address-and-join-coordinates" id="toc-enforce-one-record-per-address-and-join-coordinates" class="nav-link" data-scroll-target="#enforce-one-record-per-address-and-join-coordinates"><span class="header-section-number">5.1.4</span> Enforce one record per address and join coordinates</a></li>
  <li><a href="#create-point-geometry-and-validate" id="toc-create-point-geometry-and-validate" class="nav-link" data-scroll-target="#create-point-geometry-and-validate"><span class="header-section-number">5.1.5</span> Create POINT geometry and validate</a></li>
  </ul></li>
  <li><a href="#geocoding-schools-by-postcodes" id="toc-geocoding-schools-by-postcodes" class="nav-link" data-scroll-target="#geocoding-schools-by-postcodes"><span class="header-section-number">5.2</span> Geocoding schools by postcodes</a>
  <ul class="collapse">
  <li><a href="#load-and-keep-primary-level" id="toc-load-and-keep-primary-level" class="nav-link" data-scroll-target="#load-and-keep-primary-level"><span class="header-section-number">5.2.1</span> Load and keep primary level</a></li>
  <li><a href="#onemap-postcode-lookup-and-clean" id="toc-onemap-postcode-lookup-and-clean" class="nav-link" data-scroll-target="#onemap-postcode-lookup-and-clean"><span class="header-section-number">5.2.2</span> OneMap postcode lookup and clean</a></li>
  <li><a href="#join-coordinates-and-build-point-geometry" id="toc-join-coordinates-and-build-point-geometry" class="nav-link" data-scroll-target="#join-coordinates-and-build-point-geometry"><span class="header-section-number">5.2.3</span> Join coordinates and build POINT geometry</a></li>
  </ul></li>
  <li><a href="#persist-clean-spatial-tables" id="toc-persist-clean-spatial-tables" class="nav-link" data-scroll-target="#persist-clean-spatial-tables"><span class="header-section-number">5.3</span> Persist clean spatial tables</a></li>
  </ul></li>
  <li><a href="#predictors-preprocessing-and-wrangling" id="toc-predictors-preprocessing-and-wrangling" class="nav-link" data-scroll-target="#predictors-preprocessing-and-wrangling"><span class="header-section-number">6</span> Predictors Preprocessing and Wrangling</a>
  <ul>
  <li><a href="#structural-predictors" id="toc-structural-predictors" class="nav-link" data-scroll-target="#structural-predictors"><span class="header-section-number">6.1</span> Structural predictors</a>
  <ul class="collapse">
  <li><a href="#remaining-lease-in-months" id="toc-remaining-lease-in-months" class="nav-link" data-scroll-target="#remaining-lease-in-months"><span class="header-section-number">6.1.1</span> Remaining lease in months</a></li>
  <li><a href="#floor-level-from-storey-range" id="toc-floor-level-from-storey-range" class="nav-link" data-scroll-target="#floor-level-from-storey-range"><span class="header-section-number">6.1.2</span> Floor level from storey range</a></li>
  <li><a href="#age-of-the-unit-in-years" id="toc-age-of-the-unit-in-years" class="nav-link" data-scroll-target="#age-of-the-unit-in-years"><span class="header-section-number">6.1.3</span> Age of the unit in years</a></li>
  <li><a href="#structural-predictors-ready" id="toc-structural-predictors-ready" class="nav-link" data-scroll-target="#structural-predictors-ready"><span class="header-section-number">6.1.4</span> Structural predictors ready</a></li>
  </ul></li>
  <li><a href="#preparing-target-layers-for-location-factors" id="toc-preparing-target-layers-for-location-factors" class="nav-link" data-scroll-target="#preparing-target-layers-for-location-factors"><span class="header-section-number">6.2</span> Preparing target layers for location factors</a>
  <ul class="collapse">
  <li><a href="#function-and-global-checks" id="toc-function-and-global-checks" class="nav-link" data-scroll-target="#function-and-global-checks"><span class="header-section-number">6.2.1</span> Function and global checks</a></li>
  <li><a href="#mrt-station-exits-from-geojson" id="toc-mrt-station-exits-from-geojson" class="nav-link" data-scroll-target="#mrt-station-exits-from-geojson"><span class="header-section-number">6.2.2</span> MRT station exits from GeoJSON</a></li>
  <li><a href="#primary-schools-and-elite-subset" id="toc-primary-schools-and-elite-subset" class="nav-link" data-scroll-target="#primary-schools-and-elite-subset"><span class="header-section-number">6.2.3</span> Primary schools and elite subset</a></li>
  <li><a href="#kindergartens-geojson" id="toc-kindergartens-geojson" class="nav-link" data-scroll-target="#kindergartens-geojson"><span class="header-section-number">6.2.4</span> Kindergartens GeoJSON</a></li>
  <li><a href="#childcare-centres-geojson" id="toc-childcare-centres-geojson" class="nav-link" data-scroll-target="#childcare-centres-geojson"><span class="header-section-number">6.2.5</span> Childcare centres GeoJSON</a></li>
  <li><a href="#bus-stops-shapefile" id="toc-bus-stops-shapefile" class="nav-link" data-scroll-target="#bus-stops-shapefile"><span class="header-section-number">6.2.6</span> Bus stops Shapefile</a></li>
  <li><a href="#eldercare-geojson" id="toc-eldercare-geojson" class="nav-link" data-scroll-target="#eldercare-geojson"><span class="header-section-number">6.2.7</span> Eldercare GeoJSON</a></li>
  <li><a href="#hawker-centres-geojson" id="toc-hawker-centres-geojson" class="nav-link" data-scroll-target="#hawker-centres-geojson"><span class="header-section-number">6.2.8</span> Hawker centres GeoJSON</a></li>
  <li><a href="#parks-geojson" id="toc-parks-geojson" class="nav-link" data-scroll-target="#parks-geojson"><span class="header-section-number">6.2.9</span> Parks GeoJSON</a></li>
  <li><a href="#shopping-malls-csv" id="toc-shopping-malls-csv" class="nav-link" data-scroll-target="#shopping-malls-csv"><span class="header-section-number">6.2.10</span> Shopping malls CSV</a></li>
  <li><a href="#supermarkets-geojson" id="toc-supermarkets-geojson" class="nav-link" data-scroll-target="#supermarkets-geojson"><span class="header-section-number">6.2.11</span> Supermarkets GeoJSON</a></li>
  <li><a href="#cbd-point-from-master-plan-subzones" id="toc-cbd-point-from-master-plan-subzones" class="nav-link" data-scroll-target="#cbd-point-from-master-plan-subzones"><span class="header-section-number">6.2.12</span> CBD point from Master Plan subzones</a></li>
  <li><a href="#save-prepared-layers-for-repeatable-use" id="toc-save-prepared-layers-for-repeatable-use" class="nav-link" data-scroll-target="#save-prepared-layers-for-repeatable-use"><span class="header-section-number">6.2.13</span> Save prepared layers for repeatable use</a></li>
  </ul></li>
  <li><a href="#location-predictors" id="toc-location-predictors" class="nav-link" data-scroll-target="#location-predictors"><span class="header-section-number">6.3</span> Location predictors</a>
  <ul class="collapse">
  <li><a href="#helpers-used-by-all-location-predictors" id="toc-helpers-used-by-all-location-predictors" class="nav-link" data-scroll-target="#helpers-used-by-all-location-predictors"><span class="header-section-number">6.3.1</span> Helpers used by all location predictors</a></li>
  <li><a href="#proximity-to-mrt-stations" id="toc-proximity-to-mrt-stations" class="nav-link" data-scroll-target="#proximity-to-mrt-stations"><span class="header-section-number">6.3.2</span> Proximity to MRT stations</a></li>
  <li><a href="#proximity-to-parks" id="toc-proximity-to-parks" class="nav-link" data-scroll-target="#proximity-to-parks"><span class="header-section-number">6.3.3</span> Proximity to parks</a></li>
  <li><a href="#proximity-to-eldercare-services" id="toc-proximity-to-eldercare-services" class="nav-link" data-scroll-target="#proximity-to-eldercare-services"><span class="header-section-number">6.3.4</span> Proximity to eldercare services</a></li>
  <li><a href="#proximity-to-hawker-centres" id="toc-proximity-to-hawker-centres" class="nav-link" data-scroll-target="#proximity-to-hawker-centres"><span class="header-section-number">6.3.5</span> Proximity to hawker centres</a></li>
  <li><a href="#proximity-to-supermarkets" id="toc-proximity-to-supermarkets" class="nav-link" data-scroll-target="#proximity-to-supermarkets"><span class="header-section-number">6.3.6</span> Proximity to supermarkets</a></li>
  <li><a href="#proximity-to-shopping-malls" id="toc-proximity-to-shopping-malls" class="nav-link" data-scroll-target="#proximity-to-shopping-malls"><span class="header-section-number">6.3.7</span> Proximity to shopping malls</a></li>
  <li><a href="#proximity-to-the-cbd-reference-point" id="toc-proximity-to-the-cbd-reference-point" class="nav-link" data-scroll-target="#proximity-to-the-cbd-reference-point"><span class="header-section-number">6.3.8</span> Proximity to the CBD reference point</a></li>
  <li><a href="#proximity-to-elite-primary-schools" id="toc-proximity-to-elite-primary-schools" class="nav-link" data-scroll-target="#proximity-to-elite-primary-schools"><span class="header-section-number">6.3.9</span> Proximity to elite primary schools</a></li>
  <li><a href="#amenity-counts-within-three-hundred-and-fifty-metres" id="toc-amenity-counts-within-three-hundred-and-fifty-metres" class="nav-link" data-scroll-target="#amenity-counts-within-three-hundred-and-fifty-metres"><span class="header-section-number">6.3.10</span> Amenity counts within three hundred and fifty metres</a></li>
  <li><a href="#primary-schools-within-one-kilometre" id="toc-primary-schools-within-one-kilometre" class="nav-link" data-scroll-target="#primary-schools-within-one-kilometre"><span class="header-section-number">6.3.11</span> Primary schools within one kilometre</a></li>
  <li><a href="#quick-compact-check" id="toc-quick-compact-check" class="nav-link" data-scroll-target="#quick-compact-check"><span class="header-section-number">6.3.12</span> Quick compact check</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda"><span class="header-section-number">7</span> Exploratory Data Analysis (EDA)</a>
  <ul>
  <li><a href="#build-an-analysis-table" id="toc-build-an-analysis-table" class="nav-link" data-scroll-target="#build-an-analysis-table"><span class="header-section-number">7.1</span> Build an analysis table</a></li>
  <li><a href="#univariate-summaries-and-distributions" id="toc-univariate-summaries-and-distributions" class="nav-link" data-scroll-target="#univariate-summaries-and-distributions"><span class="header-section-number">7.2</span> Univariate summaries and distributions</a></li>
  <li><a href="#simple-bivariate-relationships" id="toc-simple-bivariate-relationships" class="nav-link" data-scroll-target="#simple-bivariate-relationships"><span class="header-section-number">7.3</span> Simple bivariate relationships</a></li>
  <li><a href="#first-spatial-views" id="toc-first-spatial-views" class="nav-link" data-scroll-target="#first-spatial-views"><span class="header-section-number">7.4</span> First spatial views</a></li>
  <li><a href="#distance-decay-checks-for-key-access-variables" id="toc-distance-decay-checks-for-key-access-variables" class="nav-link" data-scroll-target="#distance-decay-checks-for-key-access-variables"><span class="header-section-number">7.5</span> Distance decay checks for key access variables</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Ex03</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>TAN Chin Khoon </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 23, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 23, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<p><img src="HDB.png" class="img-fluid"></p>
<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>This study examines the determinants of Housing and Development Board resale prices in Singapore using an explanatory spatial modelling framework. We focus on 4 room flats during 1 January 2025 to 30 September 2025 to maintain comparability and reflect current family preferences for this size category (Renovation Contractor Singapore 2025). The objective is to identify structural and locational attributes associated with transaction prices and to reveal how those associations vary across space. Structural variables include floor area in square metres, floor level, age in years, and remaining lease in years. Locational variables include proximity to rail transit, parks and open space, primary schools including selected high performing schools, childcare and preschool supply, supermarkets, shopping malls, and bus stops. Count variables are computed within 350 m and 1,000 m buffers, and point to point proximity is measured in metres after projecting all layers to SVY21. The remainder of this report states the research questions, documents reproducible data preparation, specifies the global and geographically weighted models, and presents spatially explicit findings with concise implications.</p>
</section>
<section id="research-questions" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="research-questions"><span class="header-section-number">2</span> Research Questions</h2>
<p>This section states operational questions that guide an explanatory analysis of HDB resale prices for 4 room flats from 1 January 2025 to 30 September 2025. The questions align variable construction, model calibration, and interpretation with the objective of identifying price drivers and their spatial variation using a global Multiple Linear Regression baseline and a local geographically weighted model.</p>
<p><strong>RQ1</strong>: Which structural attributes of a flat such as floor area, floor level, age, and remaining lease are significantly associated with resale price during the study window</p>
<p><strong>RQ2</strong>: Which locational attributes such as proximity to rail transit, parks, primary schools, childcare supply, supermarkets, shopping malls, and bus stops are significantly associated with resale price</p>
<p><strong>RQ3</strong>: To what extent do these associations vary across space, as evidenced by spatially varying coefficients from a geographically weighted model</p>
<p><strong>RQ4</strong>: Does the geographically weighted model materially improve fit and residual behaviour relative to a global Multiple Linear Regression specification</p>
<p><strong>RQ5</strong>: Where are local effects notably stronger or weaker, and what practical implications follow for buyers, valuers, and planners</p>
<p>Together these questions structure the analytical framework and ensure direct alignment between the study objectives and subsequent methods.</p>
</section>
<section id="the-data" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="the-data"><span class="header-section-number">3</span> The Data</h2>
<p>In this section, we document every dataset used to construct a transparent, auditable, and fully reproducible sandbox for explanatory modelling of HDB resale prices. The unit of analysis is individual transactions for 4 room flats within 1 January 2025 to 30 September 2025. The core input is the official Resale Flat Prices table. All other layers are supporting geographic data used strictly to engineer the required structural and location variables. To make verification straightforward, sources are presented in a compact 4 column table that lists the dataset name, its modelling purpose, the file format, and a direct source link. All spatial layers are ingested as simple features and projected to SVY21 EPSG 3414 so distance and buffer computations are expressed in metres. Where an application programming interface is involved, we will cache responses to local files to allow repeated runs without network variance.</p>
<div class="cell">
<div class="cell-output-display">
<table class="lightable-classic caption-top table table-sm table-striped small">
<caption>Table 1 Data sources used in Take home Ex03</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Dataset</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Purposes</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Format</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">HDB Resale Flat Prices 2017 Onward</td>
<td style="text-align: left;">Core transactions filtered to 4 room and study window</td>
<td style="text-align: left;">CSV</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_8b84c4ee58e3cfc0ece0d773c8ca6abc/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">URA Master Plan 2019 Subzone Boundary No Sea</td>
<td style="text-align: left;">Map context and optional mainland mask</td>
<td style="text-align: left;">KML</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_0900fdcfdb4666fe2a630f37a532fc06/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">MRT Stations</td>
<td style="text-align: left;">Transit proximity</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://datamall.lta.gov.sg/content/dam/datamall/datasets/Geospatial/TrainStation_Aug2025.zip" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Parks</td>
<td style="text-align: left;">Green space proximity</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_0542d48f0991541706b58059381a6eca/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Eldercare Services</td>
<td style="text-align: left;">Eldercare proximity</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets?query=eldercare&amp;resultId=d_3545b068e3f3506c56b2cb6b6117b884" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Hawker Centres</td>
<td style="text-align: left;">Food services proximity</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets?query=Hawker&amp;resultId=d_4a086da0a5553be1d89383cd90d07ecd" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Supermarkets</td>
<td style="text-align: left;">Supermarket proximity</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets?query=supermarket&amp;resultId=d_cac2c32f01960a3ad7202a99c27268a0" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Shopping Malls</td>
<td style="text-align: left;">Retail centre proximity</td>
<td style="text-align: left;">CSV</td>
<td style="text-align: left;"><a href="https://www.kaggle.com/datasets/karthikgangula/shopping-mall-coordinates?resource=download" target="_blank">kaggle</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">General Information of School</td>
<td style="text-align: left;">Elite school proximity within 1 km</td>
<td style="text-align: left;">CSV</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_688b934f82c1059ed0a6993d2a829089/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Childcare Centres</td>
<td style="text-align: left;">Childcare counts within 350 meters</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_5d668e3f544335f8028f546827b773b4/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kindergartens</td>
<td style="text-align: left;">Kindergarten counts within 350 meters</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_7fe9a72b1afff18e48111772c8d0fd39/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Bus Stops</td>
<td style="text-align: left;">Bus stop counts within 350 meters</td>
<td style="text-align: left;">SHP</td>
<td style="text-align: left;"><a href="https://datamall.lta.gov.sg/content/dam/datamall/datasets/Geospatial/BusStopLocation_Aug2025.zip" target="_blank">Land Transport DataMall</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">CBD Reference</td>
<td style="text-align: left;">Reference for CBD distance</td>
<td style="text-align: left;">Point or Polygon</td>
<td style="text-align: left;">TO SUPPLY</td>
</tr>
<tr class="even">
<td style="text-align: left;">OneMap Geocoding Service</td>
<td style="text-align: left;">Address/Postcode to coordinate lookup</td>
<td style="text-align: left;">API JSON</td>
<td style="text-align: left;"><a href="https://www.onemap.gov.sg/docs/" target="_blank">OneMap</a></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="setup-the-environment" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="setup-the-environment"><span class="header-section-number">4</span> Setup the Environment</h2>
<p>A consistent analytical environment ensures reproducibility and transparency in spatial data analysis. This section defines the R environment used in the study. All scripts were executed in RStudio using packages that support data wrangling, spatial statistics and visualisation. The pacman package is used to automate installation and loading of required libraries. Each library serves a specific purpose within the analytical workflow, and a random seed is set to guarantee consistent statistical outputs across repeated runs.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure the package manager is available</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pacman)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)  <span class="co"># install pacman once if missing</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load all required libraries in one call</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  tidyverse,    <span class="co"># data wrangling and plotting</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  sf,           <span class="co"># spatial vector data handling</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  GWmodel,      <span class="co"># geographically weighted modelling</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  sfdep,        <span class="co"># spatial diagnostics used in the report</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  tmap,         <span class="co"># cartographic maps (static and interactive)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  ggplot2,      <span class="co"># grammar of graphics for charts</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  httr,         <span class="co"># HTTP requests for geocoding if used</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  jsonlite,     <span class="co"># parsing JSON responses</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  progress,     <span class="co"># simple progress bars for batch jobs</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  knitr,        <span class="co"># report tables</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  kableExtra,   <span class="co"># table styling for HTML output</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  purrr,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  stringr</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># set reproducibility and friendly numeric printing</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">626</span>)                       <span class="co"># fixed seed for repeatable results</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)   <span class="co"># keep character columns as character</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)               <span class="co"># print numbers without scientific notation</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="geocoding-for-geometric" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="geocoding-for-geometric"><span class="header-section-number">5</span> Geocoding for Geometric</h2>
<p>This section turns two aspatial sources, HDB Resale Flat Prices 2017 Onward and General Information of School, into spatial features for analysis. For HDB transactions, we filter to 4-room flats between 1 Jan 2025 and 30 Sep 2025, standardise street names, geocode addresses with OneMap, cache results, and convert to <strong>sf</strong> points in WGS84 before transforming to SVY21 (EPSG 3414, Transverse Mercator) so distances are in metres. For schools, we keep only Primary level entries, normalise and de-duplicate 6-digit postcodes, query OneMap by postcode, then join X, Y coordinates and convert directly to SVY21 since OneMap returns SVY21 coordinates for postal lookups. The outputs are two clean spatial objects: <code>HDBresale_sf</code> and <code>primary_schools_sf</code>, ready for Section 6 where we will engineer proximity and count variables (for example, 350 meters buffers and 1,000 meters counts) and integrate the amenity layers.</p>
<section id="geocoding-hdb-resale-transactions-by-addresses" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="geocoding-hdb-resale-transactions-by-addresses"><span class="header-section-number">5.1</span> Geocoding HDB resale transactions by addresses</h3>
<p>We filter 4 room transactions in the study window, tidy street tokens for better matches, geocode each unique address with OneMap, cache results, join coordinates, build POINT geometry, reproject to EPSG 3414, validate, and save.</p>
<section id="load-and-filter-to-study-window-and-flat-type" class="level4" data-number="5.1.1">
<h4 data-number="5.1.1" class="anchored" data-anchor-id="load-and-filter-to-study-window-and-flat-type"><span class="header-section-number">5.1.1</span> Load and filter to study window and flat type</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load resale table</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>HDBresale_raw <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"/Users/cktan/Desktop/SMU/01_Geospatial Analytics (ISSS626)/Hands-on_Ex/Take-home_Ex03/data/aspatial/ResaleflatpricesbasedonregistrationdatefromJan2017onwards.csv"</span>)   <span class="co"># read CSV</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to 4 room and window 2025 01 to 2025 09</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>HDBresale <span class="ot">&lt;-</span> HDBresale_raw <span class="sc">%&gt;%</span>                           <span class="co"># start pipeline</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(flat_type <span class="sc">==</span> <span class="st">"4 ROOM"</span>) <span class="sc">%&gt;%</span>               <span class="co"># keep 4 room</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2025-01"</span>, month <span class="sc">&lt;=</span> <span class="st">"2025-09"</span>)  <span class="co"># keep study months</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="normalise-street-tokens" class="level4" data-number="5.1.2">
<h4 data-number="5.1.2" class="anchored" data-anchor-id="normalise-street-tokens"><span class="header-section-number">5.1.2</span> Normalise street tokens</h4>
<p>Light token fixes improve geocoding hit-rate.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># normalise street tokens for better match rate before calling OneMap</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>HDBresale<span class="sc">$</span>street_name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"ST</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"SAINT"</span>, HDBresale<span class="sc">$</span>street_name)  <span class="co"># expand ST. to SAINT</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="define-onemap-address-geocoder-with-caching" class="level4" data-number="5.1.3">
<h4 data-number="5.1.3" class="anchored" data-anchor-id="define-onemap-address-geocoder-with-caching"><span class="header-section-number">5.1.3</span> Define OneMap address geocoder with caching</h4>
<p>Call OneMap once per unique address; cache results to CSV.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to call OneMap elastic search and return first LAT LON</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>geocode_addr <span class="ot">&lt;-</span> <span class="cf">function</span>(block, streetname) {                                       <span class="co"># define function</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="st">"https://onemap.gov.sg/api/common/elastic/search"</span>                          <span class="co"># endpoint</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">searchVal =</span> <span class="fu">paste</span>(block, streetname),                                   <span class="co"># query text</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">returnGeom =</span> <span class="st">"Y"</span>, <span class="at">getAddrDetails =</span> <span class="st">"N"</span>, <span class="at">pageNum =</span> <span class="st">"1"</span>)                  <span class="co"># parameters</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  txt <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(httr<span class="sc">::</span><span class="fu">GET</span>(url, <span class="at">query =</span> q), <span class="at">as =</span> <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)  <span class="co"># request and read</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  js  <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(txt)                                                    <span class="co"># parse JSON</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(js<span class="sc">$</span>results) <span class="sc">==</span> <span class="dv">0</span>)                                                      <span class="co"># case no result</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">LATITUDE =</span> <span class="cn">NA_real_</span>, <span class="at">LONGITUDE =</span> <span class="cn">NA_real_</span>))               <span class="co"># return NA coords</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">LATITUDE =</span> <span class="fu">as.numeric</span>(js<span class="sc">$</span>results<span class="sc">$</span>LATITUDE[<span class="dv">1</span>]),                     <span class="co"># numeric lat</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">LONGITUDE =</span> <span class="fu">as.numeric</span>(js<span class="sc">$</span>results<span class="sc">$</span>LONGITUDE[<span class="dv">1</span>]))                   <span class="co"># numeric lon</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># build or reload cache of unique address to coordinates</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># path to the cache file</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>cache_path <span class="ot">&lt;-</span> <span class="st">"data/aspatial/geocode_hdb_cache.csv"</span> <span class="co"># csv cache for address results</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(cache_path)) {                      <span class="co"># use cache if it exists</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  hdb_cache <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(cache_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)   <span class="co"># load cached coordinates</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {                                            <span class="co"># otherwise build the cache now</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  uniq_addr <span class="ot">&lt;-</span> HDBresale <span class="sc">%&gt;%</span>                        <span class="co"># start from filtered HDB table</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(block, street_name)             <span class="co"># keep unique block street pairs</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  pb <span class="ot">&lt;-</span> progress<span class="sc">::</span>progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> <span class="fu">nrow</span>(uniq_addr)) <span class="co"># progress indicator</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  hdb_cache <span class="ot">&lt;-</span> uniq_addr <span class="sc">%&gt;%</span>                        <span class="co"># begin cache pipeline</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(                                  <span class="co"># add a list column named geo</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">geo =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(                            <span class="co"># call function for each pair</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        block,                                      <span class="co"># first argument is block</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        street_name,                                <span class="co"># second argument is street name</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(.x, .y) {                          <span class="co"># inline function wrapper</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>          pb<span class="sc">$</span><span class="fu">tick</span>()                                 <span class="co"># advance the progress bar</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geocode_addr</span>(.x, .y)                      <span class="co"># call OneMap geocoder and return tibble</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span>                                           <span class="co"># end mutate and continue pipe</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(geo))                    <span class="co"># expand LATITUDE and LONGITUDE columns</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">write_csv</span>(hdb_cache, cache_path)           <span class="co"># save cache to disk for reuse</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="enforce-one-record-per-address-and-join-coordinates" class="level4" data-number="5.1.4">
<h4 data-number="5.1.4" class="anchored" data-anchor-id="enforce-one-record-per-address-and-join-coordinates"><span class="header-section-number">5.1.4</span> Enforce one record per address and join coordinates</h4>
<p>Bind LATITUDE, LONGITUDE, convert to WGS84 points, then to SVY21 (TM).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep one coordinate per address and ensure numeric</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>hdb_cache_fixed <span class="ot">&lt;-</span> hdb_cache <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">LATITUDE =</span> <span class="fu">as.numeric</span>(LATITUDE), <span class="at">LONGITUDE =</span> <span class="fu">as.numeric</span>(LONGITUDE)) <span class="sc">%&gt;%</span>  <span class="co"># numeric</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(LATITUDE), <span class="sc">!</span><span class="fu">is.na</span>(LONGITUDE)) <span class="sc">%&gt;%</span>                                 <span class="co"># drop NA rows</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(block, street_name) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">ungroup</span>()  <span class="co"># one per pair</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># attach coordinates to filtered HDB table</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>HDBresale_geo <span class="ot">&lt;-</span> HDBresale <span class="sc">%&gt;%</span>                                      <span class="co"># base table</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(hdb_cache_fixed, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"block"</span>,<span class="st">"street_name"</span>))  <span class="co"># join LAT LON</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="create-point-geometry-and-validate" class="level4" data-number="5.1.5">
<h4 data-number="5.1.5" class="anchored" data-anchor-id="create-point-geometry-and-validate"><span class="header-section-number">5.1.5</span> Create POINT geometry and validate</h4>
<p>Verify the geometry output by using <code>glimpse()</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build sf points in WGS 84 then transform to SVY21 EPSG 3414</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_geo <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>,<span class="st">"LATITUDE"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span>    <span class="co"># create POINT</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">3414</span>)                                              <span class="co"># project to 3414</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># validate type and reference system</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(HDBresale_sf)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:3414 
  wkt:
PROJCRS["SVY21 / Singapore TM",
    BASEGEOGCRS["SVY21",
        DATUM["SVY21",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4757]],
    CONVERSION["Singapore Transverse Mercator",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",1.36666666666667,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",103.833333333333,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",1,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",28001.642,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",38744.572,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["northing (N)",north,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["easting (E)",east,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Cadastre, engineering survey, topographic mapping."],
        AREA["Singapore - onshore and offshore."],
        BBOX[1.13,103.59,1.47,104.07]],
    ID["EPSG",3414]]</code></pre>
</div>
</div>
</section>
</section>
<section id="geocoding-schools-by-postcodes" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="geocoding-schools-by-postcodes"><span class="header-section-number">5.2</span> Geocoding schools by postcodes</h3>
<p>We filter to PRIMARY level, standardise 6 digit postcodes, query OneMap by postcode to obtain X and Y in SVY21, keep one result per code, join to the table, convert to POINT, validate EPSG 3414, and save.</p>
<section id="load-and-keep-primary-level" class="level4" data-number="5.2.1">
<h4 data-number="5.2.1" class="anchored" data-anchor-id="load-and-keep-primary-level"><span class="header-section-number">5.2.1</span> Load and keep primary level</h4>
<p>Read the table and filter <code>mainlevel_code == "PRIMARY"</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read school table and keep primary level</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"/Users/cktan/Desktop/SMU/01_Geospatial Analytics (ISSS626)/Hands-on_Ex/Take-home_Ex03/data/aspatial/Generalinformationofschools.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>primary_schools <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(schools, mainlevel_code <span class="sc">==</span> <span class="st">"PRIMARY"</span>)                            </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># standardise 6 digit postcodes</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>primary_schools <span class="ot">&lt;-</span> primary_schools <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">postal_code =</span> stringr<span class="sc">::</span><span class="fu">str_pad</span>(postal_code, <span class="dv">6</span>, <span class="at">pad =</span> <span class="st">"0"</span>))  <span class="co"># pad</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="onemap-postcode-lookup-and-clean" class="level4" data-number="5.2.2">
<h4 data-number="5.2.2" class="anchored" data-anchor-id="onemap-postcode-lookup-and-clean"><span class="header-section-number">5.2.2</span> OneMap postcode lookup and clean</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># query OneMap by postcode to get X Y in SVY21</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>om_url <span class="ot">&lt;-</span> <span class="st">"https://onemap.gov.sg/api/common/elastic/search"</span>                              <span class="co"># endpoint</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>postcodes <span class="ot">&lt;-</span> <span class="fu">unique</span>(primary_schools<span class="sc">$</span>postal_code)                                         <span class="co"># unique codes</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>found_xy <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>()                                                             <span class="co"># holder</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pc <span class="cf">in</span> postcodes) {                                                                  <span class="co"># loop codes</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">searchVal =</span> pc, <span class="at">returnGeom =</span> <span class="st">"Y"</span>, <span class="at">getAddrDetails =</span> <span class="st">"Y"</span>, <span class="at">pageNum =</span> <span class="st">"1"</span>)       <span class="co"># params</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  js <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(httr<span class="sc">::</span><span class="fu">GET</span>(om_url, <span class="at">query =</span> q))                                      <span class="co"># request parse</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(js<span class="sc">$</span>found) <span class="sc">&amp;&amp;</span> js<span class="sc">$</span>found <span class="sc">&gt;</span> <span class="dv">0</span>) {                                              <span class="co"># keep matches</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(js<span class="sc">$</span>results, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)                            <span class="co"># to data frame</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    found_xy <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(found_xy, tibble<span class="sc">::</span><span class="fu">as_tibble</span>(df[, <span class="fu">c</span>(<span class="st">"POSTAL"</span>,<span class="st">"X"</span>,<span class="st">"Y"</span>)])) <span class="co"># keep fields</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># coerce and keep one row per code</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>found_xy_clean <span class="ot">&lt;-</span> found_xy <span class="sc">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">POSTAL =</span> <span class="fu">as.character</span>(POSTAL), <span class="at">X =</span> <span class="fu">as.numeric</span>(X), <span class="at">Y =</span> <span class="fu">as.numeric</span>(Y)) <span class="sc">%&gt;%</span> <span class="co"># numeric</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(X), <span class="sc">!</span><span class="fu">is.na</span>(Y)) <span class="sc">%&gt;%</span>                                                <span class="co"># drop NA</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(POSTAL) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">ungroup</span>()              <span class="co"># one per code</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="join-coordinates-and-build-point-geometry" class="level4" data-number="5.2.3">
<h4 data-number="5.2.3" class="anchored" data-anchor-id="join-coordinates-and-build-point-geometry"><span class="header-section-number">5.2.3</span> Join coordinates and build POINT geometry</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attach X Y to school table</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>primary_schools_xy <span class="ot">&lt;-</span> primary_schools <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(found_xy_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"postal_code"</span> <span class="ot">=</span> <span class="st">"POSTAL"</span>))                       <span class="co"># join coords</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf POINT in SVY21</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>primary_schools_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(primary_schools_xy, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"X"</span>,<span class="st">"Y"</span>), <span class="at">crs =</span> <span class="dv">3414</span>)    <span class="co"># build POINT</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># validate geometry and reference system</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(primary_schools_sf)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:3414 
  wkt:
PROJCRS["SVY21 / Singapore TM",
    BASEGEOGCRS["SVY21",
        DATUM["SVY21",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4757]],
    CONVERSION["Singapore Transverse Mercator",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",1.36666666666667,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",103.833333333333,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",1,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",28001.642,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",38744.572,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["northing (N)",north,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["easting (E)",east,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Cadastre, engineering survey, topographic mapping."],
        AREA["Singapore - onshore and offshore."],
        BBOX[1.13,103.59,1.47,104.07]],
    ID["EPSG",3414]]</code></pre>
</div>
</div>
</section>
</section>
<section id="persist-clean-spatial-tables" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="persist-clean-spatial-tables"><span class="header-section-number">5.3</span> Persist clean spatial tables</h3>
<p>We save both sf objects to RDS for reuse. This avoids repeated API calls and guarantees consistent inputs for the next section.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save both objects for downstream steps</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(HDBresale_sf, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"/Users/cktan/Desktop/SMU/01_Geospatial Analytics (ISSS626)/Hands-on_Ex/Take-home_Ex03/data/rds/HDBresale_sf.rds"</span>)       <span class="co"># geocoded HDB</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(primary_schools_sf, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"/Users/cktan/Desktop/SMU/01_Geospatial Analytics (ISSS626)/Hands-on_Ex/Take-home_Ex03/data/rds/primary_schools_sf.rds"</span>) <span class="co"># geocoded schools</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="predictors-preprocessing-and-wrangling" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="predictors-preprocessing-and-wrangling"><span class="header-section-number">6</span> Predictors Preprocessing and Wrangling</h2>
<p>This section prepares every predictor that will feed into the modelling phase. We start from our geocoded HDBresale_sf which already contains POINT geometry in EPSG 3414 SVY21 metres and covers the window from 2025-01 to 2025-09. The structural predictors transform raw strings into numeric features that a model can use directly. Remaining lease is parsed into number of months. Storey range is converted into a single floor level by averaging the lower and upper level. Age of unit is computed from lease commence year against the reference year 2025. For location predictors we strictly follow the kick starter pattern. All target layers are POINTS in EPSG 3414. If a source is polygon or multipolygon we create a safe interior point with st_point_on_surface and drop any Z or M dimensions. For proximity we compute two styles when relevant. First, a continuous distance in metres to the nearest feature. Second, a within buffer count where the requirement asks for numbers within 350 metres or 1 000 metres. Every step below is short, repeatable, and fully commented for beginners.</p>
<section id="structural-predictors" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="structural-predictors"><span class="header-section-number">6.1</span> Structural predictors</h3>
<section id="remaining-lease-in-months" class="level4" data-number="6.1.1">
<h4 data-number="6.1.1" class="anchored" data-anchor-id="remaining-lease-in-months"><span class="header-section-number">6.1.1</span> Remaining lease in months</h4>
<p>We need a numeric predictor for the time left on each lease so that models can read it directly. The source field Remaining lease is plain text such as â€œ56 years 03 monthsâ€ or sometimes simply â€œ52 yearsâ€. The code below does four things. First, it makes sure our HDB table is available as an sf POINT layer in EPSG 3414, loading the saved RDS if needed or building POINTs from latitude and longitude if that is what we currently have. Second, it validates that geometry is POINT and the reference system is SVY21 metres. Third, it parses the text into two integers, years and months, with missing months treated as zero. Fourth, it computes the final integer REMAINING_LEASE_MTH and drops the temporary helpers. The result is a tidy numeric feature that is ready for joins and modelling, and we also get a quick compact check that confirms type and a small sample.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure we have an sf POINT layer named HDBresale_sf in EPSG 3414</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"HDBresale_sf"</span>)) {                                   <span class="co"># create if not present</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">"data/rds/HDBresale_sf.rds"</span>)) {                 <span class="co"># load saved object</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    HDBresale_sf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/HDBresale_sf.rds"</span>)          <span class="co"># read rds</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"HDBresale_geo"</span>)) {                           <span class="co"># else use geocoded table</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    HDBresale_sf <span class="ot">&lt;-</span> HDBresale_geo                                 <span class="co"># assign geocoded</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {                                                        <span class="co"># nothing found</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"HDBresale_sf was not found and no source is available"</span>) <span class="co"># stop with message</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf if needed using LATITUDE and LONGITUDE then project to 3414</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(HDBresale_sf, <span class="st">"sf"</span>)) {                              <span class="co"># not an sf yet</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"LONGITUDE"</span>,<span class="st">"LATITUDE"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(HDBresale_sf))) <span class="co"># require coords</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  HDBresale_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(                                   <span class="co"># build geometry</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    HDBresale_sf,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>,<span class="st">"LATITUDE"</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4326</span>                                                     <span class="co"># WGS 84 degrees</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">3414</span>)                                         <span class="co"># convert to SVY21 metres</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># validate geometry type and reference system</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(HDBresale_sf) <span class="sc">==</span> <span class="st">"POINT"</span>))      <span class="co"># geometry must be POINT</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(HDBresale_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                   <span class="co"># CRS must be 3414</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># helper that converts one text like "56 years 03 months" to total months</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>parse_rl_to_months <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {                                <span class="co"># define helper</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  txt <span class="ot">&lt;-</span> <span class="fu">tolower</span>(x)                                                <span class="co"># normalise case</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  yr  <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.integer</span>(<span class="fu">str_extract</span>(txt, <span class="st">"</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">s*year)"</span>)))   <span class="co"># pull years</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  mo  <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.integer</span>(<span class="fu">str_extract</span>(txt, <span class="st">"</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">s*month)"</span>)))  <span class="co"># pull months</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  yr  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(yr), <span class="dv">0</span>L, yr)                                 <span class="co"># missing years to zero</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  mo  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(mo), <span class="dv">0</span>L, mo)                                 <span class="co"># missing months to zero</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="dv">12</span>L <span class="sc">*</span> yr <span class="sc">+</span> mo                                                    <span class="co"># return total months</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the numeric feature</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span>                                   <span class="co"># start transform</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">REMAINING_LEASE_MTH =</span> <span class="fu">parse_rl_to_months</span>(remaining_lease)      <span class="co"># new integer field</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="co"># compact checks and a quick peek</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(HDBresale_sf<span class="sc">$</span>REMAINING_LEASE_MTH))            <span class="co"># must be numeric</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(                                                     <span class="co"># show a compact view</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(HDBresale_sf, remaining_lease, REMAINING_LEASE_MTH, geometry)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 3
$ remaining_lease     &lt;chr&gt; "56 years 03 months", "86 years 09 months", "56 yeâ€¦
$ REMAINING_LEASE_MTH &lt;int&gt; 675, 1041, 674, 624, 1040, 624, 613, 614, 1039, 10â€¦
$ geometry            &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 3â€¦</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(HDBresale_sf, remaining_lease, REMAINING_LEASE_MTH), <span class="dv">5</span>)  <span class="co"># first rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 28566.05 ymin: 38360.76 xmax: 30036.29 ymax: 38861.93
Projected CRS: SVY21 / Singapore TM
# A tibble: 5 Ã— 3
  remaining_lease    REMAINING_LEASE_MTH            geometry
  &lt;chr&gt;                            &lt;int&gt;         &lt;POINT [m]&gt;
1 56 years 03 months                 675 (30036.29 38360.76)
2 86 years 09 months                1041 (29283.45 38517.37)
3 56 years 02 months                 674 (30036.29 38360.76)
4 52 years                           624 (28566.05 38861.93)
5 86 years 08 months                1040 (29283.45 38517.37)</code></pre>
</div>
</div>
</section>
<section id="floor-level-from-storey-range" class="level4" data-number="6.1.2">
<h4 data-number="6.1.2" class="anchored" data-anchor-id="floor-level-from-storey-range"><span class="header-section-number">6.1.2</span> Floor level from storey range</h4>
<p>We average the two numbers inside storey_range. Non numeric and missing cases are handled safely and leave NA.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start from the existing sf table                                               </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(HDBresale_sf, <span class="st">"sf"</span>))                <span class="co"># must be an sf object   </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(HDBresale_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)       <span class="co"># confirm EPSG 3414      </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute average floor level from ranges like "04 TO 06"                        </span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span>                      </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(                                       </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.rng =</span> stringr<span class="sc">::</span><span class="fu">str_extract_all</span>(storey_range, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="co"># grab all numbers  </span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.low =</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.integer</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(.rng, dplyr<span class="sc">::</span>first))),    <span class="co"># first</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.high =</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.integer</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(.rng, dplyr<span class="sc">::</span>last))),    <span class="co"># last </span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FLOOR_LEVEL =</span> <span class="fu">as.numeric</span>(.low <span class="sc">+</span> .high) <span class="sc">/</span> <span class="dv">2</span>                                   <span class="co"># average</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span>                                                                          </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>.rng, <span class="sc">-</span>.low, <span class="sc">-</span>.high)                                             <span class="co"># drop helpers</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># quick checks                                                                   </span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(HDBresale_sf<span class="sc">$</span>FLOOR_LEVEL) <span class="sc">|</span> <span class="fu">is.na</span>(HDBresale_sf<span class="sc">$</span>FLOOR_LEVEL)) <span class="co"># numeric or NA</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(HDBresale_sf, storey_range, FLOOR_LEVEL, geometry))  <span class="co"># preview</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 3
$ storey_range &lt;chr&gt; "13 TO 15", "10 TO 12", "10 TO 12", "07 TO 09", "28 TO 30â€¦
$ FLOOR_LEVEL  &lt;dbl&gt; 14, 11, 11, 8, 29, 5, 11, 5, 17, 17, 5, 8, 11, 5, 2, 11, â€¦
$ geometry     &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 38517.37â€¦</code></pre>
</div>
</div>
</section>
<section id="age-of-the-unit-in-years" class="level4" data-number="6.1.3">
<h4 data-number="6.1.3" class="anchored" data-anchor-id="age-of-the-unit-in-years"><span class="header-section-number">6.1.3</span> Age of the unit in years</h4>
<p>e compute Age as 2025 minus lease_commence_date. Negative or missing values are set to NA.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute Age using the stated analysis year                                      </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>analysis_year <span class="ot">&lt;-</span> <span class="dv">2025</span>                                 <span class="co"># set current analysis year</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span>                      <span class="co"># continue same table      </span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(                                     </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">AGE_2025 =</span> <span class="fu">suppressWarnings</span>(                      <span class="co"># new numeric field        </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(analysis_year <span class="sc">-</span> <span class="fu">as.integer</span>(lease_commence_date))                </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    ),                                                                          </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">AGE_2025 =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(AGE_2025 <span class="sc">&gt;=</span> <span class="dv">0</span>, AGE_2025, <span class="fu">as.numeric</span>(<span class="cn">NA</span>))           <span class="co"># guard</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># validate                                                                         </span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(HDBresale_sf<span class="sc">$</span>AGE_2025) <span class="sc">|</span> <span class="fu">is.na</span>(HDBresale_sf<span class="sc">$</span>AGE_2025))       <span class="co"># numeric or NA</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(HDBresale_sf, lease_commence_date, AGE_2025, geometry)) <span class="co"># preview</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 3
$ lease_commence_date &lt;dbl&gt; 1982, 2012, 1982, 1978, 2012, 1978, 1977, 1977, 20â€¦
$ AGE_2025            &lt;dbl&gt; 43, 13, 43, 47, 13, 47, 48, 48, 13, 13, 49, 49, 47â€¦
$ geometry            &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 3â€¦</code></pre>
</div>
</div>
</section>
<section id="structural-predictors-ready" class="level4" data-number="6.1.4">
<h4 data-number="6.1.4" class="anchored" data-anchor-id="structural-predictors-ready"><span class="header-section-number">6.1.4</span> Structural predictors ready</h4>
<p>At this point, our structural predictors are present on HDBresale_sf as REMAINING_LEASE_MTH, FLOOR_LEVEL, and AGE_2025.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># final compact view of structural fields                                          </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(HDBresale_sf, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                             REMAINING_LEASE_MTH, FLOOR_LEVEL, AGE_2025, geometry))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 4
$ REMAINING_LEASE_MTH &lt;int&gt; 675, 1041, 674, 624, 1040, 624, 613, 614, 1039, 10â€¦
$ FLOOR_LEVEL         &lt;dbl&gt; 14, 11, 11, 8, 29, 5, 11, 5, 17, 17, 5, 8, 11, 5, â€¦
$ AGE_2025            &lt;dbl&gt; 43, 13, 43, 47, 13, 47, 48, 48, 13, 13, 49, 49, 47â€¦
$ geometry            &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 3â€¦</code></pre>
</div>
</div>
</section>
</section>
<section id="preparing-target-layers-for-location-factors" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="preparing-target-layers-for-location-factors"><span class="header-section-number">6.2</span> Preparing target layers for location factors</h3>
<p>All location sources must be POINTS in EPSG 3414. We create a function that reads any vector file, sets CRS if missing, projects to 3414, converts polygons to safe interior points, and drops Z or M if present. We then prepare the exact layers as listed: MRT stations as GeoJSON, eldercare, hawker centres, parks, kindergartens, childcare centres, supermarkets, bus stops, primary schools, and shopping malls. Primary schools use the geocoded POINTS saved in Section 5. For elite schools we filter a named list. For counts we will reuse the prepared primary schools for the one kilometre radius. For CBD we read a user supplied vector file and convert to a single point using the interior point of the union. If a file is missing the code stops with a clear message so you can place the file before continuing.</p>
<section id="function-and-global-checks" class="level4" data-number="6.2.1">
<h4 data-number="6.2.1" class="anchored" data-anchor-id="function-and-global-checks"><span class="header-section-number">6.2.1</span> Function and global checks</h4>
<p>Before preparing any single layer, we define a function that reads a vector dataset, normalises its coordinate reference system, and guarantees a POINT result. This keeps every later subsection short and predictable. The function accepts common formats such as GeoJSON, Shapefile, KML, and GPKG through <code>sf::st_read</code>. If a source comes in with Z or M dimensions, those are dropped since our analysis is two dimensional in metres. If the input geometry is not a POINT, we safely convert to an interior point which always falls inside each feature. Finally we project to EPSG 3414 so distances are in metres. We also confirm our HDB layer is an sf POINT in EPSG 3414.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to read any vector file and return POINTS in EPSG 3414</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>read_as_points_3414 <span class="ot">&lt;-</span> <span class="cf">function</span>(path, <span class="at">assume_epsg =</span> <span class="cn">NULL</span>) {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(path))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if CRS is missing, set it without transforming</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(g)<span class="sc">$</span>epsg)) {</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.null</span>(assume_epsg))         <span class="co"># we must be told what it is</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_set_crs</span>(g, assume_epsg)      <span class="co"># &lt;â€” use st_set_crs(), no warning</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(g, <span class="dv">3414</span>)             <span class="co"># project to metres</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_zm</span>(g, <span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">"ZM"</span>)<span class="co"># drop Z/M if present</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(g) <span class="sc">==</span> <span class="st">"POINT"</span>)) {</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_point_on_surface</span>(g) <span class="sc">|&gt;</span>       <span class="co"># safe interior point</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>         sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  g</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for CSVs with lon and lat columns</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>read_csv_points_3414 <span class="ot">=</span> <span class="cf">function</span>(path, lon, lat, <span class="at">crs_in =</span> <span class="dv">4326</span>) {</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(path))                                  <span class="co"># csv must exist</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)            <span class="co"># read csv</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">c</span>(lon, lat) <span class="sc">%in%</span> <span class="fu">names</span>(df)))                    <span class="co"># require columns</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(df, <span class="at">coords =</span> <span class="fu">c</span>(lon, lat), <span class="at">crs =</span> crs_in)      <span class="co"># build points</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(g, <span class="dv">3414</span>)                                 <span class="co"># project to metres</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  g                                                             <span class="co"># return points</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="co"># confirm HDB layer is ready</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(HDBresale_sf, <span class="st">"sf"</span>))                          <span class="co"># must be sf</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(HDBresale_sf) <span class="sc">==</span> <span class="st">"POINT"</span>))    <span class="co"># must be points</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(HDBresale_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                 <span class="co"># must be 3414</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="mrt-station-exits-from-geojson" class="level4" data-number="6.2.2">
<h4 data-number="6.2.2" class="anchored" data-anchor-id="mrt-station-exits-from-geojson"><span class="header-section-number">6.2.2</span> MRT station exits from GeoJSON</h4>
<p>Transit proximity is a key location factor. Our Table 1 in Section 3 states that the MRT station source is GeoJSON. We therefore load the MRT exits GeoJSON, discard any elevation or measure values, and ensure the coordinates are in EPSG 3414 so that all nearest distance calculations return values in metres. Some public datasets encode MRT exits as small polygons rather than true points. To avoid topological surprises, we convert any non point geometry to a safe interior point. The interior point always lies within a station footprint which makes nearest distance and within radius operations stable. A simple <code>glimpse()</code> confirms that the result contains only POINT geometry.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read MRT exits GeoJSON and prepare POINTS in 3414</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>mrt_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/LTAMRTStationExitGEOJSON.geojson"</span>)  <span class="co"># read and convert</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(mrt_pt, <span class="st">"sf"</span>))                                                 <span class="co"># must be sf</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(mrt_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                           <span class="co"># must be points</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(mrt_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                                        <span class="co"># metres</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mrt_pt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 597
Columns: 5
$ OBJECTID   &lt;int&gt; 14641, 14642, 14643, 14644, 14645, 14646, 14647, 14648, 146â€¦
$ EXIT_CODE  &lt;chr&gt; "Exit A", "Exit A", "Exit A", "Exit A", "Exit A", "Exit A",â€¦
$ INC_CRC    &lt;chr&gt; "45CDB0D9BDC73079", "54BFE6EB924CBA6F", "A324402CF624723A",â€¦
$ FMEL_UPD_D &lt;chr&gt; "20231019120510", "20231019120510", "20231019120510", "2023â€¦
$ geometry   &lt;POINT [m]&gt; POINT (20361.05 40974.54), POINT (20887.79 41082.76),â€¦</code></pre>
</div>
</div>
</section>
<section id="primary-schools-and-elite-subset" class="level4" data-number="6.2.3">
<h4 data-number="6.2.3" class="anchored" data-anchor-id="primary-schools-and-elite-subset"><span class="header-section-number">6.2.3</span> Primary schools and elite subset</h4>
<p>Elite school proximity uses the same school geocodes you already created in Section 5. We load the prepared RDS <code>primary_schools_sf.rds</code>, confirm EPSG 3414 and POINT geometry, then build a filtered view containing only the twenty elite schools specified. This subset will be used to compute continuous distance to the nearest elite school point and also optional counts within buffers if needed. Keeping both the full set and the elite subset in memory gives flexibility for later features such as count of any primary school within one kilometre and distance to the nearest elite school. A quick print confirms the expected number of rows.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load prepared primary schools points from your RDS</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>primary_schools_sf <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/primary_schools_sf.rds"</span>)            <span class="co"># load points</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(primary_schools_sf, <span class="st">"sf"</span>))                                       <span class="co"># must be sf</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(primary_schools_sf) <span class="sc">==</span> <span class="st">"POINT"</span>))                 <span class="co"># must be points</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(primary_schools_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                              <span class="co"># metres</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to elite schools list</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>elite_names <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NANYANG PRIMARY SCHOOL"</span>,<span class="st">"TAO NAN SCHOOL"</span>,<span class="st">"HONG WEN SCHOOL"</span>,<span class="st">"NAN HUA PRIMARY SCHOOL"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ST. HILDA'S PRIMARY SCHOOL"</span>,<span class="st">"HENRY PARK PRIMARY SCHOOL"</span>,<span class="st">"ANGLO-CHINESE SCHOOL (PRIMARY)"</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RAFFLES GIRLS' PRIMARY SCHOOL"</span>,<span class="st">"PEI HWA PRESBYTERIAN PRIMARY SCHOOL"</span>,<span class="st">"RADIN MAS PRIMARY SCHOOL"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ROSYTH SCHOOL"</span>,<span class="st">"KONG HWA SCHOOL"</span>,<span class="st">"POI CHING SCHOOL"</span>,<span class="st">"HOLY INNOCENTS' PRIMARY SCHOOL"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AI TONG SCHOOL"</span>,<span class="st">"RED SWASTIKA SCHOOL"</span>,<span class="st">"MAHA BODHI SCHOOL"</span>,<span class="st">"RULANG PRIMARY SCHOOL"</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PEI CHUN PUBLIC SCHOOL"</span>,<span class="st">"SINGAPORE CHINESE GIRLS' PRIMARY SCHOOL"</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>elite_primary_sf <span class="ot">=</span> primary_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(school_name <span class="sc">%in%</span> elite_names)                                       <span class="co"># keep elite only</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(elite_primary_sf)                                                              <span class="co"># confirm row count</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
</div>
</section>
<section id="kindergartens-geojson" class="level4" data-number="6.2.4">
<h4 data-number="6.2.4" class="anchored" data-anchor-id="kindergartens-geojson"><span class="header-section-number">6.2.4</span> Kindergartens GeoJSON</h4>
<p>Counts of kindergartens within a local radius offer a proxy for family oriented amenities. The dataset in your project folder is a GeoJSON. We read it with the helper, which ensures every record becomes a POINT in EPSG 3414 with Z and M removed. We store the prepared layer as <code>kindergartens_pt</code>. This layer will be used to compute the number of locations inside a radius around each HDB resale point, for example within three hundred and fifty metres. The preparation step does not aggregate or filter because the raw count requires the complete set. A short check confirms geometry and projection are correct.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read kindergartens as points</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>kindergartens_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/Kindergartens.geojson"</span>)     <span class="co"># prepare layer</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(kindergartens_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                   <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="childcare-centres-geojson" class="level4" data-number="6.2.5">
<h4 data-number="6.2.5" class="anchored" data-anchor-id="childcare-centres-geojson"><span class="header-section-number">6.2.5</span> Childcare centres GeoJSON</h4>
<p>Childcare centres will be counted within a three hundred and fifty metre radius per HDB resale observation. The input format is GeoJSON according to your directory. We load the file with the helper so that geometry is POINT, projection is SVY21 metres, and extra dimensions are removed. We keep the data as is without filters, since the later count requires complete coverage. A simple <code>glimpse()</code> appears after the code so you can verify the feature count and the geometry column. This prepared layer is named <code>childcare_pt</code> and is used later to compute the required counts column.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read childcare centres as points</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>childcare_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/ChildCareServices.geojson"</span>)     <span class="co"># prepare layer</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(childcare_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                       <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="bus-stops-shapefile" class="level4" data-number="6.2.6">
<h4 data-number="6.2.6" class="anchored" data-anchor-id="bus-stops-shapefile"><span class="header-section-number">6.2.6</span> Bus stops Shapefile</h4>
<p>We will read the feature class <code>BusStop.shp</code>. Shapefiles often carry mixed attributes and sometimes include Z or M. The helper removes those and converts any non point geometry to a stable interior point. After projection to EPSG 3414, the prepared layer supports both nearest distance and counts within a three hundred and fifty metre radius. This is important because bus networks are dense and small geometric errors can change counts near buffer edges. The result is stored as <code>busstop_pt</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>busstop_pt <span class="ot">&lt;-</span> <span class="fu">read_as_points_3414</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/geospatial/BusStopLocation_Aug2025/BusStop.shp"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">assume_epsg =</span> <span class="dv">3414</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(busstop_pt, <span class="st">"sf"</span>))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(busstop_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(busstop_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(busstop_pt, geometry))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,172
Columns: 1
$ geometry &lt;POINT [m]&gt; POINT (35565.66 41659.52), POINT (21439.91 31253.63), Pâ€¦</code></pre>
</div>
</div>
</section>
<section id="eldercare-geojson" class="level4" data-number="6.2.7">
<h4 data-number="6.2.7" class="anchored" data-anchor-id="eldercare-geojson"><span class="header-section-number">6.2.7</span> Eldercare GeoJSON</h4>
<p>Eldercare proximity measures access to aged care services. The source file is GeoJSON. We treat it the same way as the previous categories. The prepared layer is <code>eldercare_pt</code> which holds POINT geometry in metres. Later sections will compute continuous nearest distance from each HDB resale observation to the nearest eldercare site. That feature will be named following the pattern you set earlier. The code below ensures that the geometry types are consistent which helps prevent confusing errors during distance calculations or spatial joins.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read eldercare services as points</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>eldercare_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/EldercareServices.geojson"</span>)     <span class="co"># prepare layer</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(eldercare_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                       <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="hawker-centres-geojson" class="level4" data-number="6.2.8">
<h4 data-number="6.2.8" class="anchored" data-anchor-id="hawker-centres-geojson"><span class="header-section-number">6.2.8</span> Hawker centres GeoJSON</h4>
<p>Food access through hawker centres is an essential amenity. The input is GeoJSON. We load and normalise with the helper and hold the result as POINTs in EPSG 3414. This prepared layer will support the continuous distance feature, usually named proximity to hawker. Because later analysis may also examine counts of food places within a given radius, we keep every record without filtering. The checks at the bottom confirm geometry and projection which keeps later computations safe and repeatable.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read hawker centres as points</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>hawker_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/HawkerCentresGEOJSON.geojson"</span>)    <span class="co"># prepare layer</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(hawker_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                         <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="parks-geojson" class="level4" data-number="6.2.9">
<h4 data-number="6.2.9" class="anchored" data-anchor-id="parks-geojson"><span class="header-section-number">6.2.9</span> Parks GeoJSON</h4>
<p>Green space proximity is derived from the parks layer. Some parks are polygons. The helper converts these to interior points so that nearest distance behaves as expected even for large irregular shapes. The layer is stored in metres which allows clean thresholds if you decide to add a within buffer count later. The code below reads the file, converts geometry if necessary, and performs simple validity checks. The prepared object is named <code>parks_pt</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read parks and convert to points</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>parks_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/Parks.geojson"</span>)                     <span class="co"># prepare layer</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(parks_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                            <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="shopping-malls-csv" class="level4" data-number="6.2.10">
<h4 data-number="6.2.10" class="anchored" data-anchor-id="shopping-malls-csv"><span class="header-section-number">6.2.10</span> Shopping malls CSV</h4>
<p>We read the CSV and build POINT geometry from those two columns. The default source reference for such files is usually WGS84, so we assign EPSG 4326 and then project to EPSG 3414. After preparation, nearest distance and within buffer counts are straightforward. The code names the resulting object mall_pt and runs the same geometry and projection checks as the other sections so everything remains consistent across features.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read shopping mall coordinates from CSV and build points</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>mall_pt <span class="ot">=</span> <span class="fu">read_csv_points_3414</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"data/geospatial/shopping_mall_coordinates.csv"</span>,    <span class="co"># csv path</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lon  =</span> <span class="st">"LONGITUDE"</span>,                                        <span class="co"># name of longitude column</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat  =</span> <span class="st">"LATITUDE"</span>,                                         <span class="co"># name of latitude column</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs_in =</span> <span class="dv">4326</span>                                              <span class="co"># source is WGS84</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(mall_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))     <span class="co"># confirm points</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(mall_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                  <span class="co"># metres</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="supermarkets-geojson" class="level4" data-number="6.2.11">
<h4 data-number="6.2.11" class="anchored" data-anchor-id="supermarkets-geojson"><span class="header-section-number">6.2.11</span> Supermarkets GeoJSON</h4>
<p>Supermarket coverage is prepared exactly like hawker and eldercare. We use the helper to read the GeoJSON, transform to metres, and convert any footprint polygons to interior points. The resulting layer <code>supermarket_pt</code> supports both continuous distance and within buffer counts if needed. As with all other layers, we store the prepared set without additional filters so feature engineering in later sections can proceed without surprises. The code includes quick checks to ensure geometry and projection are correct.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read supermarkets as points</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>supermarket_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/SupermarketsGEOJSON.geojson"</span>)       <span class="co"># prepare</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(supermarket_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                    <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cbd-point-from-master-plan-subzones" class="level4" data-number="6.2.12">
<h4 data-number="6.2.12" class="anchored" data-anchor-id="cbd-point-from-master-plan-subzones"><span class="header-section-number">6.2.12</span> CBD point from Master Plan subzones</h4>
<p>CBD proximity uses the DOWNTOWN CORE planning area from the master plan subzones you prepared earlier. We load <code>mpsz_cl.rds</code>, filter to DOWNTOWN CORE, dissolve to a single geometry, and convert the polygon to a safe interior point. This produces a single POINT named <code>cbd_pt</code> in EPSG 3414. Later sections compute the straight line distance from each HDB resale observation to this point and store that feature in metres. The conversion to an interior point avoids centroid outside issues for complex shapes, which keeps distances stable.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load master plan subzones and create a CBD reference point</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/mpsz_cl.rds"</span>)                                   <span class="co"># load polygons</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(mpsz)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                                         <span class="co"># metres</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>cbd_poly <span class="ot">=</span> mpsz <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(PLN_AREA_N <span class="sc">==</span> <span class="st">"DOWNTOWN CORE"</span>) <span class="sc">%&gt;%</span>                               <span class="co"># select area</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_union</span>()                                                                  <span class="co"># dissolve</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>cbd_pt <span class="ot">=</span> cbd_poly <span class="sc">%&gt;%</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_point_on_surface</span>() <span class="sc">%&gt;%</span>                                                   <span class="co"># interior point</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">3414</span>)                                                        <span class="co"># as sf with crs</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(cbd_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                           <span class="co"># confirm point</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="save-prepared-layers-for-repeatable-use" class="level4" data-number="6.2.13">
<h4 data-number="6.2.13" class="anchored" data-anchor-id="save-prepared-layers-for-repeatable-use"><span class="header-section-number">6.2.13</span> Save prepared layers for repeatable use</h4>
<p>To make later sections fast and deterministic, we save each prepared POINT layer as an RDS file under the data rds folder. This avoids re reading and re projecting each time the notebook runs. The saved objects are ready for joins, distance computation, and within buffer counts. The names follow a clear pattern so you can reload any single layer by name. If you update a source file in the future, simply rerun the corresponding subsection and the saved RDS will refresh.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save every prepared layer to RDS for quick reuse</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(mrt_pt,           <span class="st">"data/rds/mrt_pt.rds"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(primary_schools_sf,<span class="st">"data/rds/primary_schools_pt.rds"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(elite_primary_sf,  <span class="st">"data/rds/elite_primary_pt.rds"</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(kindergartens_pt,  <span class="st">"data/rds/kindergartens_pt.rds"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(childcare_pt,      <span class="st">"data/rds/childcare_pt.rds"</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(busstop_pt,        <span class="st">"data/rds/busstop_pt.rds"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(eldercare_pt,      <span class="st">"data/rds/eldercare_pt.rds"</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(hawker_pt,         <span class="st">"data/rds/hawker_pt.rds"</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(parks_pt,          <span class="st">"data/rds/parks_pt.rds"</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(mall_pt,           <span class="st">"data/rds/mall_pt.rds"</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(supermarket_pt,    <span class="st">"data/rds/supermarket_pt.rds"</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(cbd_pt,            <span class="st">"data/rds/cbd_pt.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="location-predictors" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="location-predictors"><span class="header-section-number">6.3</span> Location predictors</h3>
<p>We compute exactly the predictors requested. Distances are nearest neighbour distances in metres using st_nearest_feature and st_distance with by element equal TRUE. Counts use st_is_within_distance with the required radius. We keep names WITHIN_350M_KINDER, WITHIN_350M_CHILDCARE, WITHIN_350M_BUS, and WITHIN_1KM_PRIMARY for clarity. Diagnostics verify that the new fields are in the correct type and that the layer remains POINT in EPSG 3414. At the end we show a compact glimpse of the new columns and write an updated RDS so later sections can load the prepared table immediately.</p>
<section id="helpers-used-by-all-location-predictors" class="level4" data-number="6.3.1">
<h4 data-number="6.3.1" class="anchored" data-anchor-id="helpers-used-by-all-location-predictors"><span class="header-section-number">6.3.1</span> Helpers used by all location predictors</h4>
<p>To keep every later step short, reliable, and readable, we first define two tiny helpers. The first computes a nearest distance from every HDB point to the closest target point. It uses a nearest neighbor index so the work scales well even with several thousand features. The function guards that both layers are in the same projected system so the output is in metres. The second helper counts how many target points fall inside a circular buffer around each HDB point. It uses a fast predicate that returns logical relations, then converts those relations into simple integer counts. With these two helpers in place, every later subsection is a one or two line call that is easy to audit and reproduce.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all layers must be POINT and EPSG 3414 before you call these</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>nearest_distance_m <span class="ot">&lt;-</span> <span class="cf">function</span>(from_pt, to_pt) {</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(from_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>, sf<span class="sc">::</span><span class="fu">st_crs</span>(to_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_nearest_feature</span>(from_pt, to_pt)                <span class="co"># index of nearest target</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  d   <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_distance</span>(from_pt, to_pt[idx, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(d)                                                <span class="co"># metres</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>count_within_m <span class="ot">&lt;-</span> <span class="cf">function</span>(from_pt, to_pt, radius_m) {</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(from_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>, sf<span class="sc">::</span><span class="fu">st_crs</span>(to_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  rel <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_is_within_distance</span>(from_pt, to_pt, <span class="at">dist =</span> radius_m)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vapply</span>(rel, length, <span class="fu">integer</span>(<span class="dv">1</span>))                              <span class="co"># integer counts</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># convenience: load all prepared target layers once</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>mrt_pt          <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/mrt_pt.rds"</span>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>parks_pt        <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/parks_pt.rds"</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>eldercare_pt    <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/eldercare_pt.rds"</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>hawker_pt       <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/hawker_pt.rds"</span>)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>supermarket_pt  <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/supermarket_pt.rds"</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>mall_pt         <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/mall_pt.rds"</span>)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>kindergartens_pt<span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/kindergartens_pt.rds"</span>)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>childcare_pt    <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/childcare_pt.rds"</span>)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>busstop_pt      <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/busstop_pt.rds"</span>)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>primary_pt      <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/primary_schools_pt.rds"</span>)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>elite_primary_pt<span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/elite_primary_pt.rds"</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>cbd_pt          <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/cbd_pt.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="proximity-to-mrt-stations" class="level4" data-number="6.3.2">
<h4 data-number="6.3.2" class="anchored" data-anchor-id="proximity-to-mrt-stations"><span class="header-section-number">6.3.2</span> Proximity to MRT stations</h4>
<p>Access to rail transit is a well known driver of residential prices in compact cities. Distance to the nearest station approximates expected walk time, first mile effort, and overall transit convenience. We compute a single continuous feature in metres from each flat to its closest MRT exit. Using exits rather than line segments avoids ambiguity from long station footprints and guarantees a sensible origin for walking access. Values near zero mean the block is beside an exit, and larger values reflect locations that require a longer walk or an intermediate bus connection. This continuous metric works well in both global and local models and is straightforward to interpret.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_MRT_M =</span> <span class="fu">nearest_distance_m</span>(geometry, mrt_pt))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection </span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_MRT_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 718 731 718 384 731 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-parks" class="level4" data-number="6.3.3">
<h4 data-number="6.3.3" class="anchored" data-anchor-id="proximity-to-parks"><span class="header-section-number">6.3.3</span> Proximity to parks</h4>
<p>Green space can influence prices by improving neighborhood comfort, providing recreation, and raising perceived environmental quality. We treat the park layer as a set of access points. For polygonal parks, you already converted to interior points in the preparation step to avoid edges and holes. We now compute a continuous metric in metres from each flat to the nearest park access point. The interpretation is similar to the transit feature. Smaller values indicate ready access to open space which can be especially valuable in dense estates. The feature is robust since it uses a direct nearest neighbor distance in a projected metre system.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_PARK_M =</span> <span class="fu">nearest_distance_m</span>(geometry, parks_pt))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_PARK_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 426 636 426 356 636 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-eldercare-services" class="level4" data-number="6.3.4">
<h4 data-number="6.3.4" class="anchored" data-anchor-id="proximity-to-eldercare-services"><span class="header-section-number">6.3.4</span> Proximity to eldercare services</h4>
<p>Eldercare access matters to multi-generational households and can be reflected in housing choices. We measure straight line distance from each transaction to the closest registered eldercare service. While travel time would be ideal, Euclidean distance in a small city is a strong proxy once layers are in a metre based projection. The feature can capture both convenience and localized supply. In later diagnostics, you can examine whether this variable has stronger effects in towns with older blocks or where family structures produce higher demand for caregiving services.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_ELDERCARE_M =</span> <span class="fu">nearest_distance_m</span>(geometry, eldercare_pt))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_ELDERCARE_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 260 255 260 398 255 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-hawker-centres" class="level4" data-number="6.3.5">
<h4 data-number="6.3.5" class="anchored" data-anchor-id="proximity-to-hawker-centres"><span class="header-section-number">6.3.5</span> Proximity to hawker centres</h4>
<p>Food access is a daily need. Hawker centres provide affordable options and are commonly used reference points for walkable amenities. We add a continuous distance in metres to the nearest hawker centre point. This variable complements the supermarket feature because the two cover different price tiers and operating hours. If you wish to explore threshold effects later, you can also build indicator variables for within a short walking distance. For now, the continuous measure keeps models simple and comparable across towns.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_HAWKER_M =</span> <span class="fu">nearest_distance_m</span>(geometry, hawker_pt))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_HAWKER_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 389 381 389 132 381 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-supermarkets" class="level4" data-number="6.3.6">
<h4 data-number="6.3.6" class="anchored" data-anchor-id="proximity-to-supermarkets"><span class="header-section-number">6.3.6</span> Proximity to supermarkets</h4>
<p>Supermarkets indicate stable food supply and often co locate with other services such as pharmacies and financial services. We compute the distance to the nearest supermarket point. The variable captures everyday convenience that families value when selecting a flat. It can also proxy for local retail vitality. Be aware that this feature sometimes correlates with shopping mall distance in central areas, so you will check variance inflation later. For now we keep it as a straightforward continuous measure that is easy to explain to a non technical audience.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_SUPERMKT_M =</span> <span class="fu">nearest_distance_m</span>(geometry, supermarket_pt))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_SUPERMKT_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 285 314 285 186 314 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-shopping-malls" class="level4" data-number="6.3.7">
<h4 data-number="6.3.7" class="anchored" data-anchor-id="proximity-to-shopping-malls"><span class="header-section-number">6.3.7</span> Proximity to shopping malls</h4>
<p>Regional and town centre malls bundle retail, dining, and services in one place. Proximity can raise perceived convenience and social activity. Your mall layer comes from a table with latitude and longitude that was converted to points and projected to metres earlier. We now compute a single nearest distance feature. Remember that this is a straight line proxy. If you later have access to a street network, the same helper can be swapped for a travel time routine without changing the structure of the model script.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_MALL_M =</span> <span class="fu">nearest_distance_m</span>(geometry, mall_pt))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_MALL_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 756 652 756 960 652 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-the-cbd-reference-point" class="level4" data-number="6.3.8">
<h4 data-number="6.3.8" class="anchored" data-anchor-id="proximity-to-the-cbd-reference-point"><span class="header-section-number">6.3.8</span> Proximity to the CBD reference point</h4>
<p>The central business district concentrates high wage employment and premium services. Distance to that center is often a strong global gradient in price models. You created a stable CBD reference by dissolving the Downtown Core planning area and converting it to a safe interior point. We now measure a continuous distance from every flat to this single reference. The value helps the model separate broad city wide trends from local amenity effects. In later maps of local coefficients you can observe where the CBD gradient weakens or strengthens relative to neighborhood factors.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_CBD_M =</span> <span class="fu">nearest_distance_m</span>(geometry, cbd_pt))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_CBD_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 8486 8718 8486 9185 8718 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-elite-primary-schools" class="level4" data-number="6.3.9">
<h4 data-number="6.3.9" class="anchored" data-anchor-id="proximity-to-elite-primary-schools"><span class="header-section-number">6.3.9</span> Proximity to elite primary schools</h4>
<p>School prestige can affect price expectations for families with young children. You already derived an elite subset with twenty schools from the full primary list. We compute a continuous distance to the nearest elite school point. This gives a clear and interpretable number in metres that can be compared across towns. In later robustness checks you may also include the distance to the nearest ordinary primary school to differentiate general access from prestige access. For now we focus on the prestige signal since that is more likely to be reflected in marginal willingness to pay.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_ELITEPRI_M =</span> <span class="fu">nearest_distance_m</span>(geometry, elite_primary_pt))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_ELITEPRI_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 2090 1390 2090 992 1390 ...</code></pre>
</div>
</div>
</section>
<section id="amenity-counts-within-three-hundred-and-fifty-metres" class="level4" data-number="6.3.10">
<h4 data-number="6.3.10" class="anchored" data-anchor-id="amenity-counts-within-three-hundred-and-fifty-metres"><span class="header-section-number">6.3.10</span> Amenity counts within three hundred and fifty metres</h4>
<p>Counts within a short walking radius capture micro scale density of child related and transport services. We build three integers. The first is the number of kindergartens within three hundred and fifty metres. The second is the number of childcare centres within the same radius. The third is the number of bus stops within three hundred and fifty metres which acts as a proxy for feeder service availability. These are simple and robust indicators that often improve model fit by capturing local intensity rather than only the nearest distance. Because all layers are already in EPSG 3414 metres, the buffer threshold is exact and reproducible.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>RADIUS_SHORT <span class="ot">&lt;-</span> <span class="dv">350</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNT_KINDER_350 =</span> <span class="fu">count_within_m</span>(geometry, kindergartens_pt, RADIUS_SHORT),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNT_CHILD_350  =</span> <span class="fu">count_within_m</span>(geometry, childcare_pt,     RADIUS_SHORT),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNT_BUS_350    =</span> <span class="fu">count_within_m</span>(geometry, busstop_pt,       RADIUS_SHORT)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>CNT_KINDER_350)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> int [1:8679] 1 1 1 2 1 2 1 1 0 0 ...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>CNT_CHILD_350)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> int [1:8679] 3 5 3 5 5 5 5 7 2 2 ...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>CNT_BUS_350)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> int [1:8679] 7 4 7 7 4 7 6 7 5 5 ...</code></pre>
</div>
</div>
</section>
<section id="primary-schools-within-one-kilometre" class="level4" data-number="6.3.11">
<h4 data-number="6.3.11" class="anchored" data-anchor-id="primary-schools-within-one-kilometre"><span class="header-section-number">6.3.11</span> Primary schools within one kilometre</h4>
<p>General access to basic education is best represented by the number of primary schools within a larger but still local catchment. We therefore compute an integer count of primary schools within one thousand metres of each flat. This measure captures broader choice sets and helps control for areas where many schools cluster. It complements the elite distance feature by distinguishing overall supply from prestige proximity. The value is easy to interpret in policy terms since it reads as the number of nearby schools reachable by a short ride or longer walk.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CNT_PRIMARY_1000 =</span> <span class="fu">count_within_m</span>(geometry, primary_pt, <span class="dv">1000</span>))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>CNT_PRIMARY_1000)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> int [1:8679] 3 2 3 2 2 2 3 3 2 2 ...</code></pre>
</div>
</div>
</section>
<section id="quick-compact-check" class="level4" data-number="6.3.12">
<h4 data-number="6.3.12" class="anchored" data-anchor-id="quick-compact-check"><span class="header-section-number">6.3.12</span> Quick compact check</h4>
<p>As a final sanity step for this section, we print a compact view of the new fields. This confirms types, units, and a few example values.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    HDBresale_sf,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    DIST_MRT_M, DIST_PARK_M, DIST_ELDERCARE_M, DIST_HAWKER_M,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    DIST_SUPERMKT_M, DIST_MALL_M, DIST_CBD_M, DIST_ELITEPRI_M,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    CNT_KINDER_350, CNT_CHILD_350, CNT_BUS_350, CNT_PRIMARY_1000, geometry</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 13
$ DIST_MRT_M       &lt;dbl&gt; 717.8940, 731.4224, 717.8940, 383.6496, 731.4224, 383â€¦
$ DIST_PARK_M      &lt;dbl&gt; 425.5483, 635.8962, 425.5483, 356.4783, 635.8962, 356â€¦
$ DIST_ELDERCARE_M &lt;dbl&gt; 259.7684, 254.9544, 259.7684, 397.6108, 254.9544, 397â€¦
$ DIST_HAWKER_M    &lt;dbl&gt; 388.7647, 381.4729, 388.7647, 132.0052, 381.4729, 132â€¦
$ DIST_SUPERMKT_M  &lt;dbl&gt; 284.9091, 314.4801, 284.9091, 186.2702, 314.4801, 186â€¦
$ DIST_MALL_M      &lt;dbl&gt; 756.2998, 652.1127, 756.2998, 959.9891, 652.1127, 959â€¦
$ DIST_CBD_M       &lt;dbl&gt; 8485.514, 8717.684, 8485.514, 9185.376, 8717.684, 918â€¦
$ DIST_ELITEPRI_M  &lt;dbl&gt; 2089.5384, 1389.9549, 2089.5384, 991.5717, 1389.9549,â€¦
$ CNT_KINDER_350   &lt;int&gt; 1, 1, 1, 2, 1, 2, 1, 1, 0, 0, 0, 0, 2, 1, 1, 1, 2, 1,â€¦
$ CNT_CHILD_350    &lt;int&gt; 3, 5, 3, 5, 5, 5, 5, 7, 2, 2, 2, 2, 4, 6, 5, 5, 5, 3,â€¦
$ CNT_BUS_350      &lt;int&gt; 7, 4, 7, 7, 4, 7, 6, 7, 5, 5, 5, 5, 6, 4, 4, 4, 7, 6,â€¦
$ CNT_PRIMARY_1000 &lt;int&gt; 3, 2, 3, 2, 2, 2, 3, 3, 2, 2, 2, 1, 2, 2, 2, 2, 2, 3,â€¦
$ geometry         &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 3851â€¦</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="exploratory-data-analysis-eda" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="exploratory-data-analysis-eda"><span class="header-section-number">7</span> Exploratory Data Analysis (EDA)</h2>
<section id="build-an-analysis-table" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="build-an-analysis-table"><span class="header-section-number">7.1</span> Build an analysis table</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure packages are loaded</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)          <span class="co"># data wrangling</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)             <span class="co"># spatial data</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)        <span class="co"># plotting</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sfdep)          <span class="co"># spatial weights and autocorrelation</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only four room transactions and select fields used in Section 6</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>analysis_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span>                                       <span class="co"># start from the prepared layer</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flat_type <span class="sc">==</span> <span class="st">"4 ROOM"</span>) <span class="sc">%&gt;%</span>                                   <span class="co"># enforce study scope</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">LOG_PRICE =</span> <span class="fu">log</span>(resale_price)) <span class="sc">%&gt;%</span>                           <span class="co"># add log price for normality</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(                                                             <span class="co"># keep only fields we will explore</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    LOG_PRICE,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    resale_price,</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    FLOOR_LEVEL,</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    REMAINING_LEASE_MTH,</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    AGE_2025,</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    DIST_CBD_M,</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    DIST_MRT_M,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    DIST_PARK_M,</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    DIST_ELDERCARE_M,</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    DIST_HAWKER_M,</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    DIST_SUPERMKT_M,</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    DIST_MALL_M,</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    DIST_ELITEPRI_M,</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    CNT_KINDER_350,</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    CNT_CHILD_350,</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    CNT_BUS_350,</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    CNT_PRIMARY_1000,</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>    geometry</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()                                                          <span class="co"># keep sf class explicitly</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="co"># quick integrity checks</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(analysis_sf, <span class="st">"sf"</span>))                                <span class="co"># must be simple features</span></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">st_crs</span>(analysis_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                           <span class="co"># must be in metres</span></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a><span class="co"># a handy vector of numeric predictor names for loops</span></span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>num_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FLOOR_LEVEL"</span>,<span class="st">"REMAINING_LEASE_MTH"</span>,<span class="st">"AGE_2025"</span>,</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIST_CBD_M"</span>,<span class="st">"DIST_MRT_M"</span>,<span class="st">"DIST_PARK_M"</span>,<span class="st">"DIST_ELDERCARE_M"</span>,</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIST_HAWKER_M"</span>,<span class="st">"DIST_SUPERMKT_M"</span>,<span class="st">"DIST_MALL_M"</span>,<span class="st">"DIST_ELITEPRI_M"</span>,</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CNT_KINDER_350"</span>,<span class="st">"CNT_CHILD_350"</span>,<span class="st">"CNT_BUS_350"</span>,<span class="st">"CNT_PRIMARY_1000"</span></span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="univariate-summaries-and-distributions" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="univariate-summaries-and-distributions"><span class="header-section-number">7.2</span> Univariate summaries and distributions</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print compact summaries for price and predictors</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">select</span>(<span class="fu">st_drop_geometry</span>(analysis_sf), LOG_PRICE, <span class="fu">all_of</span>(num_vars)))   <span class="co"># plain stats for a quick scan</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   LOG_PRICE      FLOOR_LEVEL    REMAINING_LEASE_MTH    AGE_2025    
 Min.   :12.61   Min.   : 2.00   Min.   : 485.0      Min.   : 4.00  
 1st Qu.:13.24   1st Qu.: 5.00   1st Qu.: 750.0      1st Qu.: 9.00  
 Median :13.35   Median : 8.00   Median : 910.0      Median :23.00  
 Mean   :13.39   Mean   : 9.29   Mean   : 916.1      Mean   :22.85  
 3rd Qu.:13.50   3rd Qu.:11.00   3rd Qu.:1080.0      3rd Qu.:37.00  
 Max.   :14.23   Max.   :50.00   Max.   :1144.0      Max.   :58.00  
   DIST_CBD_M      DIST_MRT_M       DIST_PARK_M      DIST_ELDERCARE_M
 Min.   : 1023   Min.   :  21.79   Min.   :  63.81   Min.   :   0.0  
 1st Qu.: 9881   1st Qu.: 286.93   1st Qu.: 458.13   1st Qu.: 339.8  
 Median :13202   Median : 519.71   Median : 684.68   Median : 663.4  
 Mean   :12516   Mean   : 586.66   Mean   : 758.61   Mean   : 824.8  
 3rd Qu.:15768   3rd Qu.: 793.65   3rd Qu.: 974.97   3rd Qu.:1145.1  
 Max.   :19874   Max.   :2120.10   Max.   :2205.03   Max.   :3282.3  
 DIST_HAWKER_M     DIST_SUPERMKT_M      DIST_MALL_M      DIST_ELITEPRI_M   
 Min.   :  25.35   Min.   :   0.0003   Min.   :  39.14   Min.   :   74.37  
 1st Qu.: 376.85   1st Qu.: 179.1599   1st Qu.: 378.70   1st Qu.: 1312.01  
 Median : 647.65   Median : 278.4398   Median : 600.73   Median : 2412.29  
 Mean   : 730.12   Mean   : 308.4312   Mean   : 664.70   Mean   : 3551.86  
 3rd Qu.: 961.37   3rd Qu.: 397.2718   3rd Qu.: 886.89   3rd Qu.: 4997.38  
 Max.   :2500.14   Max.   :1415.3217   Max.   :2446.77   Max.   :11490.86  
 CNT_KINDER_350   CNT_CHILD_350     CNT_BUS_350     CNT_PRIMARY_1000
 Min.   :0.0000   Min.   : 0.000   Min.   : 0.000   Min.   :0.000   
 1st Qu.:0.0000   1st Qu.: 3.000   1st Qu.: 6.000   1st Qu.:2.000   
 Median :1.0000   Median : 4.000   Median : 8.000   Median :3.000   
 Mean   :0.9289   Mean   : 4.653   Mean   : 7.985   Mean   :3.036   
 3rd Qu.:1.0000   3rd Qu.: 6.000   3rd Qu.:10.000   3rd Qu.:4.000   
 Max.   :8.0000   Max.   :19.000   Max.   :19.000   Max.   :9.000   </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># draw a histogram for log price</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(analysis_sf, <span class="fu">aes</span>(LOG_PRICE)) <span class="sc">+</span>                 <span class="co"># map column to x</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">40</span>) <span class="sc">+</span>                         <span class="co"># use many bins for detail</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of log price"</span>,           <span class="co"># plot title</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"log price"</span>, <span class="at">y =</span> <span class="st">"count"</span>) <span class="sc">+</span>                <span class="co"># axis labels</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()                                     <span class="co"># simple theme</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loop and draw histograms for each numeric predictor</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(v <span class="cf">in</span> num_vars){                                   <span class="co"># iterate over names</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(analysis_sf, <span class="fu">aes</span>(.data[[v]])) <span class="sc">+</span>         <span class="co"># aesthetic by name lookup</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">40</span>) <span class="sc">+</span>                       <span class="co"># histogram</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Distribution of"</span>, v),         <span class="co"># title per variable</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> v, <span class="at">y =</span> <span class="st">"count"</span>) <span class="sc">+</span>                        <span class="co"># labels</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()                                   <span class="co"># consistent theme</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)                                            <span class="co"># show the plot</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-42-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="simple-bivariate-relationships" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="simple-bivariate-relationships"><span class="header-section-number">7.3</span> Simple bivariate relationships</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation matrix for a quick numerical overview</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>cor_df <span class="ot">&lt;-</span> <span class="fu">select</span>(<span class="fu">st_drop_geometry</span>(analysis_sf), LOG_PRICE, <span class="fu">all_of</span>(num_vars))  <span class="co"># drop geometry for math</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>cor_mat <span class="ot">&lt;-</span> <span class="fu">cor</span>(cor_df, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)                         <span class="co"># pairwise correlations</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(cor_mat, <span class="dv">2</span>))                                                      <span class="co"># rounded for readability</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    LOG_PRICE FLOOR_LEVEL REMAINING_LEASE_MTH AGE_2025
LOG_PRICE                1.00        0.52                0.52    -0.52
FLOOR_LEVEL              0.52        1.00                0.30    -0.30
REMAINING_LEASE_MTH      0.52        0.30                1.00    -1.00
AGE_2025                -0.52       -0.30               -1.00     1.00
DIST_CBD_M              -0.60       -0.25                0.09    -0.09
DIST_MRT_M              -0.23       -0.11                0.03    -0.03
DIST_PARK_M             -0.17       -0.05                0.11    -0.11
DIST_ELDERCARE_M        -0.27       -0.13                0.03    -0.03
DIST_HAWKER_M           -0.26       -0.14                0.03    -0.03
DIST_SUPERMKT_M          0.00       -0.04                0.05    -0.04
DIST_MALL_M              0.01       -0.01               -0.08     0.09
DIST_ELITEPRI_M         -0.37       -0.13                0.12    -0.12
CNT_KINDER_350          -0.03        0.00               -0.16     0.16
CNT_CHILD_350           -0.04        0.02                0.02    -0.02
CNT_BUS_350             -0.08       -0.03                0.01    -0.01
CNT_PRIMARY_1000        -0.22       -0.10               -0.03     0.03
                    DIST_CBD_M DIST_MRT_M DIST_PARK_M DIST_ELDERCARE_M
LOG_PRICE                -0.60      -0.23       -0.17            -0.27
FLOOR_LEVEL              -0.25      -0.11       -0.05            -0.13
REMAINING_LEASE_MTH       0.09       0.03        0.11             0.03
AGE_2025                 -0.09      -0.03       -0.11            -0.03
DIST_CBD_M                1.00       0.17        0.34             0.40
DIST_MRT_M                0.17       1.00        0.09             0.11
DIST_PARK_M               0.34       0.09        1.00            -0.03
DIST_ELDERCARE_M          0.40       0.11       -0.03             1.00
DIST_HAWKER_M             0.34       0.01        0.12             0.13
DIST_SUPERMKT_M           0.02       0.18       -0.12             0.03
DIST_MALL_M              -0.23       0.34       -0.04             0.03
DIST_ELITEPRI_M           0.71       0.00        0.23             0.36
CNT_KINDER_350            0.00      -0.06        0.03             0.03
CNT_CHILD_350             0.11      -0.18        0.17            -0.02
CNT_BUS_350               0.18       0.00        0.13             0.02
CNT_PRIMARY_1000          0.26      -0.28        0.23            -0.08
                    DIST_HAWKER_M DIST_SUPERMKT_M DIST_MALL_M DIST_ELITEPRI_M
LOG_PRICE                   -0.26            0.00        0.01           -0.37
FLOOR_LEVEL                 -0.14           -0.04       -0.01           -0.13
REMAINING_LEASE_MTH          0.03            0.05       -0.08            0.12
AGE_2025                    -0.03           -0.04        0.09           -0.12
DIST_CBD_M                   0.34            0.02       -0.23            0.71
DIST_MRT_M                   0.01            0.18        0.34            0.00
DIST_PARK_M                  0.12           -0.12       -0.04            0.23
DIST_ELDERCARE_M             0.13            0.03        0.03            0.36
DIST_HAWKER_M                1.00           -0.03       -0.16            0.23
DIST_SUPERMKT_M             -0.03            1.00        0.21           -0.07
DIST_MALL_M                 -0.16            0.21        1.00           -0.27
DIST_ELITEPRI_M              0.23           -0.07       -0.27            1.00
CNT_KINDER_350               0.06           -0.12       -0.05           -0.05
CNT_CHILD_350                0.10           -0.24       -0.26            0.07
CNT_BUS_350                 -0.02           -0.09       -0.24            0.06
CNT_PRIMARY_1000             0.07           -0.18       -0.35            0.13
                    CNT_KINDER_350 CNT_CHILD_350 CNT_BUS_350 CNT_PRIMARY_1000
LOG_PRICE                    -0.03         -0.04       -0.08            -0.22
FLOOR_LEVEL                   0.00          0.02       -0.03            -0.10
REMAINING_LEASE_MTH          -0.16          0.02        0.01            -0.03
AGE_2025                      0.16         -0.02       -0.01             0.03
DIST_CBD_M                    0.00          0.11        0.18             0.26
DIST_MRT_M                   -0.06         -0.18        0.00            -0.28
DIST_PARK_M                   0.03          0.17        0.13             0.23
DIST_ELDERCARE_M              0.03         -0.02        0.02            -0.08
DIST_HAWKER_M                 0.06          0.10       -0.02             0.07
DIST_SUPERMKT_M              -0.12         -0.24       -0.09            -0.18
DIST_MALL_M                  -0.05         -0.26       -0.24            -0.35
DIST_ELITEPRI_M              -0.05          0.07        0.06             0.13
CNT_KINDER_350                1.00          0.47        0.07             0.03
CNT_CHILD_350                 0.47          1.00        0.24             0.32
CNT_BUS_350                   0.07          0.24        1.00             0.21
CNT_PRIMARY_1000              0.03          0.32        0.21             1.00</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter with smooth line for each predictor against log price</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(v <span class="cf">in</span> num_vars){                                                           <span class="co"># iterate over predictors</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(analysis_sf, <span class="fu">aes</span>(<span class="at">x =</span> .data[[v]], <span class="at">y =</span> LOG_PRICE)) <span class="sc">+</span>              <span class="co"># map x and y</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span>                                                <span class="co"># many points require transparency</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>                               <span class="co"># non parametric trend</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Log price versus"</span>, v),                                <span class="co"># title per plot</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> v, <span class="at">y =</span> <span class="st">"log price"</span>) <span class="sc">+</span>                                            <span class="co"># axis labels</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()                                                           <span class="co"># theme</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)                                                                    <span class="co"># show</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="first-spatial-views" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="first-spatial-views"><span class="header-section-number">7.4</span> First spatial views</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build five quantile groups for log price</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>analysis_sf<span class="sc">$</span>PRICE_Q5 <span class="ot">&lt;-</span> <span class="fu">cut</span>(analysis_sf<span class="sc">$</span>LOG_PRICE, <span class="at">breaks =</span> <span class="fu">quantile</span>(analysis_sf<span class="sc">$</span>LOG_PRICE, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)  <span class="co"># factor of quantiles</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># map price quantiles</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(analysis_sf) <span class="sc">+</span>                                         <span class="co"># start a map</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> PRICE_Q5), <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span>                <span class="co"># color points by quantile group</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span>                                                <span class="co"># keep the native projection</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Log price in five quantiles"</span>) <span class="sc">+</span>               <span class="co"># title</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()                                             <span class="co"># theme</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build five quantile groups for distance to CBD</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>analysis_sf<span class="sc">$</span>CBD_Q5 <span class="ot">&lt;-</span> <span class="fu">cut</span>(analysis_sf<span class="sc">$</span>DIST_CBD_M, <span class="at">breaks =</span> <span class="fu">quantile</span>(analysis_sf<span class="sc">$</span>DIST_CBD_M, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)  <span class="co"># factor of quantiles</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># map CBD distance quantiles</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(analysis_sf) <span class="sc">+</span>                                         <span class="co"># start a map</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> CBD_Q5), <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span>                  <span class="co"># color by CBD groups</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span>                                                <span class="co"># coordinates</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distance to CBD in five quantiles"</span>) <span class="sc">+</span>         <span class="co"># title</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()                                             <span class="co"># theme</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-44-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="distance-decay-checks-for-key-access-variables" class="level3" data-number="7.5">
<h3 data-number="7.5" class="anchored" data-anchor-id="distance-decay-checks-for-key-access-variables"><span class="header-section-number">7.5</span> Distance decay checks for key access variables</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># price versus CBD distance</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(analysis_sf, <span class="fu">aes</span>(DIST_CBD_M, LOG_PRICE)) <span class="sc">+</span>                <span class="co"># map variables</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span>                                      <span class="co"># many points require transparency</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>                    <span class="co"># non parametric fit</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span>                                        <span class="co"># add density cues</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Log price versus distance to CBD"</span>,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"distance to CBD in metres"</span>, <span class="at">y =</span> <span class="st">"log price"</span>) <span class="sc">+</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># price versus MRT distance</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(analysis_sf, <span class="fu">aes</span>(DIST_MRT_M, LOG_PRICE)) <span class="sc">+</span>                <span class="co"># map variables</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span>                                      <span class="co"># scatter</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>                    <span class="co"># smooth trend</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span>                                        <span class="co"># density</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Log price versus distance to nearest MRT exit"</span>,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"distance to MRT in metres"</span>, <span class="at">y =</span> <span class="st">"log price"</span>) <span class="sc">+</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-45-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>