<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="TAN Chin Khoon">
<meta name="dcterms.date" content="2025-11-16">

<title>Take-home Ex03 â€“ ISSS626</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ff63373b1067ca6f91cf1456aa1f00a2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ISSS626</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex09/Hand-on_Ex09">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex08/Hand-on_Ex08">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex07/Hand-on_Ex07">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex06/Hand-on_Ex06">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex05/Hand-on_Ex05b">
 <span class="dropdown-text">Hands-on Exercise 5b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex05/Hand-on_Ex05a">
 <span class="dropdown-text">Hands-on Exercise 5a</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex04/Hand-on_Ex04">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex03/Hand-on_Ex03">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex02/Hand-on_Ex02">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex01/Hand-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../In-Class_Ex10/in-class_ex10">
 <span class="dropdown-text">In-class Exercise 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex09/in-class_ex09">
 <span class="dropdown-text">In-class Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex08/in-class_ex08">
 <span class="dropdown-text">In-class Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex07/in-class_ex07">
 <span class="dropdown-text">In-class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex06/in-class_ex06">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex05/in-class_ex05b">
 <span class="dropdown-text">In-class Exercise 5b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex05/in-class_ex05">
 <span class="dropdown-text">In-class Exercise 5a</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex04/in-class_ex04">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex03b/in-class_Ex03b">
 <span class="dropdown-text">In-class Exercise 3b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-Class_Ex03/in-class_Ex03a">
 <span class="dropdown-text">In-class Exercise 3a</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../Take-home_Ex02/take-home_ex02">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Take-home_Ex01/take-home_ex01">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tanchinkhoon/"> <i class="bi bi-linkedin" role="img" aria-label="Linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tanchinkhoon/ISSS626_Hands-on_Ex"> <i class="bi bi-github" role="img" aria-label="Github">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Ex03</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>TAN Chin Khoon </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 16, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">November 16, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<p><img src="HDB.png" class="img-fluid"></p>
<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>This study examines the determinants of Housing and Development Board resale prices in Singapore using an explanatory spatial modelling framework. We focus on <strong>4</strong> room flats during 1 January 2025 to 30 September 2025 to maintain comparability and reflect current family preferences for this size category (Renovation Contractor Singapore, 2025). The objective is to identify structural and locational attributes associated with transaction prices and to reveal how those associations vary across space. Structural variables include floor area in square meters, floor level, age in years, and remaining lease in years. Locational variables include proximity to rail transit, parks and open space, primary schools including selected high performing schools, childcare and preschool supply, supermarkets, shopping malls, and bus stops. Count variables are computed within 350 meters and 1,000 meters buffers, and point to point proximity is measured in meters after projecting all layers to SVY21. The remainder of this report states the research questions, documents reproducible data preparation, specifies the global and geographically weighted models, and presents spatially explicit findings with concise implications.</p>
</section>
<section id="research-questions" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="research-questions"><span class="header-section-number">2</span> Research Questions</h2>
<p>This section states operational questions that guide an explanatory analysis of HDB resale prices for 4-room flats from 1 January 2025 to 30 September 2025. The questions align variable construction, model calibration, and interpretation with the objective of identifying price drivers and their spatial variation using a global Multiple Linear Regression baseline and a local geographically weighted model.</p>
<p><strong>RQ1</strong>: Which structural attributes of a flat such as floor area, floor level, age, and remaining lease are significantly associated with resale price during the study window</p>
<p><strong>RQ2</strong>: Which locational attributes such as proximity to rail transit, parks, primary schools, childcare supply, supermarkets, shopping malls, and bus stops are significantly associated with resale price</p>
<p><strong>RQ3</strong>: To what extent do these associations vary across space, as evidenced by spatially varying coefficients from a geographically weighted model</p>
<p><strong>RQ4</strong>: Does the geographically weighted model materially improve fit and residual behaviour relative to a global Multiple Linear Regression specification</p>
<p><strong>RQ5</strong>: Where are local effects notably stronger or weaker, and what practical implications follow for buyers, valuers, and planners</p>
<p>Together these questions structure the analytical framework and ensure direct alignment between the study objectives and subsequent methods.</p>
</section>
<section id="the-data" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="the-data"><span class="header-section-number">3</span> The Data</h2>
<p>In this section, we document every dataset used to construct a transparent, auditable, and fully reproducible sandbox for explanatory modelling of HDB resale prices. The unit of analysis is individual transactions for <strong>4 room flats</strong> within <strong>1 January 2025 to 30 September 2025</strong>. The core input is the official Resale Flat Prices table. All other layers are supporting geographic data used strictly to engineer the required structural and location variables. To make verification straightforward, sources are presented in a compact 4 column table that lists the dataset name, its modelling purpose, the file format, and a direct source link. All spatial layers are ingested as simple features and projected to SVY21 EPSG 3414 so distance and buffer computations are expressed in meters. Where an application programming interface is involved, we will cache responses to local files to allow repeated runs without network variance.</p>
<div class="cell">
<div class="cell-output-display">
<table class="lightable-classic caption-top table table-sm table-striped small">
<caption>Table 1 Data sources used in Take home Ex03</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Dataset</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Purposes</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Format</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">HDB Resale Flat Prices 2017 Onward</td>
<td style="text-align: left;">Core transactions filtered to 4 rooms and study window</td>
<td style="text-align: left;">CSV</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_8b84c4ee58e3cfc0ece0d773c8ca6abc/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">URA Master Plan 2019 Subzone Boundary No Sea</td>
<td style="text-align: left;">Map context and optional mainland mask</td>
<td style="text-align: left;">KML</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_0900fdcfdb4666fe2a630f37a532fc06/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">MRT Stations</td>
<td style="text-align: left;">Transit proximity</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://datamall.lta.gov.sg/content/dam/datamall/datasets/Geospatial/TrainStation_Aug2025.zip" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Parks</td>
<td style="text-align: left;">Green space proximity</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_0542d48f0991541706b58059381a6eca/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Eldercare Services</td>
<td style="text-align: left;">Eldercare proximity</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets?query=eldercare&amp;resultId=d_3545b068e3f3506c56b2cb6b6117b884" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Hawker centre</td>
<td style="text-align: left;">Food services proximity</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets?query=Hawker&amp;resultId=d_4a086da0a5553be1d89383cd90d07ecd" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Supermarkets</td>
<td style="text-align: left;">Supermarket proximity</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets?query=supermarket&amp;resultId=d_cac2c32f01960a3ad7202a99c27268a0" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Shopping Malls</td>
<td style="text-align: left;">Retail centre proximity</td>
<td style="text-align: left;">CSV</td>
<td style="text-align: left;"><a href="https://www.kaggle.com/datasets/karthikgangula/shopping-mall-coordinates?resource=download" target="_blank">kaggle</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">General Information of School</td>
<td style="text-align: left;">Elite school proximity within 1 km</td>
<td style="text-align: left;">CSV</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_688b934f82c1059ed0a6993d2a829089/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Childcare Centres</td>
<td style="text-align: left;">Childcare counts within 350 meters</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_5d668e3f544335f8028f546827b773b4/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kindergartens</td>
<td style="text-align: left;">Kindergarten counts within 350 meters</td>
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;"><a href="https://data.gov.sg/datasets/d_7fe9a72b1afff18e48111772c8d0fd39/view" target="_blank">data.gov.sg</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Bus Stops</td>
<td style="text-align: left;">Bus stop counts within 350 meters</td>
<td style="text-align: left;">SHP</td>
<td style="text-align: left;"><a href="https://datamall.lta.gov.sg/content/dam/datamall/datasets/Geospatial/BusStopLocation_Aug2025.zip" target="_blank">Land Transport DataMall</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">CBD Reference</td>
<td style="text-align: left;">Reference for CBD distance</td>
<td style="text-align: left;">Point or Polygon</td>
<td style="text-align: left;">TO SUPPLY</td>
</tr>
<tr class="even">
<td style="text-align: left;">OneMap Geocoding Service</td>
<td style="text-align: left;">Address/Postcode to coordinate lookup</td>
<td style="text-align: left;">API JSON</td>
<td style="text-align: left;"><a href="https://www.onemap.gov.sg/docs/" target="_blank">OneMap</a></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="setup-the-environment" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="setup-the-environment"><span class="header-section-number">4</span> Setup the Environment</h2>
<p>A consistent analytical environment ensures reproducibility and transparency in spatial data analysis. This section defines the R environment used in the study. All scripts were executed in RStudio using packages that support data wrangling, spatial statistics and visualisation. The pacman package is used to automate installation and loading of required libraries. Each library serves a specific purpose within the analytical workflow, and a random seed is set to guarantee consistent statistical outputs across repeated runs.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure the package manager is available</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pacman)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)  <span class="co"># install pacman once if missing</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load all required libraries in one call</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  tidyverse,    <span class="co"># data wrangling and plotting</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  sf,           <span class="co"># spatial vector data handling</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  GWmodel,      <span class="co"># geographically weighted modelling</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  sfdep,        <span class="co"># spatial diagnostics used in the report</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  tmap,         <span class="co"># cartographic maps (static and interactive)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  ggplot2,      <span class="co"># grammar of graphics for charts</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  httr,         <span class="co"># HTTP requests for geocoding if used</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  jsonlite,     <span class="co"># parsing JSON responses</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  progress,     <span class="co"># simple progress bars for batch jobs</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  knitr,        <span class="co"># report tables</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  kableExtra,   <span class="co"># table styling for HTML output</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  purrr,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  stringr,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  Hmisc,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  ggpubr,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  gtsummary,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  RColorBrewer, </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  see,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  performance,  <span class="co"># used to test multicollinearity.</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  olsrr,        <span class="co"># building OLS and performing diagnostics tests </span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  qqplotr,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  corrplot      <span class="co"># multivariate data visualisation and analysis</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggstatsplot</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># set reproducibility and friendly numeric printing</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">626</span>)                       <span class="co"># fixed seed for repeatable results</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)   <span class="co"># keep character columns as character</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)               <span class="co"># print numbers without scientific notation</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="geocoding-for-geometric" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="geocoding-for-geometric"><span class="header-section-number">5</span> Geocoding for Geometric</h2>
<p>This section turns two aspatial sources, HDB Resale Flat Prices 2017 Onward and General Information of School, into spatial features for analysis. For HDB transactions, we filter to <strong>4-room flats</strong> between <strong>1 Jan 2025 and 30 Sep 2025</strong>, standardise street names, geocode addresses with OneMap, cache results, and convert to <strong>sf</strong> points in WGS84 before transforming to SVY21 (EPSG 3414, Transverse Mercator) so distances are in meters. For schools, we keep only Primary level entries, normalise and de-duplicate 6-digit postcodes, query OneMap by postcode, then join X, Y coordinates and convert directly to SVY21 since OneMap returns SVY21 coordinates for postal lookups. The outputs are two clean spatial objects: <code>HDBresale_sf</code> and <code>primary_schools_sf</code>, ready for Section 6 where we will engineer proximity and count variables (for example, 350 meters buffers and 1,000 meters counts) and integrate the amenity layers.</p>
<section id="geocoding-hdb-resale-transactions-by-addresses" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="geocoding-hdb-resale-transactions-by-addresses"><span class="header-section-number">5.1</span> Geocoding HDB resale transactions by addresses</h3>
<p>We filter 4 room transactions in the study window, tidy street tokens for better matches, geocode each unique address with OneMap, cache results, join coordinates, build POINT geometry, reproject to EPSG 3414, validate, and save.</p>
<section id="load-and-filter-to-study-window-and-flat-type" class="level4" data-number="5.1.1">
<h4 data-number="5.1.1" class="anchored" data-anchor-id="load-and-filter-to-study-window-and-flat-type"><span class="header-section-number">5.1.1</span> Load and filter to study window and flat type</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load resale table</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>HDBresale_raw <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/aspatial/ResaleflatpricesbasedonregistrationdatefromJan2017onwards.csv"</span>)   <span class="co"># read CSV</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to 4 room and window 2025 01 to 2025 09</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>HDBresale <span class="ot">&lt;-</span> HDBresale_raw <span class="sc">%&gt;%</span>                           <span class="co"># start pipeline</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(flat_type <span class="sc">==</span> <span class="st">"4 ROOM"</span>) <span class="sc">%&gt;%</span>               <span class="co"># keep 4 room</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2025-01"</span>, month <span class="sc">&lt;=</span> <span class="st">"2025-09"</span>)  <span class="co"># keep study months</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="normalise-street-tokens" class="level4" data-number="5.1.2">
<h4 data-number="5.1.2" class="anchored" data-anchor-id="normalise-street-tokens"><span class="header-section-number">5.1.2</span> Normalise street tokens</h4>
<p>Light token fixes improve geocoding hit-rate.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># normalise street tokens for better match rate before calling OneMap</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>HDBresale<span class="sc">$</span>street_name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"ST</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"SAINT"</span>, HDBresale<span class="sc">$</span>street_name)  <span class="co"># expand ST. to SAINT</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="define-onemap-address-geocoder-with-caching" class="level4" data-number="5.1.3">
<h4 data-number="5.1.3" class="anchored" data-anchor-id="define-onemap-address-geocoder-with-caching"><span class="header-section-number">5.1.3</span> Define OneMap address geocoder with caching</h4>
<p>Call OneMap once per unique address; cache results to CSV.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to call OneMap elastic search and return first LAT LON</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>geocode_addr <span class="ot">&lt;-</span> <span class="cf">function</span>(block, streetname) {                                       <span class="co"># define function</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="st">"https://onemap.gov.sg/api/common/elastic/search"</span>                          <span class="co"># endpoint</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">searchVal =</span> <span class="fu">paste</span>(block, streetname),                                   <span class="co"># query text</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">returnGeom =</span> <span class="st">"Y"</span>, <span class="at">getAddrDetails =</span> <span class="st">"N"</span>, <span class="at">pageNum =</span> <span class="st">"1"</span>)                  <span class="co"># parameters</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  txt <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(httr<span class="sc">::</span><span class="fu">GET</span>(url, <span class="at">query =</span> q), <span class="at">as =</span> <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)  <span class="co"># request and read</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  js  <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(txt)                                                    <span class="co"># parse JSON</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(js<span class="sc">$</span>results) <span class="sc">==</span> <span class="dv">0</span>)                                                      <span class="co"># case no result</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">LATITUDE =</span> <span class="cn">NA_real_</span>, <span class="at">LONGITUDE =</span> <span class="cn">NA_real_</span>))               <span class="co"># return NA coords</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">LATITUDE =</span> <span class="fu">as.numeric</span>(js<span class="sc">$</span>results<span class="sc">$</span>LATITUDE[<span class="dv">1</span>]),                     <span class="co"># numeric lat</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">LONGITUDE =</span> <span class="fu">as.numeric</span>(js<span class="sc">$</span>results<span class="sc">$</span>LONGITUDE[<span class="dv">1</span>]))                   <span class="co"># numeric lon</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># build or reload cache of unique address to coordinates</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># path to the cache file</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>cache_path <span class="ot">&lt;-</span> <span class="st">"data/aspatial/geocode_hdb_cache.csv"</span> <span class="co"># csv cache for address results</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(cache_path)) {                      <span class="co"># use cache if it exists</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  hdb_cache <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(cache_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)   <span class="co"># load cached coordinates</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {                                            <span class="co"># otherwise build the cache now</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  uniq_addr <span class="ot">&lt;-</span> HDBresale <span class="sc">%&gt;%</span>                        <span class="co"># start from filtered HDB table</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(block, street_name)             <span class="co"># keep unique block street pairs</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  pb <span class="ot">&lt;-</span> progress<span class="sc">::</span>progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> <span class="fu">nrow</span>(uniq_addr)) <span class="co"># progress indicator</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  hdb_cache <span class="ot">&lt;-</span> uniq_addr <span class="sc">%&gt;%</span>                        <span class="co"># begin cache pipeline</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(                                  <span class="co"># add a list column named geo</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">geo =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(                            <span class="co"># call function for each pair</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        block,                                      <span class="co"># first argument is block</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        street_name,                                <span class="co"># second argument is street name</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(.x, .y) {                          <span class="co"># inline function wrapper</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>          pb<span class="sc">$</span><span class="fu">tick</span>()                                 <span class="co"># advance the progress bar</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geocode_addr</span>(.x, .y)                      <span class="co"># call OneMap geocoder and return tibble</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span>                                           <span class="co"># end mutate and continue pipe</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(geo))                    <span class="co"># expand LATITUDE and LONGITUDE columns</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">write_csv</span>(hdb_cache, cache_path)           <span class="co"># save cache to disk for reuse</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="enforce-one-record-per-address-and-join-coordinates" class="level4" data-number="5.1.4">
<h4 data-number="5.1.4" class="anchored" data-anchor-id="enforce-one-record-per-address-and-join-coordinates"><span class="header-section-number">5.1.4</span> Enforce one record per address and join coordinates</h4>
<p>Bind LATITUDE, LONGITUDE, convert to WGS84 points, then to SVY21 (TM).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep one coordinate per address and ensure numeric</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>hdb_cache_fixed <span class="ot">&lt;-</span> hdb_cache <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">LATITUDE =</span> <span class="fu">as.numeric</span>(LATITUDE), <span class="at">LONGITUDE =</span> <span class="fu">as.numeric</span>(LONGITUDE)) <span class="sc">%&gt;%</span>  <span class="co"># numeric</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(LATITUDE), <span class="sc">!</span><span class="fu">is.na</span>(LONGITUDE)) <span class="sc">%&gt;%</span>                                 <span class="co"># drop NA rows</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(block, street_name) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">ungroup</span>()  <span class="co"># one per pair</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># attach coordinates to filtered HDB table</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>HDBresale_geo <span class="ot">&lt;-</span> HDBresale <span class="sc">%&gt;%</span>                                      <span class="co"># base table</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(hdb_cache_fixed, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"block"</span>,<span class="st">"street_name"</span>))  <span class="co"># join LAT LON</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="create-point-geometry-and-validate" class="level4" data-number="5.1.5">
<h4 data-number="5.1.5" class="anchored" data-anchor-id="create-point-geometry-and-validate"><span class="header-section-number">5.1.5</span> Create POINT geometry and validate</h4>
<p>Verify the geometry output by using <code>glimpse()</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build sf points in WGS 84 then transform to SVY21 EPSG 3414</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_geo <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>,<span class="st">"LATITUDE"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span>    <span class="co"># create POINT</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">3414</span>)                                              <span class="co"># project to 3414</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># validate type and reference system</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(HDBresale_sf)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:3414 
  wkt:
PROJCRS["SVY21 / Singapore TM",
    BASEGEOGCRS["SVY21",
        DATUM["SVY21",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4757]],
    CONVERSION["Singapore Transverse Mercator",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",1.36666666666667,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",103.833333333333,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",1,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",28001.642,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",38744.572,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["northing (N)",north,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["easting (E)",east,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Cadastre, engineering survey, topographic mapping."],
        AREA["Singapore - onshore and offshore."],
        BBOX[1.13,103.59,1.47,104.07]],
    ID["EPSG",3414]]</code></pre>
</div>
</div>
</section>
</section>
<section id="geocoding-schools-by-postcodes" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="geocoding-schools-by-postcodes"><span class="header-section-number">5.2</span> Geocoding schools by postcodes</h3>
<p>We filter to PRIMARY level, standardise 6 digit postcodes, query OneMap by postcode to obtain X and Y in SVY21, keep one result per code, join to the table, convert to POINT, validate EPSG 3414, and save.</p>
<section id="load-and-keep-primary-level" class="level4" data-number="5.2.1">
<h4 data-number="5.2.1" class="anchored" data-anchor-id="load-and-keep-primary-level"><span class="header-section-number">5.2.1</span> Load and keep primary level</h4>
<p>Read the table and filter <code>mainlevel_code == "PRIMARY"</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read school table and keep primary level</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/aspatial/Generalinformationofschools.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>primary_schools <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(schools, mainlevel_code <span class="sc">==</span> <span class="st">"PRIMARY"</span>)                            </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># standardise 6 digit postcodes</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>primary_schools <span class="ot">&lt;-</span> primary_schools <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">postal_code =</span> stringr<span class="sc">::</span><span class="fu">str_pad</span>(postal_code, <span class="dv">6</span>, <span class="at">pad =</span> <span class="st">"0"</span>))  <span class="co"># pad</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="onemap-postcode-lookup-and-clean" class="level4" data-number="5.2.2">
<h4 data-number="5.2.2" class="anchored" data-anchor-id="onemap-postcode-lookup-and-clean"><span class="header-section-number">5.2.2</span> OneMap postcode lookup and clean</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># query OneMap by postcode to get X Y in SVY21</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>om_url <span class="ot">&lt;-</span> <span class="st">"https://onemap.gov.sg/api/common/elastic/search"</span>                              <span class="co"># endpoint</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>postcodes <span class="ot">&lt;-</span> <span class="fu">unique</span>(primary_schools<span class="sc">$</span>postal_code)                                         <span class="co"># unique codes</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>found_xy <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>()                                                             <span class="co"># holder</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pc <span class="cf">in</span> postcodes) {                                                                  <span class="co"># loop codes</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">searchVal =</span> pc, <span class="at">returnGeom =</span> <span class="st">"Y"</span>, <span class="at">getAddrDetails =</span> <span class="st">"Y"</span>, <span class="at">pageNum =</span> <span class="st">"1"</span>)       <span class="co"># params</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  js <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(httr<span class="sc">::</span><span class="fu">GET</span>(om_url, <span class="at">query =</span> q))                                      <span class="co"># request parse</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(js<span class="sc">$</span>found) <span class="sc">&amp;&amp;</span> js<span class="sc">$</span>found <span class="sc">&gt;</span> <span class="dv">0</span>) {                                              <span class="co"># keep matches</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(js<span class="sc">$</span>results, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)                            <span class="co"># to data frame</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    found_xy <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(found_xy, tibble<span class="sc">::</span><span class="fu">as_tibble</span>(df[, <span class="fu">c</span>(<span class="st">"POSTAL"</span>,<span class="st">"X"</span>,<span class="st">"Y"</span>)])) <span class="co"># keep fields</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># coerce and keep one row per code</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>found_xy_clean <span class="ot">&lt;-</span> found_xy <span class="sc">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">POSTAL =</span> <span class="fu">as.character</span>(POSTAL), <span class="at">X =</span> <span class="fu">as.numeric</span>(X), <span class="at">Y =</span> <span class="fu">as.numeric</span>(Y)) <span class="sc">%&gt;%</span> <span class="co"># numeric</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(X), <span class="sc">!</span><span class="fu">is.na</span>(Y)) <span class="sc">%&gt;%</span>                                                <span class="co"># drop NA</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(POSTAL) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">ungroup</span>()              <span class="co"># one per code</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="join-coordinates-and-build-point-geometry" class="level4" data-number="5.2.3">
<h4 data-number="5.2.3" class="anchored" data-anchor-id="join-coordinates-and-build-point-geometry"><span class="header-section-number">5.2.3</span> Join coordinates and build POINT geometry</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attach X Y to school table</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>primary_schools_xy <span class="ot">&lt;-</span> primary_schools <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(found_xy_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"postal_code"</span> <span class="ot">=</span> <span class="st">"POSTAL"</span>))                       <span class="co"># join coords</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf POINT in SVY21</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>primary_schools_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(primary_schools_xy, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"X"</span>,<span class="st">"Y"</span>), <span class="at">crs =</span> <span class="dv">3414</span>)    <span class="co"># build POINT</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># validate geometry and reference system</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(primary_schools_sf)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:3414 
  wkt:
PROJCRS["SVY21 / Singapore TM",
    BASEGEOGCRS["SVY21",
        DATUM["SVY21",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4757]],
    CONVERSION["Singapore Transverse Mercator",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",1.36666666666667,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",103.833333333333,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",1,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",28001.642,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",38744.572,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["northing (N)",north,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["easting (E)",east,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Cadastre, engineering survey, topographic mapping."],
        AREA["Singapore - onshore and offshore."],
        BBOX[1.13,103.59,1.47,104.07]],
    ID["EPSG",3414]]</code></pre>
</div>
</div>
</section>
</section>
<section id="persist-clean-spatial-tables" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="persist-clean-spatial-tables"><span class="header-section-number">5.3</span> Persist clean spatial tables</h3>
<p>We save both sf objects to RDS for reuse. This avoids repeated API calls and guarantees consistent inputs for the next section.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save both objects for downstream steps</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(HDBresale_sf, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"data/rds/HDBresale_sf.rds"</span>)       <span class="co"># geocoded HDB</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(primary_schools_sf, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"data/rds/primary_schools_sf.rds"</span>) <span class="co"># geocoded schools</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="predictors-preprocessing-and-wrangling" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="predictors-preprocessing-and-wrangling"><span class="header-section-number">6</span> Predictors Preprocessing and Wrangling</h2>
<p>This section prepares every predictor that will feed into the modelling phase. We start from our geocoded HDBresale_sf which already contains POINT geometry in EPSG 3414 SVY21 meters and covers the window from 2025-01 to 2025-09. The structural predictors transform raw strings into numeric features that a model can use directly. Remaining lease is parsed into number of months. Storey range is converted into a single floor level by averaging the lower and upper level. Age of unit is computed from lease commence year against the reference year 2025. For location predictors we strictly follow the kick starter pattern. All target layers are POINTS in EPSG 3414. If a source is polygon or multipolygon we create a safe interior point with st_point_on_surface and drop any Z or M dimensions. For proximity we compute two styles when relevant. First, a continuous distance in meters to the nearest feature. Second, a within buffer count where the requirement asks for numbers within 350 meters or 1 000 meters. Every step below is short, repeatable, and fully commented for beginners.</p>
<section id="structural-predictors" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="structural-predictors"><span class="header-section-number">6.1</span> Structural predictors</h3>
<section id="remaining-lease-in-months" class="level4" data-number="6.1.1">
<h4 data-number="6.1.1" class="anchored" data-anchor-id="remaining-lease-in-months"><span class="header-section-number">6.1.1</span> Remaining lease in months</h4>
<p>We need a numeric predictor for the time left on each lease so that models can read it directly. The source field Remaining lease is plain text such as â€œ56 years 03 monthsâ€ or sometimes simply â€œ52 yearsâ€. The code below does four things. First, it makes sure our HDB table is available as an sf POINT layer in EPSG 3414, loading the saved RDS if needed or building POINTs from latitude and longitude if that is what we currently have. Second, it validates that geometry is POINT and the reference system is SVY21 meters. Third, it parses the text into two integers, years and months, with missing months treated as zero. Fourth, it computes the final integer REMAINING_LEASE_MTH and drops the temporary helpers. The result is a tidy numeric feature that is ready for joins and modelling, and we also get a quick compact check that confirms type and a small sample.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure we have an sf POINT layer named HDBresale_sf in EPSG 3414</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"HDBresale_sf"</span>)) {                            <span class="co"># create if not present</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">"data/rds/HDBresale_sf.rds"</span>)) {         <span class="co"># load saved object</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    HDBresale_sf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/HDBresale_sf.rds"</span>)  <span class="co"># read rds</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"HDBresale_geo"</span>)) {                   <span class="co"># else use geocoded table</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    HDBresale_sf <span class="ot">&lt;-</span> HDBresale_geo                         <span class="co"># assign geocoded</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {                                                <span class="co"># nothing found</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"HDBresale_sf was not found and no source is available"</span>) <span class="co"># stop with message</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf if needed using LATITUDE and LONGITUDE then project to 3414</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(HDBresale_sf, <span class="st">"sf"</span>)) {      <span class="co"># not an sf yet</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"LONGITUDE"</span>,<span class="st">"LATITUDE"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(HDBresale_sf))) <span class="co"># require coords</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  HDBresale_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(           <span class="co"># build geometry</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    HDBresale_sf,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>,<span class="st">"LATITUDE"</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4326</span>                            <span class="co"># WGS 84 degrees</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">3414</span>)                <span class="co"># convert to SVY21 meters</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># validate geometry type and reference system</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(HDBresale_sf) <span class="sc">==</span> <span class="st">"POINT"</span>)) <span class="co"># geometry must be POINT</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(HDBresale_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)              <span class="co"># CRS must be 3414</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># helper that converts one text like "56 years 03 months" to total months</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>parse_rl_to_months <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {   <span class="co"># define helper</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  txt <span class="ot">&lt;-</span> <span class="fu">tolower</span>(x)                   <span class="co"># normalise case</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  yr  <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.integer</span>(<span class="fu">str_extract</span>(txt, <span class="st">"</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">s*year)"</span>)))   <span class="co"># pull years</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  mo  <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.integer</span>(<span class="fu">str_extract</span>(txt, <span class="st">"</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">s*month)"</span>)))  <span class="co"># pull months</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  yr  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(yr), <span class="dv">0</span>L, yr)    <span class="co"># missing years to zero</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  mo  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(mo), <span class="dv">0</span>L, mo)    <span class="co"># missing months to zero</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="dv">12</span>L <span class="sc">*</span> yr <span class="sc">+</span> mo                       <span class="co"># return total months</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the numeric feature</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span>      <span class="co"># start transform</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">REMAINING_LEASE_MTH =</span> <span class="fu">parse_rl_to_months</span>(remaining_lease) <span class="co"># new integer field</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="co"># compact checks and a quick peek</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(HDBresale_sf<span class="sc">$</span>REMAINING_LEASE_MTH))       <span class="co"># must be numeric</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(                                               <span class="co"># show a compact view</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(HDBresale_sf, remaining_lease, REMAINING_LEASE_MTH, geometry)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 3
$ remaining_lease     &lt;chr&gt; "56 years 03 months", "86 years 09 months", "56 yeâ€¦
$ REMAINING_LEASE_MTH &lt;int&gt; 675, 1041, 674, 624, 1040, 624, 613, 614, 1039, 10â€¦
$ geometry            &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 3â€¦</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(HDBresale_sf, remaining_lease, REMAINING_LEASE_MTH), <span class="dv">5</span>)  <span class="co"># first rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 28566.05 ymin: 38360.76 xmax: 30036.29 ymax: 38861.93
Projected CRS: SVY21 / Singapore TM
# A tibble: 5 Ã— 3
  remaining_lease    REMAINING_LEASE_MTH            geometry
  &lt;chr&gt;                            &lt;int&gt;         &lt;POINT [m]&gt;
1 56 years 03 months                 675 (30036.29 38360.76)
2 86 years 09 months                1041 (29283.45 38517.37)
3 56 years 02 months                 674 (30036.29 38360.76)
4 52 years                           624 (28566.05 38861.93)
5 86 years 08 months                1040 (29283.45 38517.37)</code></pre>
</div>
</div>
</section>
<section id="floor-level-from-storey-range" class="level4" data-number="6.1.2">
<h4 data-number="6.1.2" class="anchored" data-anchor-id="floor-level-from-storey-range"><span class="header-section-number">6.1.2</span> Floor level from storey range</h4>
<p>We average the two numbers inside storey_range. Non numeric and missing cases are handled safely and leave NA.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start from the existing sf table                                               </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(HDBresale_sf, <span class="st">"sf"</span>))                <span class="co"># must be an sf object   </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(HDBresale_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)       <span class="co"># confirm EPSG 3414      </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute average floor level from ranges like "04 TO 06"                        </span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span>                      </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(                                       </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.rng =</span> stringr<span class="sc">::</span><span class="fu">str_extract_all</span>(storey_range, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="co"># grab all numbers  </span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.low =</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.integer</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(.rng, dplyr<span class="sc">::</span>first))),    <span class="co"># first</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.high =</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.integer</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(.rng, dplyr<span class="sc">::</span>last))),    <span class="co"># last </span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FLOOR_LEVEL =</span> <span class="fu">as.numeric</span>(.low <span class="sc">+</span> .high) <span class="sc">/</span> <span class="dv">2</span>                                  <span class="co"># average</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span>                                                                          </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>.rng, <span class="sc">-</span>.low, <span class="sc">-</span>.high)                                           <span class="co"># drop helpers</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># quick checks                                                                    </span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(HDBresale_sf<span class="sc">$</span>FLOOR_LEVEL) <span class="sc">|</span> <span class="fu">is.na</span>(HDBresale_sf<span class="sc">$</span>FLOOR_LEVEL)) <span class="co"># numeric or NA</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(HDBresale_sf, storey_range, FLOOR_LEVEL, geometry))  <span class="co"># preview</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 3
$ storey_range &lt;chr&gt; "13 TO 15", "10 TO 12", "10 TO 12", "07 TO 09", "28 TO 30â€¦
$ FLOOR_LEVEL  &lt;dbl&gt; 14, 11, 11, 8, 29, 5, 11, 5, 17, 17, 5, 8, 11, 5, 2, 11, â€¦
$ geometry     &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 38517.37â€¦</code></pre>
</div>
</div>
</section>
<section id="age-of-the-unit-in-years" class="level4" data-number="6.1.3">
<h4 data-number="6.1.3" class="anchored" data-anchor-id="age-of-the-unit-in-years"><span class="header-section-number">6.1.3</span> Age of the unit in years</h4>
<p>e compute Age as 2025 minus lease_commence_date. Negative or missing values are set to NA.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute Age using the stated analysis year                                      </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>analysis_year <span class="ot">&lt;-</span> <span class="dv">2025</span>              <span class="co"># set current analysis year</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span>   <span class="co"># continue same table      </span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(                                     </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">AGE_2025 =</span> <span class="fu">suppressWarnings</span>(   <span class="co"># new numeric field        </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(analysis_year <span class="sc">-</span> <span class="fu">as.integer</span>(lease_commence_date))                </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    ),                                                                          </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">AGE_2025 =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(AGE_2025 <span class="sc">&gt;=</span> <span class="dv">0</span>, AGE_2025, <span class="fu">as.numeric</span>(<span class="cn">NA</span>))      <span class="co"># guard</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># validate                                                                         </span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(HDBresale_sf<span class="sc">$</span>AGE_2025) <span class="sc">|</span> <span class="fu">is.na</span>(HDBresale_sf<span class="sc">$</span>AGE_2025)) <span class="co"># numeric or NA</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(HDBresale_sf, lease_commence_date, AGE_2025, geometry)) <span class="co"># preview</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 3
$ lease_commence_date &lt;dbl&gt; 1982, 2012, 1982, 1978, 2012, 1978, 1977, 1977, 20â€¦
$ AGE_2025            &lt;dbl&gt; 43, 13, 43, 47, 13, 47, 48, 48, 13, 13, 49, 49, 47â€¦
$ geometry            &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 3â€¦</code></pre>
</div>
</div>
</section>
<section id="structural-predictors-ready" class="level4" data-number="6.1.4">
<h4 data-number="6.1.4" class="anchored" data-anchor-id="structural-predictors-ready"><span class="header-section-number">6.1.4</span> Structural predictors ready</h4>
<p>At this point, our structural predictors are present on HDBresale_sf as REMAINING_LEASE_MTH, FLOOR_LEVEL, and AGE_2025.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># final compact view of structural fields                                          </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(HDBresale_sf, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                             REMAINING_LEASE_MTH, FLOOR_LEVEL, AGE_2025, geometry))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 4
$ REMAINING_LEASE_MTH &lt;int&gt; 675, 1041, 674, 624, 1040, 624, 613, 614, 1039, 10â€¦
$ FLOOR_LEVEL         &lt;dbl&gt; 14, 11, 11, 8, 29, 5, 11, 5, 17, 17, 5, 8, 11, 5, â€¦
$ AGE_2025            &lt;dbl&gt; 43, 13, 43, 47, 13, 47, 48, 48, 13, 13, 49, 49, 47â€¦
$ geometry            &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 3â€¦</code></pre>
</div>
</div>
</section>
</section>
<section id="preparing-target-layers-for-location-factors" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="preparing-target-layers-for-location-factors"><span class="header-section-number">6.2</span> Preparing target layers for location factors</h3>
<p>All location sources must be POINTS in EPSG 3414. We create a function that reads any vector file, sets CRS if missing, projects to 3414, converts polygons to safe interior points, and drops Z or M if present. We then prepare the exact layers as listed: MRT stations as GeoJSON, eldercare, hawker centres, parks, kindergartens, childcare centres, supermarkets, bus stops, primary schools, and shopping malls. Primary schools use the geocoded POINTS saved in Section 5. For elite schools we filter a named list. For counts we will reuse the prepared primary schools for the one kilometer radius. For CBD we read a user supplied vector file and convert to a single point using the interior point of the union. If a file is missing the code stops with a clear message so that we can place the file before continuing.</p>
<section id="function-and-global-checks" class="level4" data-number="6.2.1">
<h4 data-number="6.2.1" class="anchored" data-anchor-id="function-and-global-checks"><span class="header-section-number">6.2.1</span> Function and global checks</h4>
<p>Before preparing any single layer, we define a function that reads a vector dataset, normalises its coordinate reference system, and guarantees a POINT result. This keeps every later subsection short and predictable. The function accepts common formats such as GeoJSON, Shapefile, KML, and GPKG through <code>sf::st_read</code>. If a source comes in with Z or M dimensions, those are dropped since our analysis is two dimensional in meters. If the input geometry is not a POINT, we safely convert to an interior point which always falls inside each feature. Finally we project to EPSG 3414 so distances are in meters. We also confirm our HDB layer is an sf POINT in EPSG 3414.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to read any vector file and return POINTS in EPSG 3414</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>read_as_points_3414 <span class="ot">&lt;-</span> <span class="cf">function</span>(path, <span class="at">assume_epsg =</span> <span class="cn">NULL</span>) {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(path))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if CRS is missing, set it without transforming</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(g)<span class="sc">$</span>epsg)) {</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.null</span>(assume_epsg))         <span class="co"># we must be told what it is</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_set_crs</span>(g, assume_epsg)      <span class="co"># &lt;â€” use st_set_crs(), no warning</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(g, <span class="dv">3414</span>)             <span class="co"># project to meters</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_zm</span>(g, <span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">"ZM"</span>)<span class="co"># drop Z/M if present</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(g) <span class="sc">==</span> <span class="st">"POINT"</span>)) {</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_point_on_surface</span>(g) <span class="sc">|&gt;</span>       <span class="co"># safe interior point</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>         sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  g</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for CSVs with lon and lat columns</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>read_csv_points_3414 <span class="ot">=</span> <span class="cf">function</span>(path, lon, lat, <span class="at">crs_in =</span> <span class="dv">4326</span>) {</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(path))                              <span class="co"># csv must exist</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)        <span class="co"># read csv</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">c</span>(lon, lat) <span class="sc">%in%</span> <span class="fu">names</span>(df)))                <span class="co"># require columns</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(df, <span class="at">coords =</span> <span class="fu">c</span>(lon, lat), <span class="at">crs =</span> crs_in)  <span class="co"># build points</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(g, <span class="dv">3414</span>)                             <span class="co"># project to meters</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  g                                                         <span class="co"># return points</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="co"># confirm HDB layer is ready</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(HDBresale_sf, <span class="st">"sf"</span>))                       <span class="co"># must be sf</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(HDBresale_sf) <span class="sc">==</span> <span class="st">"POINT"</span>)) <span class="co"># must be points</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(HDBresale_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)              <span class="co"># must be 3414</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="mrt-station-exits-from-geojson" class="level4" data-number="6.2.2">
<h4 data-number="6.2.2" class="anchored" data-anchor-id="mrt-station-exits-from-geojson"><span class="header-section-number">6.2.2</span> MRT station exits from GeoJSON</h4>
<p>Transit proximity is a key location factor. Our Table 1 in Section 3 states that the MRT station source is GeoJSON. We therefore load the MRT exits GeoJSON, discard any elevation or measure values, and ensure the coordinates are in EPSG 3414 so that all nearest distance calculations return values in meters. A simple <code>glimpse()</code> confirms that the result contains only POINT geometry.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read MRT exits GeoJSON and prepare POINTS in 3414</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>mrt_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/LTAMRTStationExitGEOJSON.geojson"</span>)  <span class="co"># read and convert</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(mrt_pt, <span class="st">"sf"</span>))                         <span class="co"># must be sf</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(mrt_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))   <span class="co"># must be points</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(mrt_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                <span class="co"># meters</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and validation</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mrt_pt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 597
Columns: 5
$ OBJECTID   &lt;int&gt; 14641, 14642, 14643, 14644, 14645, 14646, 14647, 14648, 146â€¦
$ EXIT_CODE  &lt;chr&gt; "Exit A", "Exit A", "Exit A", "Exit A", "Exit A", "Exit A",â€¦
$ INC_CRC    &lt;chr&gt; "45CDB0D9BDC73079", "54BFE6EB924CBA6F", "A324402CF624723A",â€¦
$ FMEL_UPD_D &lt;chr&gt; "20231019120510", "20231019120510", "20231019120510", "2023â€¦
$ geometry   &lt;POINT [m]&gt; POINT (20361.05 40974.54), POINT (20887.79 41082.76),â€¦</code></pre>
</div>
</div>
</section>
<section id="primary-schools-and-elite-subset" class="level4" data-number="6.2.3">
<h4 data-number="6.2.3" class="anchored" data-anchor-id="primary-schools-and-elite-subset"><span class="header-section-number">6.2.3</span> Primary schools and elite subset</h4>
<p>Elite school proximity uses the same school geocodes we already created in Section 5. We load the prepared RDS <code>primary_schools_sf.rds</code>, confirm EPSG 3414 and POINT geometry, then build a filtered view containing only the 20 elite schools specified. This subset will be used to compute continuous distance to the nearest elite school point and also optional counts within buffers if needed. Keeping both the full set and the elite subset in memory gives flexibility for later features such as count of any primary school within one kilometer and distance to the nearest elite school. A quick print confirms the expected number of rows.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load prepared primary schools points from our RDS</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>primary_schools_sf <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/primary_schools_sf.rds"</span>) <span class="co"># load points</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(primary_schools_sf, <span class="st">"sf"</span>))                           <span class="co"># must be sf</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(primary_schools_sf) <span class="sc">==</span> <span class="st">"POINT"</span>))     <span class="co"># must be points</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(primary_schools_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                  <span class="co"># meters</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to elite schools list</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>elite_names <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NANYANG PRIMARY SCHOOL"</span>,<span class="st">"TAO NAN SCHOOL"</span>,<span class="st">"HONG WEN SCHOOL"</span>,<span class="st">"NAN HUA PRIMARY SCHOOL"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ST. HILDA'S PRIMARY SCHOOL"</span>,<span class="st">"HENRY PARK PRIMARY SCHOOL"</span>,<span class="st">"ANGLO-CHINESE SCHOOL (PRIMARY)"</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RAFFLES GIRLS' PRIMARY SCHOOL"</span>,<span class="st">"PEI HWA PRESBYTERIAN PRIMARY SCHOOL"</span>,<span class="st">"RADIN MAS PRIMARY SCHOOL"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ROSYTH SCHOOL"</span>,<span class="st">"KONG HWA SCHOOL"</span>,<span class="st">"POI CHING SCHOOL"</span>,<span class="st">"HOLY INNOCENTS' PRIMARY SCHOOL"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AI TONG SCHOOL"</span>,<span class="st">"RED SWASTIKA SCHOOL"</span>,<span class="st">"MAHA BODHI SCHOOL"</span>,<span class="st">"RULANG PRIMARY SCHOOL"</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PEI CHUN PUBLIC SCHOOL"</span>,<span class="st">"SINGAPORE CHINESE GIRLS' PRIMARY SCHOOL"</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>elite_primary_sf <span class="ot">=</span> primary_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(school_name <span class="sc">%in%</span> elite_names)   <span class="co"># keep elite only</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(elite_primary_sf)                          <span class="co"># confirm row count</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
</div>
</section>
<section id="kindergartens-geojson" class="level4" data-number="6.2.4">
<h4 data-number="6.2.4" class="anchored" data-anchor-id="kindergartens-geojson"><span class="header-section-number">6.2.4</span> Kindergartens GeoJSON</h4>
<p>Counts of kindergartens within a local radius offer a proxy for family oriented amenities. The dataset in the project folder is a GeoJSON. We read it with the helper, which ensures every record becomes a POINT in EPSG 3414 with Z and M removed. We store the prepared layer as <code>kindergartens_pt</code>. This layer will be used to compute the number of locations inside a radius around each HDB resale point, for example within 350 meters. The preparation step does not aggregate or filter because the raw count requires the complete set. A short check confirms geometry and projection are correct.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read kindergartens as points</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>kindergartens_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/Kindergartens.geojson"</span>) <span class="co"># prepare layer</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(kindergartens_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))   <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="childcare-centres-geojson" class="level4" data-number="6.2.5">
<h4 data-number="6.2.5" class="anchored" data-anchor-id="childcare-centres-geojson"><span class="header-section-number">6.2.5</span> Childcare centres GeoJSON</h4>
<p>Childcare centres will be counted within a three hundred and fifty meter radius per HDB resale observation. The input format is GeoJSON according to our directory. We load the file with the helper so that geometry is POINT, projection is SVY21 meters, and extra dimensions are removed. We keep the data as is without filters, since the later count requires complete coverage. A simple <code>glimpse()</code> appears after the code so that we can verify the feature count and the geometry column. This prepared layer is named <code>childcare_pt</code> and is used later to compute the required counts column.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read childcare centres as points</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>childcare_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/ChildCareServices.geojson"</span>) <span class="co"># prepare layer</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(childcare_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                   <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="bus-stops-shapefile" class="level4" data-number="6.2.6">
<h4 data-number="6.2.6" class="anchored" data-anchor-id="bus-stops-shapefile"><span class="header-section-number">6.2.6</span> Bus stops Shapefile</h4>
<p>We will read the feature class <code>BusStop.shp</code>. Shapefiles often carry mixed attributes and sometimes include Z or M. The helper removes those and converts any non point geometry to a stable interior point. After projection to EPSG 3414, the prepared layer supports both nearest distance and counts within a three hundred and fifty meter radius. This is important because bus networks are dense and small geometric errors can change counts near buffer edges. The result is stored as <code>busstop_pt</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>busstop_pt <span class="ot">&lt;-</span> <span class="fu">read_as_points_3414</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/geospatial/BusStopLocation_Aug2025/BusStop.shp"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">assume_epsg =</span> <span class="dv">3414</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(busstop_pt, <span class="st">"sf"</span>))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(busstop_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(busstop_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(busstop_pt, geometry))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,172
Columns: 1
$ geometry &lt;POINT [m]&gt; POINT (35565.66 41659.52), POINT (21439.91 31253.63), Pâ€¦</code></pre>
</div>
</div>
</section>
<section id="eldercare-geojson" class="level4" data-number="6.2.7">
<h4 data-number="6.2.7" class="anchored" data-anchor-id="eldercare-geojson"><span class="header-section-number">6.2.7</span> Eldercare GeoJSON</h4>
<p>Eldercare proximity measures access to aged care services. The source file is GeoJSON. We treat it the same way as the previous categories. The prepared layer is <code>eldercare_pt</code> which holds POINT geometry in meters. Later sections will compute continuous nearest distance from each HDB resale observation to the nearest eldercare site. That feature will be named following the pattern we set earlier. The code below ensures that the geometry types are consistent which helps prevent confusing errors during distance calculations or spatial joins.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read eldercare services as points</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>eldercare_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/EldercareServices.geojson"</span>)     <span class="co"># prepare layer</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(eldercare_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                       <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="hawker-centres-geojson" class="level4" data-number="6.2.8">
<h4 data-number="6.2.8" class="anchored" data-anchor-id="hawker-centres-geojson"><span class="header-section-number">6.2.8</span> Hawker centres GeoJSON</h4>
<p>Food access through hawker centres is an essential amenity. The input is GeoJSON. We load and normalise with the helper and hold the result as POINTs in EPSG 3414. This prepared layer will support the continuous distance feature, usually named proximity to hawker. Because later analysis may also examine counts of food places within a given radius, we keep every record without filtering. The checks at the bottom confirm geometry and projection which keeps later computations safe and repeatable.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read hawker centres as points</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>hawker_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/HawkerCentresGEOJSON.geojson"</span>)    <span class="co"># prepare layer</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(hawker_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                         <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="parks-geojson" class="level4" data-number="6.2.9">
<h4 data-number="6.2.9" class="anchored" data-anchor-id="parks-geojson"><span class="header-section-number">6.2.9</span> Parks GeoJSON</h4>
<p>Green space proximity is derived from the parks layer. Some parks are polygons. The helper converts these to interior points so that nearest distance behaves as expected even for large irregular shapes. The layer is stored in meters which allows clean thresholds if we decide to add a within buffer count later. The code below reads the file, converts geometry if necessary, and performs simple validity checks. The prepared object is named <code>parks_pt</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read parks and convert to points</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>parks_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/Parks.geojson"</span>)   <span class="co"># prepare layer</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(parks_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))         <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="shopping-malls-csv" class="level4" data-number="6.2.10">
<h4 data-number="6.2.10" class="anchored" data-anchor-id="shopping-malls-csv"><span class="header-section-number">6.2.10</span> Shopping malls CSV</h4>
<p>We read the CSV and build POINT geometry from those two columns. The default source reference for such files is usually WGS84, so we assign EPSG 4326 and then project to EPSG 3414. After preparation, nearest distance and within buffer counts are straightforward. The code names the resulting object <code>mall_pt</code> and runs the same geometry and projection checks as the other sections so everything remains consistent across features.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read shopping mall coordinates from CSV and build points</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>mall_pt <span class="ot">=</span> <span class="fu">read_csv_points_3414</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"data/geospatial/shopping_mall_coordinates.csv"</span>,    <span class="co"># csv path</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lon  =</span> <span class="st">"LONGITUDE"</span>,                                        <span class="co"># name of longitude column</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat  =</span> <span class="st">"LATITUDE"</span>,                                         <span class="co"># name of latitude column</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs_in =</span> <span class="dv">4326</span>                                              <span class="co"># source is WGS84</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(mall_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))     <span class="co"># confirm points</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(mall_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                  <span class="co"># meters</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="supermarkets-geojson" class="level4" data-number="6.2.11">
<h4 data-number="6.2.11" class="anchored" data-anchor-id="supermarkets-geojson"><span class="header-section-number">6.2.11</span> Supermarkets GeoJSON</h4>
<p>Supermarket coverage is prepared exactly like hawker and eldercare. We use the helper to read the GeoJSON, transform to meters, and convert any footprint polygons to interior points. The resulting layer <code>supermarket_pt</code> supports both continuous distance and within buffer counts if needed. As with all other layers, we store the prepared set without additional filters so feature engineering in later sections can proceed without surprises. The code includes quick checks to ensure geometry and projection are correct.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read supermarkets as points</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>supermarket_pt <span class="ot">=</span> <span class="fu">read_as_points_3414</span>(<span class="st">"data/geospatial/SupermarketsGEOJSON.geojson"</span>) <span class="co"># prepare</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(supermarket_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))                     <span class="co"># confirm points</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cbd-point-from-master-plan-subzones" class="level4" data-number="6.2.12">
<h4 data-number="6.2.12" class="anchored" data-anchor-id="cbd-point-from-master-plan-subzones"><span class="header-section-number">6.2.12</span> CBD point from Master Plan subzones</h4>
<p>CBD proximity uses the DOWNTOWN CORE planning area from the master plan subzones we prepared earlier. We load <code>mpsz_cl.rds</code>, filter to DOWNTOWN CORE, dissolve to a single geometry, and convert the polygon to a safe interior point. This produces a single POINT named <code>cbd_pt</code> in EPSG 3414. Later sections compute the straight line distance from each HDB resale observation to this point and store that feature in meters. The conversion to an interior point avoids centroid outside issues for complex shapes, which keeps distances stable.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load master plan subzones and create a CBD reference point</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/mpsz_cl.rds"</span>)           <span class="co"># load polygons</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(mpsz)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)                 <span class="co"># meters</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>cbd_poly <span class="ot">=</span> mpsz <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(PLN_AREA_N <span class="sc">==</span> <span class="st">"DOWNTOWN CORE"</span>) <span class="sc">%&gt;%</span>       <span class="co"># select area</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_union</span>()                                         <span class="co"># dissolve</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>cbd_pt <span class="ot">=</span> cbd_poly <span class="sc">%&gt;%</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_point_on_surface</span>() <span class="sc">%&gt;%</span>                          <span class="co"># interior point</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">3414</span>)                               <span class="co"># as sf with crs</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(cbd_pt) <span class="sc">==</span> <span class="st">"POINT"</span>))  <span class="co"># confirm point</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="save-prepared-layers-for-repeatable-use" class="level4" data-number="6.2.13">
<h4 data-number="6.2.13" class="anchored" data-anchor-id="save-prepared-layers-for-repeatable-use"><span class="header-section-number">6.2.13</span> Save prepared layers for repeatable use</h4>
<p>To make later sections fast and deterministic, we save each prepared POINT layer as an RDS file under the data rds folder. This avoids re reading and re projecting each time the notebook runs. The saved objects are ready for joins, distance computation, and within buffer counts. The names follow a clear pattern so that we can reload any single layer by name. If we update a source file in the future, simply rerun the corresponding subsection and the saved RDS will refresh.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save every prepared layer to RDS for quick reuse</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(mrt_pt,           <span class="st">"data/rds/mrt_pt.rds"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(primary_schools_sf,<span class="st">"data/rds/primary_schools_pt.rds"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(elite_primary_sf,  <span class="st">"data/rds/elite_primary_pt.rds"</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(kindergartens_pt,  <span class="st">"data/rds/kindergartens_pt.rds"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(childcare_pt,      <span class="st">"data/rds/childcare_pt.rds"</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(busstop_pt,        <span class="st">"data/rds/busstop_pt.rds"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(eldercare_pt,      <span class="st">"data/rds/eldercare_pt.rds"</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(hawker_pt,         <span class="st">"data/rds/hawker_pt.rds"</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(parks_pt,          <span class="st">"data/rds/parks_pt.rds"</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(mall_pt,           <span class="st">"data/rds/mall_pt.rds"</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(supermarket_pt,    <span class="st">"data/rds/supermarket_pt.rds"</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(cbd_pt,            <span class="st">"data/rds/cbd_pt.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="location-predictors" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="location-predictors"><span class="header-section-number">6.3</span> Location predictors</h3>
<p>We compute exactly the predictors requested. Distances are nearest neighbour distances in meters using <code>st_nearest_feature</code> and <code>st_distance</code> with by element equal TRUE. Counts use <code>st_is_within_distance</code> with the required radius - We use names CNT_350M_KINDER, CNT_350M_CHILDCARE, CNT_350M_BUS, and CNT_1KM_PRIMARY for clarity. Diagnostics verify that the new fields are in the correct type and that the layer remains POINT in EPSG 3414. At the end, we show a compact glimpse of the new columns and write an updated RDS so later sections can load the prepared table immediately.</p>
<section id="helpers-used-by-all-location-predictors" class="level4" data-number="6.3.1">
<h4 data-number="6.3.1" class="anchored" data-anchor-id="helpers-used-by-all-location-predictors"><span class="header-section-number">6.3.1</span> Helpers used by all location predictors</h4>
<p>To keep every later step short, reliable, and readable, we first define two tiny helpers. The first computes a nearest distance from every HDB point to the closest target point. It uses a nearest neighbour index so the work scales well even with several thousand features. The function guards that both layers are in the same projected system so the output is in meters. The second helper counts how many target points fall inside a circular buffer around each HDB point. It uses a fast predicate that returns logical relations, then converts those relations into simple integer counts. With these two helpers in place, every later subsection is a one or two line call that is easy to audit and reproduce.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all layers must be POINT and EPSG 3414 before we call these</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>nearest_distance_m <span class="ot">&lt;-</span> <span class="cf">function</span>(from_pt, to_pt) {</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(from_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>, sf<span class="sc">::</span><span class="fu">st_crs</span>(to_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_nearest_feature</span>(from_pt, to_pt)    <span class="co"># index of nearest target</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  d   <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_distance</span>(from_pt, to_pt[idx, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(d)                                    <span class="co"># meters</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>count_within_m <span class="ot">&lt;-</span> <span class="cf">function</span>(from_pt, to_pt, radius_m) {</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(from_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>, sf<span class="sc">::</span><span class="fu">st_crs</span>(to_pt)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  rel <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_is_within_distance</span>(from_pt, to_pt, <span class="at">dist =</span> radius_m)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vapply</span>(rel, length, <span class="fu">integer</span>(<span class="dv">1</span>))                  <span class="co"># integer counts</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># convenience: load all prepared target layers once</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>mrt_pt          <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/mrt_pt.rds"</span>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>parks_pt        <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/parks_pt.rds"</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>eldercare_pt    <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/eldercare_pt.rds"</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>hawker_pt       <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/hawker_pt.rds"</span>)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>supermarket_pt  <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/supermarket_pt.rds"</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>mall_pt         <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/mall_pt.rds"</span>)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>kindergartens_pt<span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/kindergartens_pt.rds"</span>)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>childcare_pt    <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/childcare_pt.rds"</span>)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>busstop_pt      <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/busstop_pt.rds"</span>)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>primary_pt      <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/primary_schools_pt.rds"</span>)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>elite_primary_pt<span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/elite_primary_pt.rds"</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>cbd_pt          <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"data/rds/cbd_pt.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="proximity-to-mrt-stations" class="level4" data-number="6.3.2">
<h4 data-number="6.3.2" class="anchored" data-anchor-id="proximity-to-mrt-stations"><span class="header-section-number">6.3.2</span> Proximity to MRT stations</h4>
<p>Access to rail transit is a well known driver of residential prices in compact cities. Distance to the nearest station approximates expected walk time, first mile effort, and overall transit convenience. We compute a single continuous feature in meters from each flat to its closest MRT exit. Using exits rather than line segments avoids ambiguity from long station footprints and guarantees a sensible origin for walking access. Values near zero mean the block is beside an exit, and larger values reflect locations that require a longer walk or an intermediate bus connection. This continuous metric works well in both global and local models and is straightforward to interpret.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_MRT_M =</span> <span class="fu">nearest_distance_m</span>(geometry, mrt_pt))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection </span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_MRT_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 718 731 718 384 731 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-parks" class="level4" data-number="6.3.3">
<h4 data-number="6.3.3" class="anchored" data-anchor-id="proximity-to-parks"><span class="header-section-number">6.3.3</span> Proximity to parks</h4>
<p>Green space can influence prices by improving neighborhood comfort, providing recreation, and raising perceived environmental quality. We treat the park layer as a set of access points. For polygonal parks, we already converted to interior points in the preparation step to avoid edges and holes. We now compute a continuous metric in meters from each flat to the nearest park access point. The interpretation is similar to the transit feature. Smaller values indicate ready access to open space which can be especially valuable in dense estates. The feature is robust since it uses a direct nearest neighbour distance in a projected meter system.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_PARK_M =</span> <span class="fu">nearest_distance_m</span>(geometry, parks_pt))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_PARK_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 426 636 426 356 636 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-eldercare-services" class="level4" data-number="6.3.4">
<h4 data-number="6.3.4" class="anchored" data-anchor-id="proximity-to-eldercare-services"><span class="header-section-number">6.3.4</span> Proximity to eldercare services</h4>
<p>Eldercare access matters to multi-generational households and can be reflected in housing choices. We measure straight line distance from each transaction to the closest registered eldercare service. While travel time would be ideal, Euclidean distance in a small city is a strong proxy once layers are in a meter based projection. The feature can capture both convenience and localized supply. In later diagnostics, we can examine whether this variable has stronger effects in towns with older blocks or where family structures produce higher demand for caregiving services.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_ELDERCARE_M =</span> <span class="fu">nearest_distance_m</span>(geometry, eldercare_pt))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_ELDERCARE_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 260 255 260 398 255 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-hawker-centres" class="level4" data-number="6.3.5">
<h4 data-number="6.3.5" class="anchored" data-anchor-id="proximity-to-hawker-centres"><span class="header-section-number">6.3.5</span> Proximity to hawker centres</h4>
<p>Food access is a daily need. Hawker centres provide affordable options and are commonly used reference points for walkable amenities. We add a continuous distance in meters to the nearest hawker centre point. This variable complements the supermarket feature because the two cover different price tiers and operating hours. If we wish to explore threshold effects later, we can also build indicator variables for within a short walking distance. For now, the continuous measure keeps models simple and comparable across towns.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_HAWKER_M =</span> <span class="fu">nearest_distance_m</span>(geometry, hawker_pt))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_HAWKER_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 389 381 389 132 381 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-supermarkets" class="level4" data-number="6.3.6">
<h4 data-number="6.3.6" class="anchored" data-anchor-id="proximity-to-supermarkets"><span class="header-section-number">6.3.6</span> Proximity to supermarkets</h4>
<p>Supermarkets indicate stable food supply and often co locate with other services such as pharmacies and financial services. We compute the distance to the nearest supermarket point. The variable captures everyday convenience that families value when selecting a flat. It can also proxy for local retail vitality. Be aware that this feature sometimes correlates with shopping mall distance in central areas, so we will check variance inflation later. For now we keep it as a straightforward continuous measure that is easy to explain to a non technical audience.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_SUPERMKT_M =</span> <span class="fu">nearest_distance_m</span>(geometry, supermarket_pt))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_SUPERMKT_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 285 314 285 186 314 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-shopping-malls" class="level4" data-number="6.3.7">
<h4 data-number="6.3.7" class="anchored" data-anchor-id="proximity-to-shopping-malls"><span class="header-section-number">6.3.7</span> Proximity to shopping malls</h4>
<p>Regional and town centre malls bundle retail, dining, and services in one place. Proximity can raise perceived convenience and social activity. Our mall layer comes from a table with latitude and longitude that was converted to points and projected to meters earlier. We now compute a single nearest distance feature. Remember that this is a straight line proxy. If we later have access to a street network, the same helper can be swapped for a travel time routine without changing the structure of the model script.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_MALL_M =</span> <span class="fu">nearest_distance_m</span>(geometry, mall_pt))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_MALL_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 756 652 756 960 652 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-the-cbd-reference-point" class="level4" data-number="6.3.8">
<h4 data-number="6.3.8" class="anchored" data-anchor-id="proximity-to-the-cbd-reference-point"><span class="header-section-number">6.3.8</span> Proximity to the CBD reference point</h4>
<p>The central business district concentrates high wage employment and premium services. Distance to that centre is often a strong global gradient in price models. we created a stable CBD reference by dissolving the Downtown Core planning area and converting it to a safe interior point. We now measure a continuous distance from every flat to this single reference. The value helps the model separate broad city wide trends from local amenity effects. In later maps of local coefficients, we can observe where the CBD gradient weakens or strengthens relative to neighbourhood factors.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_CBD_M =</span> <span class="fu">nearest_distance_m</span>(geometry, cbd_pt))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_CBD_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 8486 8718 8486 9185 8718 ...</code></pre>
</div>
</div>
</section>
<section id="proximity-to-elite-primary-schools" class="level4" data-number="6.3.9">
<h4 data-number="6.3.9" class="anchored" data-anchor-id="proximity-to-elite-primary-schools"><span class="header-section-number">6.3.9</span> Proximity to elite primary schools</h4>
<p>School prestige can affect price expectations for families with young children. We already derived an elite subset with twenty schools from the full primary list. We compute a continuous distance to the nearest elite school point. This gives a clear and interpretable number in meters that can be compared across towns. In later robustness checks, we may also include the distance to the nearest ordinary primary school to differentiate general access from prestige access. For now we focus on the prestige signal since that is more likely to be reflected in marginal willingness to pay.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DIST_ELITEPRI_M =</span> <span class="fu">nearest_distance_m</span>(geometry, elite_primary_pt))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>DIST_ELITEPRI_M)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:8679] 2090 1390 2090 992 1390 ...</code></pre>
</div>
</div>
</section>
<section id="amenity-counts-within-350-meters" class="level4" data-number="6.3.10">
<h4 data-number="6.3.10" class="anchored" data-anchor-id="amenity-counts-within-350-meters"><span class="header-section-number">6.3.10</span> Amenity counts within 350 meters</h4>
<p>Counts within a short walking radius capture micro scale density of child related and transport services. We build three integers. The first is the number of kindergartens within 350 meters. The second is the number of childcare centres within the same radius. The third is the number of bus stops within 350 meters which acts as a proxy for feeder service availability. These are simple and robust indicators that often improve model fit by capturing local intensity rather than only the nearest distance. Because all layers are already in EPSG 3414 meters, the buffer threshold is exact and reproducible.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>RADIUS_SHORT <span class="ot">&lt;-</span> <span class="dv">350</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNT_KINDER_350 =</span> <span class="fu">count_within_m</span>(geometry, kindergartens_pt, RADIUS_SHORT),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNT_CHILD_350  =</span> <span class="fu">count_within_m</span>(geometry, childcare_pt,     RADIUS_SHORT),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNT_BUS_350    =</span> <span class="fu">count_within_m</span>(geometry, busstop_pt,       RADIUS_SHORT)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>CNT_KINDER_350)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> int [1:8679] 1 1 1 2 1 2 1 1 0 0 ...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>CNT_CHILD_350)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> int [1:8679] 3 5 3 5 5 5 5 7 2 2 ...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>CNT_BUS_350)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> int [1:8679] 7 4 7 7 4 7 6 7 5 5 ...</code></pre>
</div>
</div>
</section>
<section id="primary-schools-within-1-kilometer" class="level4" data-number="6.3.11">
<h4 data-number="6.3.11" class="anchored" data-anchor-id="primary-schools-within-1-kilometer"><span class="header-section-number">6.3.11</span> Primary schools within 1 kilometer</h4>
<p>General access to basic education is best represented by the number of primary schools within a larger but still local catchment. We therefore compute an integer count of primary schools within one thousand meters of each flat. This measure captures broader choice sets and helps control for areas where many schools cluster. It complements the elite distance feature by distinguishing overall supply from prestige proximity. The value is easy to interpret in policy terms since it reads as the number of nearby schools reachable by a short ride or longer walk.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>HDBresale_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CNT_PRIMARY_1000 =</span> <span class="fu">count_within_m</span>(geometry, primary_pt, <span class="dv">1000</span>))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check and inspection</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HDBresale_sf<span class="sc">$</span>CNT_PRIMARY_1000)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> int [1:8679] 3 2 3 2 2 2 3 3 2 2 ...</code></pre>
</div>
</div>
</section>
<section id="quick-compact-check" class="level4" data-number="6.3.12">
<h4 data-number="6.3.12" class="anchored" data-anchor-id="quick-compact-check"><span class="header-section-number">6.3.12</span> Quick compact check</h4>
<p>As a final sanity step for this section, we print a compact view of the new fields. This confirms types, units, and a few example values.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    HDBresale_sf,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    DIST_MRT_M, DIST_PARK_M, DIST_ELDERCARE_M, DIST_HAWKER_M,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    DIST_SUPERMKT_M, DIST_MALL_M, DIST_CBD_M, DIST_ELITEPRI_M,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    CNT_KINDER_350, CNT_CHILD_350, CNT_BUS_350, CNT_PRIMARY_1000, geometry</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 13
$ DIST_MRT_M       &lt;dbl&gt; 717.8940, 731.4224, 717.8940, 383.6496, 731.4224, 383â€¦
$ DIST_PARK_M      &lt;dbl&gt; 425.5483, 635.8962, 425.5483, 356.4783, 635.8962, 356â€¦
$ DIST_ELDERCARE_M &lt;dbl&gt; 259.7684, 254.9544, 259.7684, 397.6108, 254.9544, 397â€¦
$ DIST_HAWKER_M    &lt;dbl&gt; 388.7647, 381.4729, 388.7647, 132.0052, 381.4729, 132â€¦
$ DIST_SUPERMKT_M  &lt;dbl&gt; 284.9091, 314.4801, 284.9091, 186.2702, 314.4801, 186â€¦
$ DIST_MALL_M      &lt;dbl&gt; 756.2998, 652.1127, 756.2998, 959.9891, 652.1127, 959â€¦
$ DIST_CBD_M       &lt;dbl&gt; 8485.514, 8717.684, 8485.514, 9185.376, 8717.684, 918â€¦
$ DIST_ELITEPRI_M  &lt;dbl&gt; 2089.5384, 1389.9549, 2089.5384, 991.5717, 1389.9549,â€¦
$ CNT_KINDER_350   &lt;int&gt; 1, 1, 1, 2, 1, 2, 1, 1, 0, 0, 0, 0, 2, 1, 1, 1, 2, 1,â€¦
$ CNT_CHILD_350    &lt;int&gt; 3, 5, 3, 5, 5, 5, 5, 7, 2, 2, 2, 2, 4, 6, 5, 5, 5, 3,â€¦
$ CNT_BUS_350      &lt;int&gt; 7, 4, 7, 7, 4, 7, 6, 7, 5, 5, 5, 5, 6, 4, 4, 4, 7, 6,â€¦
$ CNT_PRIMARY_1000 &lt;int&gt; 3, 2, 3, 2, 2, 2, 3, 3, 2, 2, 2, 1, 2, 2, 2, 2, 2, 3,â€¦
$ geometry         &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 3851â€¦</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="exploratory-data-analysis-eda" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="exploratory-data-analysis-eda"><span class="header-section-number">7</span> Exploratory Data Analysis (EDA)</h2>
<section id="build-an-analysis-table" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="build-an-analysis-table"><span class="header-section-number">7.1</span> Build an analysis table</h3>
<p>Before exploring, we create one tidy table that holds the dependent variable and the predictors we prepared earlier. Doing this once prevents repeated joins and keeps the later code short and reliable. We keep only 4-room transactions as per our study scope and confirm that the layer is a simple feature point layer in the meter based EPSG 3414 system. We also add a log transform of resale price to reduce skew and to make linear patterns easier to see in scatter plots and in correlation summaries. Finally, we collect all numeric predictors into a vector so that later summary loops are compact and easy to audit.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only four room transactions and select fields used in Section 6</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>analysis_sf <span class="ot">&lt;-</span> HDBresale_sf <span class="sc">%&gt;%</span>               <span class="co"># start from the prepared layer</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flat_type <span class="sc">==</span> <span class="st">"4 ROOM"</span>) <span class="sc">%&gt;%</span>           <span class="co"># enforce study scope</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">LOG_PRICE =</span> <span class="fu">log</span>(resale_price)) <span class="sc">%&gt;%</span>   <span class="co"># add log price for normality</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(                                     <span class="co"># keep only fields we will explore</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    LOG_PRICE,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    resale_price,</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    FLOOR_LEVEL,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    REMAINING_LEASE_MTH,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    AGE_2025,</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    DIST_CBD_M,</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    DIST_MRT_M,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    DIST_PARK_M,</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    DIST_ELDERCARE_M,</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    DIST_HAWKER_M,</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    DIST_SUPERMKT_M,</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    DIST_MALL_M,</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    DIST_ELITEPRI_M,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    CNT_KINDER_350,</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    CNT_CHILD_350,</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    CNT_BUS_350,</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    CNT_PRIMARY_1000,</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    geometry</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()                                  <span class="co"># keep sf class explicitly</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="co"># quick integrity checks</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">inherits</span>(analysis_sf, <span class="st">"sf"</span>))        <span class="co"># must be simple features</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">st_crs</span>(analysis_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>)   <span class="co"># must be in meters</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="co"># a handy vector of numeric predictor names for loops</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>num_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FLOOR_LEVEL"</span>,<span class="st">"REMAINING_LEASE_MTH"</span>,<span class="st">"AGE_2025"</span>,</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIST_CBD_M"</span>,<span class="st">"DIST_MRT_M"</span>,<span class="st">"DIST_PARK_M"</span>,<span class="st">"DIST_ELDERCARE_M"</span>,</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIST_HAWKER_M"</span>,<span class="st">"DIST_SUPERMKT_M"</span>,<span class="st">"DIST_MALL_M"</span>,<span class="st">"DIST_ELITEPRI_M"</span>,</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CNT_KINDER_350"</span>,<span class="st">"CNT_CHILD_350"</span>,<span class="st">"CNT_BUS_350"</span>,<span class="st">"CNT_PRIMARY_1000"</span></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="univariate-summaries-and-distributions" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="univariate-summaries-and-distributions"><span class="header-section-number">7.2</span> Univariate summaries and distributions</h3>
<p>We begin with very simple questions. What ranges do we see for price and for each predictor. Are there obvious outliers that are likely to be data errors. Are the distributions symmetric or strongly skewed. The following code prints summary statistics for price and every predictor, then draws histograms with a shared theme so that we can visually scan shapes and tails quickly. Using the log of price is helpful because it removes much of the right tail and makes interpretation of percentage changes easier later. This step often reveals small cleaning tasks before modelling, so it is worth doing carefully.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print compact summaries for price and predictors</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">select</span>(<span class="fu">st_drop_geometry</span>(analysis_sf), LOG_PRICE, <span class="fu">all_of</span>(num_vars)))   <span class="co"># plain stats for a quick scan</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   LOG_PRICE      FLOOR_LEVEL    REMAINING_LEASE_MTH    AGE_2025    
 Min.   :12.61   Min.   : 2.00   Min.   : 485.0      Min.   : 4.00  
 1st Qu.:13.24   1st Qu.: 5.00   1st Qu.: 750.0      1st Qu.: 9.00  
 Median :13.35   Median : 8.00   Median : 910.0      Median :23.00  
 Mean   :13.39   Mean   : 9.29   Mean   : 916.1      Mean   :22.85  
 3rd Qu.:13.50   3rd Qu.:11.00   3rd Qu.:1080.0      3rd Qu.:37.00  
 Max.   :14.23   Max.   :50.00   Max.   :1144.0      Max.   :58.00  
   DIST_CBD_M      DIST_MRT_M       DIST_PARK_M      DIST_ELDERCARE_M
 Min.   : 1023   Min.   :  21.79   Min.   :  63.81   Min.   :   0.0  
 1st Qu.: 9881   1st Qu.: 286.93   1st Qu.: 458.13   1st Qu.: 339.8  
 Median :13202   Median : 519.71   Median : 684.68   Median : 663.4  
 Mean   :12516   Mean   : 586.66   Mean   : 758.61   Mean   : 824.8  
 3rd Qu.:15768   3rd Qu.: 793.65   3rd Qu.: 974.97   3rd Qu.:1145.1  
 Max.   :19874   Max.   :2120.10   Max.   :2205.03   Max.   :3282.3  
 DIST_HAWKER_M     DIST_SUPERMKT_M      DIST_MALL_M      DIST_ELITEPRI_M   
 Min.   :  25.35   Min.   :   0.0003   Min.   :  39.14   Min.   :   74.37  
 1st Qu.: 376.85   1st Qu.: 179.1599   1st Qu.: 378.70   1st Qu.: 1312.05  
 Median : 647.65   Median : 278.4398   Median : 600.73   Median : 2411.57  
 Mean   : 730.12   Mean   : 308.4312   Mean   : 664.70   Mean   : 3552.04  
 3rd Qu.: 961.37   3rd Qu.: 397.2718   3rd Qu.: 886.89   3rd Qu.: 4997.38  
 Max.   :2500.14   Max.   :1415.3217   Max.   :2446.77   Max.   :11490.86  
 CNT_KINDER_350   CNT_CHILD_350     CNT_BUS_350     CNT_PRIMARY_1000
 Min.   :0.0000   Min.   : 0.000   Min.   : 0.000   Min.   :0.000   
 1st Qu.:0.0000   1st Qu.: 3.000   1st Qu.: 6.000   1st Qu.:2.000   
 Median :1.0000   Median : 4.000   Median : 8.000   Median :3.000   
 Mean   :0.9289   Mean   : 4.653   Mean   : 7.985   Mean   :3.039   
 3rd Qu.:1.0000   3rd Qu.: 6.000   3rd Qu.:10.000   3rd Qu.:4.000   
 Max.   :8.0000   Max.   :19.000   Max.   :19.000   Max.   :9.000   </code></pre>
</div>
</div>
<section id="eda-using-statistical-graphics" class="level4" data-number="7.2.1">
<h4 data-number="7.2.1" class="anchored" data-anchor-id="eda-using-statistical-graphics"><span class="header-section-number">7.2.1</span> EDA using statistical graphics</h4>
<p>We can plot the distribution of selling price in logarithm by using appropriate EDA as shown in the code chunk below.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># draw a histogram for log price</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(analysis_sf, <span class="fu">aes</span>(LOG_PRICE)) <span class="sc">+</span>          <span class="co"># map column to x</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">40</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span>                  <span class="co"># use many bins for detail</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of log price"</span>,    <span class="co"># plot title</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"log price"</span>, <span class="at">y =</span> <span class="st">"count"</span>) <span class="sc">+</span>         <span class="co"># axis labels</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()                              <span class="co"># simple theme</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The histogram is unimodal and concentrated around 13.3 to 13.5 with a visibly longer right tail beyond 13.6, indicating positive skew. Mass is dense near 13.35 and thins gradually toward 14.1, with very few values below 13.0. This pattern supports modelling price in logs since the transformation has largely stabilized variance and produced an approximately symmetric core with moderate high end skew. Implications are to use OLS on LOG_PRICE with robust errors, inspect influence diagnostics for high end points, complement Ordinary Least Square (OLS) with quantile regression to capture tail behaviour, and apply a smearing estimator when converting fitted log values back to dollars.</p>
</section>
<section id="multiple-histogram-plots-distribution-of-variables" class="level4" data-number="7.2.2">
<h4 data-number="7.2.2" class="anchored" data-anchor-id="multiple-histogram-plots-distribution-of-variables"><span class="header-section-number">7.2.2</span> Multiple histogram plots distribution of variables</h4>
<p>In this section, we will learn how to draw a small multiple histograms (also known as trellis plot) by using <code>ggarrange()</code> of <strong>ggpubr</strong> package.</p>
<p>The code chunk below is used to create 15 histograms. Then, <code>ggarrange()</code> is used to organised these histogram into a 3 columns by 5 rows small multiple plot.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create an empty list to store plots</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># loop and generate histograms</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(v <span class="cf">in</span> num_vars){</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(analysis_sf, <span class="fu">aes</span>(.data[[v]])) <span class="sc">+</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">40</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Distribution of"</span>, v),</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> v,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"count"</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  plot_list[[v]] <span class="ot">&lt;-</span> p      <span class="co"># store plot by name</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange into 3 columns Ã— 4 rows</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">plotlist =</span> plot_list,</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">5</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>FLOOR_LEVEL is concentrated in low to mid storeys with a long right tail beyond 20, indicating diminishing frequency at high floors. REMAINING_LEASE_MTH and AGE_2025 are multi modal, showing construction and lease cohorts rather than a single smooth pattern. DIST_CBD_M spans about 1 to 20 km with weak multi modality, while all amenity distances are strongly right skewed with many homes within 200 to 800 m and long sparse tails. DIST_ELITEPRI_M is broad with several modes, reflecting uneven elite school locations. CNT_KINDER_350 is zero heavy, CNT_CHILD_350 is skewed to small counts, CNT_BUS_350 is roughly symmetric around 8, and CNT_PRIMARY_1000 centres near 3. This implies the necessary to transform skewed distances using log, capture cohort effects for age and lease with categorical dummies or piecewise functions, treat zero heavy counts carefully, and check collinearity among proximity measures. We may expect steep price gradients at short distances and flattening beyond about 800 to 1000 m.</p>
</section>
</section>
<section id="simple-bivariate-relationships" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="simple-bivariate-relationships"><span class="header-section-number">7.3</span> Simple bivariate relationships</h3>
<p>Next we look at how price moves with each predictor one at a time. A scatter plot with a smooth line is a fast way to see direction and potential nonlinearity. We also compute a plain correlation matrix that includes log price and all numeric predictors. Correlation does not prove a causal story and it ignores spatial structure, but it is useful as a first pass to understand which predictors are strongly aligned and which pairs might cause instability if both are used together in a linear model. Later, more formal diagnostics will revisit collinearity with variance inflation factors.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build one scatter with loess per numeric predictor</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>scat_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(num_vars, <span class="cf">function</span>(v){</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(analysis_sf, <span class="fu">aes</span>(<span class="at">x =</span> .data[[v]], <span class="at">y =</span> LOG_PRICE)) <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Log price versus"</span>, v), <span class="at">x =</span> v, <span class="at">y =</span> <span class="st">"log price"</span>) <span class="sc">+</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange as 3 by 5 small multiples</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> scat_list, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">5</span>, <span class="at">align =</span> <span class="st">"hv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="1536"></p>
</figure>
</div>
</div>
</div>
<p>Log price rises with FLOOR_LEVEL and with REMAINING_LEASE_MTH at a diminishing rate, and declines with AGE_2025. Greater DIST_CBD_M, DIST_MRT_M, DIST_PARK_M, DIST_ELDERCARE_M, and DIST_HAWKER_M associate with lower prices, indicating centrality and amenity proximity premiums. DIST_SUPERMKT_M shows an inverted U shape, suggesting saturation effects for very near or very far supermarkets. DIST_MALL_M is weakly related. DIST_ELITEPRI_M is mildly negative, consistent with school proximity premiums. Higher CNT_CHILD_350 correlates with lower prices, while CNT_BUS_350 trends upward then flattens. CNT_KINDER_350 and CNT_PRIMARY_1000 show weak effects. It implies we need to investigate and model non-linear terms, include centrality and amenity gradients, and test interactions between structure and access, acknowledging heterogeneity.</p>
</section>
</section>
<section id="exploratory-data-spatial-analysis-edsa" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="exploratory-data-spatial-analysis-edsa"><span class="header-section-number">8</span> Exploratory Data Spatial Analysis (EDSA)</h2>
<p>Spatial exploration starts with maps. Because we have a dense point sample, it is often clearer to map quantiles rather than raw values. The first map shows log price in five quantile bands so central and suburban gradients can be seen quickly. The second map shows the distance to the CBD in five quantiles to compare spatial patterns. Keeping a consistent theme and coordinate system makes visual comparison easier. These first views often reveal data issues such as points falling in the sea or outside planning areas which we can then fix before running statistics that assume clean geometry.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use tmap in static mode</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 explicit colours for v4 (actual colours, not a palette name string)</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>pal5 <span class="ot">&lt;-</span> cols4all<span class="sc">::</span><span class="fu">c4a</span>(<span class="st">"YlOrRd"</span>, <span class="dv">5</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># helper: five-quantile dot map with boundary, centred bold title, legend inside frame</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>q5_map_v4 <span class="ot">&lt;-</span> <span class="cf">function</span>(boundary_sf, point_sf, value_col, title) {</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">inherits</span>(boundary_sf, <span class="st">"sf"</span>),</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">inherits</span>(point_sf, <span class="st">"sf"</span>),</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_crs</span>(boundary_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_crs</span>(point_sf)<span class="sc">$</span>epsg <span class="sc">==</span> <span class="dv">3414</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">is.numeric</span>(point_sf[[value_col]]))</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(boundary_sf) <span class="sc">+</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey40"</span>, <span class="at">lwd =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(point_sf) <span class="sc">+</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_dots</span>(</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> value_col,                 <span class="co"># map the numeric field</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="fl">0.3</span>,                       <span class="co"># slightly larger points</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill.scale =</span> <span class="fu">tm_scale_intervals</span>(  <span class="co"># compute quantiles here</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">n =</span> <span class="dv">5</span>,                          <span class="co"># five classes</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> <span class="st">"quantile"</span>,</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> pal5                   <span class="co"># explicit colours</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_title</span>(</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>      title,</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"top"</span>),</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="fl">1.4</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_legend</span>(</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">outside =</span> <span class="cn">FALSE</span>,   <span class="co"># keep legend inside the map frame</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="fu">list</span>(<span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">bg.color =</span> <span class="st">"white"</span>,</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">bg.alpha =</span> <span class="dv">1</span>,</span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">frame =</span> <span class="cn">TRUE</span></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(</span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">frame =</span> <span class="cn">TRUE</span>,     <span class="co"># draw a neatline</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">inner.margins =</span> <span class="fu">c</span>(<span class="fl">0.11</span>, <span class="fl">0.04</span>, <span class="fl">0.12</span>, <span class="fl">0.04</span>),  <span class="co"># room for title and legend</span></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">asp =</span> <span class="cn">NA</span>          <span class="co"># allow flexible height so nothing squashes</span></span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_view</span>(<span class="at">set_zoom_limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">14</span>))</span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure the mapped fields are numeric</span></span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>analysis_sf<span class="sc">$</span>LOG_PRICE  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(analysis_sf<span class="sc">$</span>LOG_PRICE)</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_sf$DIST_CBD_M &lt;- as.numeric(analysis_sf$DIST_CBD_M)</span></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a><span class="co"># build the two maps from the real numeric columns</span></span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a>tm_price <span class="ot">&lt;-</span> <span class="fu">q5_map_v4</span>(mpsz, analysis_sf, <span class="st">"LOG_PRICE"</span>,  <span class="st">"Log price in 5 quantiles"</span>)</span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a>tm_cbd <span class="ot">&lt;-</span> <span class="fu">q5_map_v4</span>(mpsz, analysis_sf, <span class="st">"DIST_CBD_M"</span>, <span class="st">"Distance to CBD in 5 quantiles"</span>)</span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a><span class="co"># draw the plot</span></span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>tm_price</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>tm_cbd</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-46-2.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The 5 quantile map of LOG_PRICE shows a pronounced central premium with a clear spatial gradient. The darkest red points that mark the top quantile cluster in the downtown and inner ring, then trace corridors toward the north-east and the east. The middle quantiles form transitional belts around this core. The lightest tones concentrate along the outer arc in the far north and far west, indicating the lowest tier. Scattered red pockets beyond the core align with regional town hubs and interchange nodes, implying that concentrated amenities and rail access can offset distance penalties. This pattern indicates distance decay that is smooth along some corridors but punctuated by local clusters. For explanation, measure centrality with network travel time to the main employment core, add proximity to mass rapid transit and town centres, and include bus stop density to reflect observed clusters. Allow nonlinear distance effects, test residual spatial dependence, and apply Geographically Weighted Regression (GWR) to quantify where premiums are strongest.</p>
</section>
<section id="hedonic-pricing-modelling" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="hedonic-pricing-modelling"><span class="header-section-number">9</span> Hedonic Pricing Modelling</h2>
<p>Why do two similar flats sell at very different prices? This section answers that practical question by decomposing observed resale price into contributions from structure, location, and nearby amenities. We proceed with a disciplined modelling pathway that is faithful to your prepared data and variable choices. First, we inspect pairwise associations among predictors to anticipate stability issues. Next, we estimate a full specification, then streamline it to a tighter version guided by evidence. Results are formatted into a clear table suitable for publication. Finally, we verify assumptions and test for spatial patterning in residuals using a distance band approach. The outcome is a transparent, reproducible, and defensible explanation of price variation.</p>
<section id="multiple-linear-regression-mlr-method" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="multiple-linear-regression-mlr-method"><span class="header-section-number">9.1</span> Multiple Linear Regression (MLR) method</h3>
<p>Begin with a simple proposition. Resale price may be expressed as an additive function of structural attributes, distances to services, and counts of facilities within fixed catchments. Multiple linear regression operationalises this idea and yields coefficients that read as marginal effects with other factors held constant. The method is favoured for clarity, ease of diagnostic checking, and compatibility with downstream spatial tests. In this work, estimation adheres to your exact predictor list and uses standard ordinary least squares, ensuring that inferences are grounded in widely accepted practice while remaining aligned to your study design.</p>
<section id="visualising-the-relationships-of-the-independent-variables" class="level4" data-number="9.1.1">
<h4 data-number="9.1.1" class="anchored" data-anchor-id="visualising-the-relationships-of-the-independent-variables"><span class="header-section-number">9.1.1</span> Visualising the relationships of the independent variables</h4>
<p>Before fitting any equation, we look first. A compact correlation matrix, ordered by eigenvectors, reveals clusters of related predictors and flags potential inflation of uncertainty. Numeric labels keep the display succinct, and the upper triangle focuses attention. This is an advisory step rather than a decision rule, but it equips later diagnostics with context and avoids surprises when interpreting coefficients.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># collect the exact predictors for the Multiple model into a character vector</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>mm_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FLOOR_LEVEL"</span>,<span class="st">"REMAINING_LEASE_MTH"</span>,<span class="st">"AGE_2025"</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIST_CBD_M"</span>,<span class="st">"DIST_MRT_M"</span>,<span class="st">"DIST_PARK_M"</span>,<span class="st">"DIST_ELDERCARE_M"</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIST_HAWKER_M"</span>,<span class="st">"DIST_SUPERMKT_M"</span>,<span class="st">"DIST_MALL_M"</span>,<span class="st">"DIST_ELITEPRI_M"</span>,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CNT_KINDER_350"</span>,<span class="st">"CNT_CHILD_350"</span>,<span class="st">"CNT_BUS_350"</span>,<span class="st">"CNT_PRIMARY_1000"</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># build a numeric data frame for correlation by dropping geometry and selecting variables</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>cor_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(analysis_sf), dplyr<span class="sc">::</span><span class="fu">all_of</span>(mm_vars))  <span class="co"># keep only model vars</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the correlation matrix using pairwise complete observations</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>cor_mat <span class="ot">&lt;-</span> <span class="fu">cor</span>(cor_df, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)   <span class="co"># handle missing values pairwise</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="co"># display the summary of the correlation matrix</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>cor_mat</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     FLOOR_LEVEL REMAINING_LEASE_MTH    AGE_2025   DIST_CBD_M
FLOOR_LEVEL          1.000000000         0.296554139 -0.29707499 -0.247305942
REMAINING_LEASE_MTH  0.296554139         1.000000000 -0.99963873  0.091772439
AGE_2025            -0.297074994        -0.999638725  1.00000000 -0.091516744
DIST_CBD_M          -0.247305942         0.091772439 -0.09151674  1.000000000
DIST_MRT_M          -0.107713184         0.025677014 -0.02504814  0.170664542
DIST_PARK_M         -0.051986857         0.111014527 -0.11190740  0.338694246
DIST_ELDERCARE_M    -0.126627904         0.026535546 -0.02503077  0.399274924
DIST_HAWKER_M       -0.139778703         0.029158714 -0.03004163  0.344602149
DIST_SUPERMKT_M     -0.038831406         0.045386897 -0.04479530  0.016896068
DIST_MALL_M         -0.011655741        -0.084027939  0.08562340 -0.225004071
DIST_ELITEPRI_M     -0.129878208         0.120971689 -0.12016143  0.704979552
CNT_KINDER_350       0.002303374        -0.161439591  0.16082083 -0.004500193
CNT_CHILD_350        0.019279142         0.021688788 -0.02287158  0.113950711
CNT_BUS_350         -0.032800232         0.009937946 -0.01054252  0.183472813
CNT_PRIMARY_1000    -0.098186498        -0.033321513  0.03259701  0.259288984
                       DIST_MRT_M DIST_PARK_M DIST_ELDERCARE_M DIST_HAWKER_M
FLOOR_LEVEL         -0.1077131843 -0.05198686      -0.12662790   -0.13977870
REMAINING_LEASE_MTH  0.0256770139  0.11101453       0.02653555    0.02915871
AGE_2025            -0.0250481409 -0.11190740      -0.02503077   -0.03004163
DIST_CBD_M           0.1706645423  0.33869425       0.39927492    0.34460215
DIST_MRT_M           1.0000000000  0.09026758       0.10676686    0.01277210
DIST_PARK_M          0.0902675794  1.00000000      -0.03338244    0.11819275
DIST_ELDERCARE_M     0.1067668594 -0.03338244       1.00000000    0.13245089
DIST_HAWKER_M        0.0127721005  0.11819275       0.13245089    1.00000000
DIST_SUPERMKT_M      0.1765673011 -0.11986959       0.03450565   -0.02562024
DIST_MALL_M          0.3388069011 -0.04258508       0.02584431   -0.15787007
DIST_ELITEPRI_M     -0.0002534136  0.23278480       0.35565574    0.23125496
CNT_KINDER_350      -0.0592377617  0.02556129       0.03447085    0.06446977
CNT_CHILD_350       -0.1840478956  0.16796939      -0.02019895    0.10158066
CNT_BUS_350         -0.0012617027  0.12903762       0.01914944   -0.01850288
CNT_PRIMARY_1000    -0.2810530232  0.23433085      -0.08156048    0.06868700
                    DIST_SUPERMKT_M DIST_MALL_M DIST_ELITEPRI_M CNT_KINDER_350
FLOOR_LEVEL             -0.03883141 -0.01165574   -0.1298782076    0.002303374
REMAINING_LEASE_MTH      0.04538690 -0.08402794    0.1209716890   -0.161439591
AGE_2025                -0.04479530  0.08562340   -0.1201614344    0.160820834
DIST_CBD_M               0.01689607 -0.22500407    0.7049795525   -0.004500193
DIST_MRT_M               0.17656730  0.33880690   -0.0002534136   -0.059237762
DIST_PARK_M             -0.11986959 -0.04258508    0.2327847967    0.025561293
DIST_ELDERCARE_M         0.03450565  0.02584431    0.3556557384    0.034470854
DIST_HAWKER_M           -0.02562024 -0.15787007    0.2312549607    0.064469774
DIST_SUPERMKT_M          1.00000000  0.20820232   -0.0678655602   -0.118708737
DIST_MALL_M              0.20820232  1.00000000   -0.2732205629   -0.050023131
DIST_ELITEPRI_M         -0.06786556 -0.27322056    1.0000000000   -0.047426160
CNT_KINDER_350          -0.11870874 -0.05002313   -0.0474261597    1.000000000
CNT_CHILD_350           -0.23729483 -0.26179038    0.0727533714    0.471435322
CNT_BUS_350             -0.08543510 -0.23892133    0.0550505741    0.072713779
CNT_PRIMARY_1000        -0.17745317 -0.35388393    0.1328107581    0.032903517
                    CNT_CHILD_350  CNT_BUS_350 CNT_PRIMARY_1000
FLOOR_LEVEL            0.01927914 -0.032800232      -0.09818650
REMAINING_LEASE_MTH    0.02168879  0.009937946      -0.03332151
AGE_2025              -0.02287158 -0.010542525       0.03259701
DIST_CBD_M             0.11395071  0.183472813       0.25928898
DIST_MRT_M            -0.18404790 -0.001261703      -0.28105302
DIST_PARK_M            0.16796939  0.129037619       0.23433085
DIST_ELDERCARE_M      -0.02019895  0.019149444      -0.08156048
DIST_HAWKER_M          0.10158066 -0.018502881       0.06868700
DIST_SUPERMKT_M       -0.23729483 -0.085435098      -0.17745317
DIST_MALL_M           -0.26179038 -0.238921335      -0.35388393
DIST_ELITEPRI_M        0.07275337  0.055050574       0.13281076
CNT_KINDER_350         0.47143532  0.072713779       0.03290352
CNT_CHILD_350          1.00000000  0.240766976       0.31874095
CNT_BUS_350            0.24076698  1.000000000       0.21327837
CNT_PRIMARY_1000       0.31874095  0.213278371       1.00000000</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise the matrix with a compact upper triangle layout</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)       <span class="co"># load correlation plot package</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(               <span class="co"># draw the heat map</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  cor_mat,              <span class="co"># supply the matrix</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag  =</span> <span class="cn">FALSE</span>,         <span class="co"># hide the diagonal squares</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">order =</span> <span class="st">"AOE"</span>,        <span class="co"># use angular order of eigenvectors</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">tl.pos =</span> <span class="st">"td"</span>,        <span class="co"># place text labels at top</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">tl.cex =</span> <span class="fl">0.8</span>,         <span class="co"># use small text size</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"number"</span>,    <span class="co"># print numbers instead of tiles</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"upper"</span>        <span class="co"># draw only the upper triangle</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>First, REMAINING_LEASE_MTH and AGE_2025 have a correlation of about âˆ’0.9996. They are almost perfect substitutes: a flat that is older in AGE_2025 almost always has a shorter remaining lease, and vice versa. In the multiple model this pair will create extremely severe multicollinearity, so in later steps we must either drop one of them or be prepared for very unstable coefficient estimates and very high variance inflation.</p>
<p>Second, the largest correlation among the location variables is between DIST_CBD_M and DIST_ELITEPRI_M, around 0.71. Condos that are farther from the CBD also tend to be farther from elite primary schools. This means these 2 distance measures share substantial spatial pattern, so their individual coefficients in the multiple model will be harder to interpret cleanly, even though they are not perfectly redundant.</p>
<p>Other distance measures are only moderately associated. For example, DIST_CBD_M with DIST_PARK_M, DIST_ELDERCARE_M, and DIST_HAWKER_M are in the 0.33 to 0.40 range, and most other pairs are below 0.30 in magnitude. DIST_MALL_M has modest negative correlation with DIST_CBD_M (about âˆ’0.23). These suggest some shared geography but not critical multicollinearity.</p>
<p>The count variables form a loose cluster: CNT_KINDER_350 and CNT_CHILD_350 correlate at about 0.47, and CNT_CHILD_350 with CNT_PRIMARY_1000 at about 0.32, with smaller positive correlations involving CNT_BUS_350. They measure related aspects of family oriented amenities but still contain non overlapping information.</p>
<p>FLOOR_LEVEL has only small to moderate correlations with all other variables, so it adds largely independent vertical characteristics.</p>
<p>Implication for modelling: the only truly problematic pair is REMAINING_LEASE_MTH with AGE_2025. DIST_CBD_M with DIST_ELITEPRI_M and the childcare related counts may inflate variance somewhat but are still acceptable. The rest of the predictors are not strongly correlated, so the multiple regression can proceed, with careful collinearity diagnostics and possibly removing one of AGE_2025 or REMAINING_LEASE_MTH in the final explanatory model.</p>
</section>
<section id="building-a-hedonic-pricing-model-using-multiple-linear-regression-method" class="level4" data-number="9.1.2">
<h4 data-number="9.1.2" class="anchored" data-anchor-id="building-a-hedonic-pricing-model-using-multiple-linear-regression-method"><span class="header-section-number">9.1.2</span> Building a hedonic pricing model using multiple linear regression method</h4>
<p>Here the analysis moves from inspection to estimation. The full specification places all required predictors into a single equation so that each coefficient measures the expected change in resale price associated with a one unit change in that predictor when the rest are held fixed. The summary reports effect size, direction, and precision along with overall fit statistics. We comment on the economic reasonableness of signs, the relative magnitude of location versus structure variables, and whether the model captures a substantial share of variation. Residuals and fitted values from this run become inputs to the validation steps that follow.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># multiple linear regression with the exact predictors provided</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>mlr.full <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> resale_price <span class="sc">~</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    FLOOR_LEVEL <span class="sc">+</span> REMAINING_LEASE_MTH <span class="sc">+</span> AGE_2025 <span class="sc">+</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    DIST_CBD_M <span class="sc">+</span> DIST_MRT_M <span class="sc">+</span> DIST_PARK_M <span class="sc">+</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    DIST_ELDERCARE_M <span class="sc">+</span> DIST_HAWKER_M <span class="sc">+</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    DIST_SUPERMKT_M <span class="sc">+</span> DIST_MALL_M <span class="sc">+</span> DIST_ELITEPRI_M <span class="sc">+</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    CNT_KINDER_350 <span class="sc">+</span> CNT_CHILD_350 <span class="sc">+</span> CNT_BUS_350 <span class="sc">+</span> CNT_PRIMARY_1000,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_sf</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="co"># model summary</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_regress</span>(mlr.full)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Model Summary                                
--------------------------------------------------------------------------
R                           0.873       RMSE                    78459.346 
R-Squared                   0.761       MSE                6155868944.847 
Adj. R-Squared              0.761       Coef. Var                  11.678 
Pred R-Squared              0.760       AIC                    220294.425 
MAE                     60537.605       SBC                    220414.593 
--------------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                          ANOVA                                            
------------------------------------------------------------------------------------------
                           Sum of                                                         
                          Squares          DF           Mean Square       F          Sig. 
------------------------------------------------------------------------------------------
Regression    170442898538684.156          15    11362859902578.943    1842.455    0.0000 
Residual       53426786572326.961        8663        6167238436.145                       
Total         223869685111011.125        8678                                             
------------------------------------------------------------------------------------------

                                              Parameter Estimates                                               
---------------------------------------------------------------------------------------------------------------
              model           Beta    Std. Error    Std. Beta       t        Sig          lower          upper 
---------------------------------------------------------------------------------------------------------------
        (Intercept)    1087846.963    221643.511                   4.908    0.000    653372.962    1522320.964 
        FLOOR_LEVEL       5853.771       146.370        0.232     39.993    0.000      5566.852       6140.691 
REMAINING_LEASE_MTH         -5.398       186.128       -0.006     -0.029    0.977      -370.252        359.456 
           AGE_2025      -5460.818      2236.405       -0.479     -2.442    0.015     -9844.703      -1076.933 
         DIST_CBD_M        -19.784         0.334       -0.541    -59.220    0.000       -20.439        -19.129 
         DIST_MRT_M        -56.376         2.642       -0.131    -21.339    0.000       -61.555        -51.197 
        DIST_PARK_M         -2.673         2.357       -0.007     -1.134    0.257        -7.293          1.948 
   DIST_ELDERCARE_M        -10.716         1.528       -0.042     -7.013    0.000       -13.711         -7.720 
      DIST_HAWKER_M        -25.207         1.998       -0.072    -12.616    0.000       -29.124        -21.290 
    DIST_SUPERMKT_M         15.720         4.985        0.018      3.154    0.002         5.948         25.491 
        DIST_MALL_M        -27.033         2.740       -0.063     -9.866    0.000       -32.404        -21.662 
    DIST_ELITEPRI_M          1.906         0.422        0.036      4.519    0.000         1.079          2.733 
     CNT_KINDER_350      10192.082       930.620        0.068     10.952    0.000      8367.844      12016.319 
      CNT_CHILD_350      -1919.081       467.362       -0.027     -4.106    0.000     -2835.221      -1002.940 
        CNT_BUS_350       1468.476       320.930        0.026      4.576    0.000       839.376       2097.576 
   CNT_PRIMARY_1000     -11855.922       661.660       -0.115    -17.918    0.000    -13152.933     -10558.912 
---------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>The model has strong overall explanatory power. R squared is 0.761 with an F statistic of 1840.225 and p value below 0.001, so the 15 predictors jointly explain about 76 percent of the variation in the response. Predicted R squared (0.760), RMSE around 78496, and MAE around 60588 show that out of sample error is broadly consistent with in sample fit.</p>
<p>Within the coefficient table, most predictors are statistically significant at the 0.05 level. Exceptions are <strong>REMAINING_LEASE_MTH</strong> and <strong>DIST_PARK_M</strong>, whose p values (0.965 and 0.253) indicate that, once the other variables are included, they contribute little unique explanatory power. This is consistent with the near perfect correlation between REMAINING_LEASE_MTH and AGE_2025, which makes the lease variable redundant while AGE_2025 remains significant.</p>
<p>Standardised betas identify the strongest effects. DIST_CBD_M has the largest magnitude (standardised beta about âˆ’0.541): locations further from the central area are associated with substantially lower predicted outcome, all else equal. AGE_2025 also has a large negative standardised beta (about âˆ’0.483), indicating that newer developments are valued more highly than older ones after controlling for other factors. FLOOR_LEVEL has a sizeable positive effect (standardised beta about 0.232), so higher floors are linked to higher predicted outcome. DIST_MRT_M, DIST_ELDERCARE_M, DIST_HAWKER_M, DIST_MALL_M, and CNT_PRIMARY_1000 all have significant negative coefficients, meaning greater distance from these amenities or more primary schools within 1000 meters is associated with lower predicted outcome, holding other variables constant.</p>
<p>Some amenities work in the opposite direction. DIST_SUPERMKT_M, DIST_ELITEPRI_M, CNT_KINDER_350, and CNT_BUS_350 have positive coefficients, so, after controlling for the rest of the urban environment, blocks with more kindergartens or bus stops nearby and those a little further from supermarkets and elite primary schools tend to have higher predicted outcomes in this sample.</p>
<p>Overall, the regression suggests that centrality, building age, vertical position, access to several key facilities, and the surrounding mix of schools and transport services are the dominant drivers of the response, while remaining lease length and park distance add little once these correlated factors are taken into account.</p>
</section>
<section id="revising-the-model" class="level4" data-number="9.1.3">
<h4 data-number="9.1.3" class="anchored" data-anchor-id="revising-the-model"><span class="header-section-number">9.1.3</span> Revising the model</h4>
<p>Take the fitted baseline and refine it. Terms with weak support or redundancy are removed while preserving the intended meaning of the specification. The revised version aims for parsimony, stability, and interpretability. We compare key coefficients and global fit between the initial and revised results and ensure that important relationships persist with tighter intervals. This becomes the reference model for formal presentation and for all diagnostic procedures.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># multiple linear regression with the exact predictors provided</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>mlr1.full <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> resale_price <span class="sc">~</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    FLOOR_LEVEL <span class="sc">+</span> AGE_2025 <span class="sc">+</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    DIST_CBD_M <span class="sc">+</span> DIST_MRT_M <span class="sc">+</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    DIST_ELDERCARE_M <span class="sc">+</span> DIST_HAWKER_M <span class="sc">+</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    DIST_SUPERMKT_M <span class="sc">+</span> DIST_MALL_M <span class="sc">+</span> DIST_ELITEPRI_M <span class="sc">+</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    CNT_KINDER_350 <span class="sc">+</span> CNT_CHILD_350 <span class="sc">+</span> CNT_BUS_350 <span class="sc">+</span> CNT_PRIMARY_1000,</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_sf</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co"># model summary</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_regress</span>(mlr1.full)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Model Summary                                
--------------------------------------------------------------------------
R                           0.873       RMSE                    78465.168 
R-Squared                   0.761       MSE                6156782544.218 
Adj. R-Squared              0.761       Coef. Var                  11.678 
Pred R-Squared              0.761       AIC                    220291.713 
MAE                     60504.242       SBC                    220397.743 
--------------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                          ANOVA                                            
------------------------------------------------------------------------------------------
                           Sum of                                                         
                          Squares          DF           Mean Square       F          Sig. 
------------------------------------------------------------------------------------------
Regression    170434969409741.188          13    13110382262287.783    2125.986    0.0000 
Residual       53434715701270.203        8665        6166730028.998                       
Total         223869685111011.375        8678                                             
------------------------------------------------------------------------------------------

                                             Parameter Estimates                                              
-------------------------------------------------------------------------------------------------------------
           model           Beta    Std. Error    Std. Beta       t        Sig           lower          upper 
-------------------------------------------------------------------------------------------------------------
     (Intercept)    1080903.705      5874.507                 183.999    0.000    1069388.274    1092419.136 
     FLOOR_LEVEL       5852.746       146.352        0.232     39.991    0.000       5565.861       6139.630 
        AGE_2025      -5388.749        65.386       -0.473    -82.415    0.000      -5516.921      -5260.578 
      DIST_CBD_M        -19.862         0.327       -0.543    -60.767    0.000        -20.503        -19.221 
      DIST_MRT_M        -56.614         2.633       -0.132    -21.499    0.000        -61.776        -51.452 
DIST_ELDERCARE_M        -10.409         1.502       -0.041     -6.928    0.000        -13.354         -7.464 
   DIST_HAWKER_M        -25.244         1.997       -0.072    -12.643    0.000        -29.158        -21.330 
 DIST_SUPERMKT_M         16.386         4.950        0.018      3.311    0.001          6.684         26.089 
     DIST_MALL_M        -27.445         2.713       -0.064    -10.117    0.000        -32.762        -22.127 
 DIST_ELITEPRI_M          1.884         0.421        0.035      4.474    0.000          1.058          2.709 
  CNT_KINDER_350      10192.818       930.560        0.068     10.953    0.000       8368.700      12016.936 
   CNT_CHILD_350      -1960.439       465.852       -0.028     -4.208    0.000      -2873.620      -1047.258 
     CNT_BUS_350       1452.705       320.613        0.026      4.531    0.000        824.228       2081.183 
CNT_PRIMARY_1000     -11958.148       655.455       -0.116    -18.244    0.000     -13242.995     -10673.300 
-------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>This final model keeps 13 predictors and fits very well. R squared is 0.761 with adjusted and predicted R squared both 0.761 and 0.760. The F statistic of 2123.406 with <span class="math inline">\(p\)</span> value below 0.001 shows the retained predictors jointly explain the dependent variable strongly. RMSE is about 78,501 and MAE about 60,554, very similar to the previous model, so parsimony is gained without losing explanatory power.</p>
<p>Compared with the earlier specification, REMAINING_LEASE_MTH and DIST_PARK_M have been removed because their p values were very large once other variables were included and REMAINING_LEASE_MTH was almost perfectly collinear with AGE_2025. Their removal simplifies interpretation while keeping model fit essentially unchanged.</p>
<p>Let Y be the predicted resale price. The ordinary least squares equation is</p>
<p><span class="math display">\[
\hat Y \approx 1,080,598 + 5,855\cdot Floor - 5393 \cdot AGE\_2025 - 20\cdot DIST\_CBD\_M - 57 \cdot DIST\_MRT\_M - 10 \cdot DIST\_ELDERCARE\_M - 25 \cdot DIST\_HAWKER\_M + 17 \cdot DIST\_SUPERMKT\_M - 27 \cdot DIST\_MALL\_M + 1.9 \cdot DIST\_ELITEPRI\_M + 10195 \cdot CNT\_KINDER\_350 - 1967 \cdot CNT\_CHILD\_350 + 1440 \cdot CNT\_BUS\_350 - 11794 \cdot CNT\_PRIMARY\_1000
\]</span></p>
<p>Interpreting unit changes: holding all other variables constant, moving up 1 floor raises expected price by about 5,855. An increase of 1 unit in AGE_2025 reduces price by about 5,393, confirming that newer developments command higher prices. Every additional unit of distance from the central business district reduces price by about 19.9, and every additional unit of distance from the nearest MRT station reduces price by about 56.6. Distances from eldercare, hawker centres and malls also have significant negative effects.</p>
<p>Amenity counts matter as well. Each extra kindergarten within 350 units increases price by roughly 10195, while each extra primary school within 1000 units reduces price by about 11,794 after controlling for the rest, suggesting that the mix of school types in the immediate environment is important rather than sheer number. Bus stop density has a modest positive effect, and the small positive coefficients for distance to supermarkets and elite primary schools indicate that, in this dataset, higher priced condos tend to sit slightly further from those specific facilities once other location attributes are controlled. Overall, the retained predictors describe a coherent hedonic structure in which height, building age, centrality and the surrounding service mix jointly drive resale prices.</p>
</section>
</section>
<section id="regression-diagnostics" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="regression-diagnostics"><span class="header-section-number">9.2</span> Regression diagnostics</h3>
<p>Trust in the model is earned through testing. This subsection assembles checks that speak to stability, functional form, distributional behaviour of errors, and spatial independence. We first quantify variance inflation to assess redundancy among predictors. We then examine residual patterns for departures from linearity. Next, we evaluate normality using both a formal test and visual evidence. Finally, we test residual spatial autocorrelation using a distance band neighbour list with row standardised weights and a permutation based Moran statistic. Together, these checks provide a rigorous audit of model adequacy.</p>
<section id="multicollinearity-test" class="level4" data-number="9.2.1">
<h4 data-number="9.2.1" class="anchored" data-anchor-id="multicollinearity-test"><span class="header-section-number">9.2.1</span> Multicollinearity test</h4>
<p>The variance inflation profile answers a simple question. Are predictors supplying distinct information or echoing each other? Values near one suggest little redundancy, while larger values warn of unstable estimates. The accompanying plot highlights any terms approaching concern thresholds and supports reasoned choices about retention in the revised equation.</p>
<p>In the code chunk below, we test if there are sign of multicollinearity.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for Multicollinearity</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co"># check_collinearity(mlr1.full)</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_vif_tol</span>(mlr1.full)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Variables Tolerance      VIF
1       FLOOR_LEVEL 0.8180542 1.222413
2          AGE_2025 0.8356779 1.196633
3        DIST_CBD_M 0.3447146 2.900950
4        DIST_MRT_M 0.7347066 1.361088
5  DIST_ELDERCARE_M 0.7830207 1.277106
6     DIST_HAWKER_M 0.8476201 1.179774
7   DIST_SUPERMKT_M 0.8913504 1.121893
8       DIST_MALL_M 0.6896890 1.449929
9   DIST_ELITEPRI_M 0.4458103 2.243106
10   CNT_KINDER_350 0.7218772 1.385277
11    CNT_CHILD_350 0.6246911 1.600791
12      CNT_BUS_350 0.8544524 1.170340
13 CNT_PRIMARY_1000 0.6822564 1.465725</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the </span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>mlr1.vif <span class="ot">&lt;-</span> <span class="fu">check_collinearity</span>(mlr1.full)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mlr1.vif)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The variance inflation results show that the revised model has very little multi collinearity and the coefficients should be numerically stable. All 13 predictors have variance inflation factor values between about 1.1 and 2.9, with tolerances above 0.34. Common rules of thumb treat variance inflation factor values below 5 as low concern and values above 10 as serious, so every predictor is well inside the safe zone.</p>
<p>The 2 strongest correlations are reflected in DIST_CBD_M with variance inflation factor about 2.9 and DIST_ELITEPRI_M with variance inflation factor about 2.2. These confirm some shared spatial structure between centrality and distance to elite primary schools but still indicate that each variable contributes enough unique information to justify retention. All other predictors, including AGE_2025, FLOOR_LEVEL and the amenity counts, have variance inflation factor values close to 1, meaning they are largely independent once the others are controlled.</p>
<p>The plot reinforces this conclusion visually. Every point lies in the green band labelled low (variance inflation factor below 5), and none approach the blue or red regions that would signal unstable estimates. Combined with the earlier step that removed REMAINING_LEASE_MTH and DIST_PARK_M, these diagnostics show that the final hedonic equation is free from harmful multi collinearity, so the standard errors, confidence intervals and p values reported for the coefficients can be interpreted with high confidence.</p>
</section>
<section id="test-for-non-linearity" class="level4" data-number="9.2.2">
<h4 data-number="9.2.2" class="anchored" data-anchor-id="test-for-non-linearity"><span class="header-section-number">9.2.2</span> Test for non-linearity</h4>
<p>Residuals should show no systematic curve against fitted values if the linear form is appropriate. A smooth trend line provides a quick visual guide. A flat band supports the additive form, whereas pronounced curvature indicates that transformations or interactions may be warranted in later extensions.</p>
<p>In the code chunk below, the <code>ols_plot_resid_fit()</code> of olsrr package is used to perform linearity assumption test.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ols_plot_resid_fit(mlr1.full)</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(mlr1.full,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">check =</span> <span class="st">"linearity"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The residual versus fitted plot shows a clear curved trend instead of a flat band around 0, so the strict linearity assumption is not fully satisfied. For low fitted values the smooth line lies above 0, indicating that the model under predicts prices for the cheapest units. Around the middle range the line dips below 0, so prices in this segment are slightly over predicted. At the upper end the line rises above 0 again, which means the most expensive units are again under predicted. The spread of residuals also increases with fitted value, suggesting mild heteroscedasticity.</p>
<p>These patterns imply that the global ordinary least squares specification is only an approximation and that some systematic structure remains unexplained. Beyond possible transformations or interaction terms, an important next step is to recognise that price determinants may vary across space. Section 10 will therefore extend the analysis with geographically weighted regression, allowing regression coefficients to vary by location, refining local fitted values, and testing whether key covariate effects differ across neighbourhoods rather than being forced to share a single global relationship.</p>
</section>
<section id="test-for-normality-assumption" class="level4" data-number="9.2.3">
<h4 data-number="9.2.3" class="anchored" data-anchor-id="test-for-normality-assumption"><span class="header-section-number">9.2.3</span> Test for normality assumption</h4>
<p>Studentised residuals are tested and visualised to judge whether the normal approximation that underpins interval estimates is reasonable. The Q Q display should track the reference line except at the tails. When formal tests detect minor deviations in large samples, practical interpretation relies on the visual pattern and on the robustness of conclusions.</p>
<p>In the code chunk below, <code>ols_plot_resid_hist()</code> of <strong>olssr</strong> package is used to perform normality assumption test on <code>mlr1.full</code> model.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>olsrr<span class="sc">::</span><span class="fu">ols_plot_resid_hist</span>(mlr1.full)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check_normality(mlr1.full)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This pattern suggests that the normality assumption is acceptable for inference on regression coefficients and mean effects, although prediction intervals for extreme high priced units will be less reliable. The mild skewness also reinforces the earlier evidence of non constant variance and non linearity, motivating later refinements such as geographically weighted regression and possibly robust or transformed specifications to improve fit in the tails of the price distribution.</p>
<p>Instead of showing the test statistic, <code>plot()</code> of <strong>see</strong> package can be used to plot a the output of <code>check_normality()</code> for visual inspection as shown below.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_normality</span>(mlr1.full), </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"qq"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The Q Q plot shows that residuals follow the reference line very closely through the central part of the distribution. From about the 10th to the 90th percentile the points stay inside the grey band, so the normal approximation is reasonable for most observations and standard OLS inference on mean effects is reliable.</p>
<p>Departures appear mainly in the upper tail, where points bend above the line and move outside the band, indicating more large positive residuals than a normal distribution would predict. A mild deviation is also visible in the extreme lower tail. These patterns confirm slight right skew and heavier tails, consistent with the histogram. In practice this means that coefficient estimates and their confidence intervals remain trustworthy given the very large sample, but prediction intervals for the most expensive condominiums are less accurate and a small number of high priced outliers or omitted local factors are not fully captured by the global model.</p>
<p>Another way to check for normality assumption visual is by using <code>check_model()</code> of <strong>performance</strong> package as shown in the code chunk below.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(mlr1.full,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">check=</span> <span class="st">"normality"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The kernel density of residuals aligns very closely with the overlaid normal curve and is centred near 0, indicating that the bulk of the studentised residuals follow an approximately normal pattern. The peak and spread of the empirical distribution almost coincide with the theoretical curve, with only a slightly longer right tail where a small number of observations record large positive residuals. Hence the ordinary least squares estimates and their interval estimates can be interpreted with confidence, while recognising that predictions for a small subset of high priced units may involve larger uncertainty due to the mild departure in the upper tail.</p>
</section>
<section id="testing-for-spatial-autocorrelation" class="level4" data-number="9.2.4">
<h4 data-number="9.2.4" class="anchored" data-anchor-id="testing-for-spatial-autocorrelation"><span class="header-section-number">9.2.4</span> Testing for Spatial Autocorrelation</h4>
<p>Residuals are attached to the feature layer, mapped in quantile classes for visual screening, and then assessed with a distance band Moran test using row standardised weights and 999 permutations. A significant positive statistic indicates clustering of errors and suggests that spatial processes remain unmodelled. Evidence of such structure motivates the spatially aware methods that follow in the broader study.</p>
<p>In order to perform spatial autocorrelation test, we need to export the residual of the hedonic pricing model and save it as a data frame first.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>mlr1.output <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mlr1.full<span class="sc">$</span>residuals)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Next, we will join the newly created data frame with <code>mlr1_resale.sf</code> object.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>mlr1_resale.sf <span class="ot">&lt;-</span> <span class="fu">cbind</span>(analysis_sf, </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                        mlr1.full<span class="sc">$</span>residuals) <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(<span class="st">`</span><span class="at">MLR_RES</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">mlr1.full.residuals</span><span class="st">`</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Next, we will use <strong>tmap</strong> package to display the distribution of the residuals on an interactive map.</p>
<p>The code churn below will turn on the interactive mode of tmap.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_polygons</span>(<span class="at">fill_alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span> <span class="co"># semiâ€‘transparent base</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mlr1_resale.sf) <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_dots</span>(</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="at">fill =</span> <span class="st">"MLR_RES"</span>, <span class="co"># color by residual value</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="at">size =</span> <span class="fl">0.5</span>, <span class="co"># point size</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="at">col =</span> <span class="st">"black"</span>, <span class="co"># thin border</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="at">fill.scale =</span> <span class="fu">tm_scale</span>( <span class="co"># custom diverging palette</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">brewer.pal</span>(<span class="dv">11</span>, <span class="st">"RdBu"</span>)), <span class="co"># redâ€‘blue diverging</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="at">style =</span> <span class="st">"quantile"</span>,</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a><span class="at">midpoint =</span> <span class="cn">NA</span>),</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_title</span>(<span class="st">"LM Residuals (Quantile Classification)"</span>) <span class="sc">+</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_view</span>(<span class="at">set_zoom_limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">14</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The residual map reveals that model errors are not spatially random. Large positive residuals in dark red form clusters in several neighbourhoods, meaning resale prices there are systematically higher than the global model predicts. Large negative residuals in dark blue cluster elsewhere, indicating over prediction of prices in those areas. Pale symbols around zero are more scattered and show locations where the model fits reasonably well.</p>
<p>This spatial clustering implies that important local influences on price are not fully captured by the current global ordinary least squares equation. The strength or direction of covariate effects likely varies across space, and unobserved neighbourhood attributes are exerting local impacts. These patterns justify the next step of applying spatial diagnostics and geographically weighted regression in Section 10, so that coefficients can vary by location and the fitted values can better reflect local housing market conditions rather than a single city wide average relationship.</p>
<p>To proof that our observation is indeed true, Global Moranâ€™s I test will be performed</p>
<p>First, we will compute the distance-based weight matrix by using <code>st_dist_band()</code> function of <strong>sfdep</strong>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build distanceâ€‘band neighbors and rowâ€‘standardized weights ------------------</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>analysis_sf <span class="ot">&lt;-</span> analysis_sf <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb =</span> sfdep<span class="sc">::</span><span class="fu">st_dist_band</span>(</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_geometry</span>(geometry), </span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="dv">1500</span>), <span class="co"># neighbors &lt;= 1.5 km</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">wt =</span> <span class="fu">st_weights</span>(</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>      nb, <span class="at">style =</span> <span class="st">"W"</span>), <span class="co"># rowâ€‘standardized W</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.before =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Next, <code>global_moran_perm()</code> of <strong>sfdep</strong> package will be used to perform Moranâ€™s I test for residual spatial autocorrelation</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Permutation Moranâ€™s I test on residuals -------------------------------------</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>sfdep<span class="sc">::</span><span class="fu">global_moran_perm</span>(</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  mlr1_resale.sf<span class="sc">$</span>MLR_RES,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nb =</span> analysis_sf<span class="sc">$</span>nb,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">wt =</span> analysis_sf<span class="sc">$</span>wt,</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">"two.sided"</span>,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.32643, observed rank = 1000, p-value &lt;
0.00000000000000022
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>The Monte Carlo Moran I result shows strong and highly significant spatial autocorrelation in the OLS residuals. The statistic is about 0.33 with an observed rank of 1 000 out of 1 000 simulations and a p value effectively equal to 0. This means none of the simulated patterns under spatial randomness produced an I value as large as the observed one, so the null hypothesis of spatially independent residuals is decisively rejected.</p>
<p>In practical terms, nearby condominiums tend to share similar overpricing or underpricing after controlling for the hedonic covariates. This confirms that important spatial structure remains unexplained and that the OLS error term is not independent. As a result, standard errors from the global OLS may be underestimated and significance levels somewhat optimistic, even though the main effect directions are still informative. These findings support the decision to move to spatial models in Section 10, such as geographically weighted regression or spatial error specifications, to capture local market effects and produce more reliable inference and location sensitive fitted values.</p>
</section>
</section>
</section>
<section id="building-hedonic-pricing-models-using-geographically-weighted-model-gwmodel" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="building-hedonic-pricing-models-using-geographically-weighted-model-gwmodel"><span class="header-section-number">10</span> Building Hedonic Pricing Models using Geographically-Weighted Model (GWmodel)</h2>
<p>Hedonic effects rarely act uniformly across a city. Prices respond to amenities, disamenities, and building attributes in ways that vary with location. This section introduces a spatially varying coefficient approach that relaxes the constant effect assumption of global OLS. We calibrate geographically weighted regressions that estimate location specific parameters while keeping the same dependent and predictor sets established earlier. Two bandwidth strategies are contrasted to control the spatial kernel: a single optimal distance for all locations and an adaptive neighbor count that expands or contracts with point density. We then convert model outputs to spatial objects, map local fit and coefficients, and prepare the ground for interpreting spatial heterogeneity with care.</p>
<section id="building-fixed-bandwidth-gwr-model" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="building-fixed-bandwidth-gwr-model"><span class="header-section-number">10.1</span> Building Fixed Bandwidth GWR Model</h3>
<p>Begin with a practical baseline. A fixed bandwidth holds the kernel distance constant across the study area, so each local regression uses neighbors within the same radius. The method is straightforward to tune with cross validation and yields parameters that can be compared directly across places. We will compute the optimal fixed bandwidth, run the model with the specified predictors, and review the global back check that GWmodel reports for reference before moving on to spatial diagnostic</p>
<section id="computing-fixed-bandwith" class="level4" data-number="10.1.1">
<h4 data-number="10.1.1" class="anchored" data-anchor-id="computing-fixed-bandwith"><span class="header-section-number">10.1.1</span> Computing fixed bandwith</h4>
<p>What radius best balances bias and variance for our data support The cross validation search evaluates candidate distances and returns the one minimizing prediction error. This step sets the spatial scale for local regressions and anchors all subsequent estimates.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>bw.fixed <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> resale_price <span class="sc">~</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    FLOOR_LEVEL <span class="sc">+</span> AGE_2025 <span class="sc">+</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    DIST_CBD_M <span class="sc">+</span> DIST_MRT_M <span class="sc">+</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    DIST_ELDERCARE_M <span class="sc">+</span> DIST_HAWKER_M <span class="sc">+</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    DIST_SUPERMKT_M <span class="sc">+</span> DIST_MALL_M <span class="sc">+</span> DIST_ELITEPRI_M <span class="sc">+</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    CNT_KINDER_350 <span class="sc">+</span> CNT_CHILD_350 <span class="sc">+</span> CNT_BUS_350 <span class="sc">+</span> CNT_PRIMARY_1000,</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_sf, </span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">approach=</span><span class="st">"CV"</span>, </span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel=</span><span class="st">"gaussian"</span>, </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">adaptive=</span><span class="cn">FALSE</span>, </span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">longlat=</span><span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Take a cup of tea and have a break, it will take a few minutes.
          -----A kind suggestion from GWmodel development group
Fixed bandwidth: 22980.96 CV score: 52420678841765 
Fixed bandwidth: 14205.85 CV score: 50380561220518 
Fixed bandwidth: 8782.54 CV score: 45181265158522 
Fixed bandwidth: 5430.749 CV score: 36057167111721 
Fixed bandwidth: 3359.228 CV score: 26768799134459 
Fixed bandwidth: 2078.957 CV score: 19602877991310 
Fixed bandwidth: 1287.706 CV score: 15838916816213 
Fixed bandwidth: 798.6866 CV score: 13366450830114 
Fixed bandwidth: 496.4557 CV score: 12090888418010 
Fixed bandwidth: 309.6667 CV score: 28858592880340 
Fixed bandwidth: 611.8976 CV score: 12507899271935 
Fixed bandwidth: 425.1087 CV score: 12630362203414 
Fixed bandwidth: 540.5506 CV score: 12194417941671 
Fixed bandwidth: 469.2035 CV score: 12120509438426 
Fixed bandwidth: 513.2984 CV score: 12114961104322 
Fixed bandwidth: 486.0463 CV score: 12089778818788 
Fixed bandwidth: 479.6129 CV score: 12096000094140 
Fixed bandwidth: 490.0223 CV score: 12088719979539 
Fixed bandwidth: 492.4797 CV score: 12089012843565 
Fixed bandwidth: 488.5036 CV score: 12088893042757 
Fixed bandwidth: 490.9609 CV score: 12088750214655 
Fixed bandwidth: 489.4422 CV score: 12088753349982 
Fixed bandwidth: 490.3808 CV score: 12088719363043 
Fixed bandwidth: 490.6024 CV score: 12088726486681 
Fixed bandwidth: 490.2439 CV score: 12088717817448 
Fixed bandwidth: 490.1593 CV score: 12088718065987 
Fixed bandwidth: 490.2962 CV score: 12088718084724 
Fixed bandwidth: 490.2116 CV score: 12088717792504 
Fixed bandwidth: 490.1916 CV score: 12088717874466 
Fixed bandwidth: 490.2239 CV score: 12088717761406 
Fixed bandwidth: 490.2316 CV score: 12088717727600 
Fixed bandwidth: 490.2363 CV score: 12088717894476 
Fixed bandwidth: 490.2286 CV score: 12088717858844 
Fixed bandwidth: 490.2334 CV score: 12088717969783 
Fixed bandwidth: 490.2304 CV score: 12088717929640 
Fixed bandwidth: 490.2322 CV score: 12088717882761 
Fixed bandwidth: 490.2311 CV score: 12088717829831 
Fixed bandwidth: 490.2318 CV score: 12088717773347 
Fixed bandwidth: 490.2314 CV score: 12088717768447 
Fixed bandwidth: 490.2317 CV score: 12088717883352 
Fixed bandwidth: 490.2315 CV score: 12088717784606 
Fixed bandwidth: 490.2316 CV score: 12088717917973 
Fixed bandwidth: 490.2315 CV score: 12088717904137 </code></pre>
</div>
</div>
</section>
<section id="gwmodel-method---fixed-bandwith" class="level4" data-number="10.1.2">
<h4 data-number="10.1.2" class="anchored" data-anchor-id="gwmodel-method---fixed-bandwith"><span class="header-section-number">10.1.2</span> GWModel method - fixed bandwith</h4>
<p>With the fixed bandwidth in hand, the model is fitted using the full predictor set. GWmodel reports both local fits and an embedded global OLS summary for orientation. The output will later be transformed for mapping and coefficient interpretation.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>gwr.fixed <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> resale_price <span class="sc">~</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>    FLOOR_LEVEL <span class="sc">+</span> AGE_2025 <span class="sc">+</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    DIST_CBD_M <span class="sc">+</span> DIST_MRT_M <span class="sc">+</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    DIST_ELDERCARE_M <span class="sc">+</span> DIST_HAWKER_M <span class="sc">+</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    DIST_SUPERMKT_M <span class="sc">+</span> DIST_MALL_M <span class="sc">+</span> DIST_ELITEPRI_M <span class="sc">+</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    CNT_KINDER_350 <span class="sc">+</span> CNT_CHILD_350 <span class="sc">+</span> CNT_BUS_350 <span class="sc">+</span> CNT_PRIMARY_1000,</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_sf, </span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">bw=</span>bw.fixed, </span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">'gaussian'</span>, </span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>gwr.fixed</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ***********************************************************************
   *                       Package   GWmodel                             *
   ***********************************************************************
   Program starts at: 2025-11-16 15:29:15.569816 
   Call:
   gwr.basic(formula = resale_price ~ FLOOR_LEVEL + AGE_2025 + DIST_CBD_M + 
    DIST_MRT_M + DIST_ELDERCARE_M + DIST_HAWKER_M + DIST_SUPERMKT_M + 
    DIST_MALL_M + DIST_ELITEPRI_M + CNT_KINDER_350 + CNT_CHILD_350 + 
    CNT_BUS_350 + CNT_PRIMARY_1000, data = analysis_sf, bw = bw.fixed, 
    kernel = "gaussian", longlat = FALSE)

   Dependent (y) variable:  resale_price
   Independent variables:  FLOOR_LEVEL AGE_2025 DIST_CBD_M DIST_MRT_M DIST_ELDERCARE_M DIST_HAWKER_M DIST_SUPERMKT_M DIST_MALL_M DIST_ELITEPRI_M CNT_KINDER_350 CNT_CHILD_350 CNT_BUS_350 CNT_PRIMARY_1000
   Number of data points: 8679
   ***********************************************************************
   *                    Results of Global Regression                     *
   ***********************************************************************

   Call:
    lm(formula = formula, data = data)

   Residuals:
    Min      1Q  Median      3Q     Max 
-315980  -51192    -548   48634  496223 

   Coefficients:
                        Estimate   Std. Error t value             Pr(&gt;|t|)    
   (Intercept)      1080903.7052    5874.5072 183.999 &lt; 0.0000000000000002 ***
   FLOOR_LEVEL         5852.7455     146.3520  39.991 &lt; 0.0000000000000002 ***
   AGE_2025           -5388.7494      65.3856 -82.415 &lt; 0.0000000000000002 ***
   DIST_CBD_M           -19.8620       0.3269 -60.767 &lt; 0.0000000000000002 ***
   DIST_MRT_M           -56.6144       2.6334 -21.499 &lt; 0.0000000000000002 ***
   DIST_ELDERCARE_M     -10.4089       1.5024  -6.928     0.00000000000457 ***
   DIST_HAWKER_M        -25.2436       1.9967 -12.643 &lt; 0.0000000000000002 ***
   DIST_SUPERMKT_M       16.3863       4.9496   3.311             0.000935 ***
   DIST_MALL_M          -27.4447       2.7128 -10.117 &lt; 0.0000000000000002 ***
   DIST_ELITEPRI_M        1.8836       0.4210   4.474     0.00000776143305 ***
   CNT_KINDER_350     10192.8180     930.5597  10.953 &lt; 0.0000000000000002 ***
   CNT_CHILD_350      -1960.4389     465.8522  -4.208     0.00002599124053 ***
   CNT_BUS_350         1452.7053     320.6128   4.531     0.00000594837516 ***
   CNT_PRIMARY_1000  -11958.1478     655.4549 -18.244 &lt; 0.0000000000000002 ***

   ---Significance stars
   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
   Residual standard error: 78530 on 8665 degrees of freedom
   Multiple R-squared: 0.7613
   Adjusted R-squared: 0.761 
   F-statistic:  2126 on 13 and 8665 DF,  p-value: &lt; 0.00000000000000022 
   ***Extra Diagnostic information
   Residual sum of squares: 53434715701270
   Sigma(hat): 78474.21
   AIC:  220291.7
   AICc:  220291.8
   BIC:  211854.8
   ***********************************************************************
   *          Results of Geographically Weighted Regression              *
   ***********************************************************************

   *********************Model calibration information*********************
   Kernel function: gaussian 
   Fixed bandwidth: 490.2316 
   Regression points: the same locations as observations are used.
   Distance metric: Euclidean distance metric is used.

   ****************Summary of GWR coefficient estimates:******************
                             Min.       1st Qu.        Median       3rd Qu.
   Intercept        -9814500.9325   483607.0218  1096118.7964  1803140.6146
   FLOOR_LEVEL          1808.0599     3905.2056     4577.3790     5342.8960
   AGE_2025           -65281.0798    -8074.7550    -5385.4484    -4010.3673
   DIST_CBD_M          -1422.1136      -93.9417      -20.1120       35.4247
   DIST_MRT_M          -1188.6652     -121.0431      -56.8987      -18.6675
   DIST_ELDERCARE_M    -1009.2615      -35.8849        7.5388       54.5614
   DIST_HAWKER_M       -1606.9211      -62.0250      -21.7861       36.4597
   DIST_SUPERMKT_M     -1095.2296      -42.3863        4.1581       45.7880
   DIST_MALL_M         -2385.9712      -78.3135      -23.7886       20.8771
   DIST_ELITEPRI_M     -1071.3509      -77.4569       12.2290       82.4773
   CNT_KINDER_350    -109209.1307    -7587.0223      -84.3788     4502.5519
   CNT_CHILD_350      -66415.1303    -3050.9769     -134.4965     1888.9225
   CNT_BUS_350        -40061.8329    -2047.7486      256.6914     2364.6683
   CNT_PRIMARY_1000  -192662.4125    -5462.4838     -286.3011     4640.2170
                           Max.
   Intercept        15235948.31
   FLOOR_LEVEL         23161.94
   AGE_2025             5168.97
   DIST_CBD_M           1468.37
   DIST_MRT_M           2064.74
   DIST_ELDERCARE_M      938.83
   DIST_HAWKER_M         858.60
   DIST_SUPERMKT_M      1815.98
   DIST_MALL_M           920.83
   DIST_ELITEPRI_M      1311.64
   CNT_KINDER_350     194292.82
   CNT_CHILD_350       29214.70
   CNT_BUS_350         22582.05
   CNT_PRIMARY_1000   120020.65
   ************************Diagnostic information*************************
   Number of data points: 8679 
   Effective number of parameters (2trace(S) - trace(S'S)): 1139.927 
   Effective degrees of freedom (n-2trace(S) + trace(S'S)): 7539.073 
   AICc (GWR book, Fotheringham, et al. 2002, p. 61, eq 2.33): 206360.3 
   AIC (GWR book, Fotheringham, et al. 2002,GWR p. 96, eq. 4.22): 205217.6 
   BIC (GWR book, Fotheringham, et al. 2002,GWR p. 61, eq. 2.34): 203971.3 
   Residual sum of squares: 8490385056360 
   R-square value:  0.9620744 
   Adjusted R-square value:  0.9563392 

   ***********************************************************************
   Program stops at: 2025-11-16 15:29:47.590822 </code></pre>
</div>
</div>
</section>
</section>
<section id="building-adaptive-bandwidth-gwr-model" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="building-adaptive-bandwidth-gwr-model"><span class="header-section-number">10.2</span> Building Adaptive Bandwidth GWR Model</h3>
<p>Shift perspective to account for uneven point density. An adaptive bandwidth keeps a constant number of nearest neighbors rather than a constant distance. Dense urban cores use smaller search radii while sparse edges expand to secure comparable data support. This typically stabilizes estimates and improves comparability of local regressions when observations cluster. We will compute the optimal neighbor count through cross validation, fit the adaptive model, and stage its results for spatial analysis alongside the fixed bandwidth specification.</p>
<section id="computing-the-adaptive-bandwidth" class="level4" data-number="10.2.1">
<h4 data-number="10.2.1" class="anchored" data-anchor-id="computing-the-adaptive-bandwidth"><span class="header-section-number">10.2.1</span> Computing the adaptive bandwidth</h4>
<p>The search process now optimizes the number of neighbors. For each trial size, cross validation measures out of sample error. The winning size defines a location specific distance for each point that encloses the chosen neighbor count.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>bw.adaptive <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> resale_price <span class="sc">~</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    FLOOR_LEVEL <span class="sc">+</span> AGE_2025 <span class="sc">+</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    DIST_CBD_M <span class="sc">+</span> DIST_MRT_M <span class="sc">+</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    DIST_ELDERCARE_M <span class="sc">+</span> DIST_HAWKER_M <span class="sc">+</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    DIST_SUPERMKT_M <span class="sc">+</span> DIST_MALL_M <span class="sc">+</span> DIST_ELITEPRI_M <span class="sc">+</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    CNT_KINDER_350 <span class="sc">+</span> CNT_CHILD_350 <span class="sc">+</span> CNT_BUS_350 <span class="sc">+</span> CNT_PRIMARY_1000,</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_sf,</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">approach=</span><span class="st">"CV"</span>, </span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel=</span><span class="st">"gaussian"</span>, </span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">adaptive=</span><span class="cn">TRUE</span>, </span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">longlat=</span><span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Take a cup of tea and have a break, it will take a few minutes.
          -----A kind suggestion from GWmodel development group
Adaptive bandwidth: 5371 CV score: 49461675433026 
Adaptive bandwidth: 3327 CV score: 45821663624712 
Adaptive bandwidth: 2063 CV score: 40622826791493 
Adaptive bandwidth: 1282 CV score: 33638648466609 
Adaptive bandwidth: 799 CV score: 27117201692029 
Adaptive bandwidth: 501 CV score: 22617017557257 
Adaptive bandwidth: 316 CV score: 19352123315987 
Adaptive bandwidth: 202 CV score: 16724529309906 
Adaptive bandwidth: 131 CV score: 14859850339673 
Adaptive bandwidth: 88 CV score: 13516291090788 
Adaptive bandwidth: 60 CV score: 12509218199160 
Adaptive bandwidth: 44 CV score: 11779189395780 
Adaptive bandwidth: 33 CV score: Inf 
Adaptive bandwidth: 50 CV score: 11988411001278 
Adaptive bandwidth: 39 CV score: Inf 
Adaptive bandwidth: 45 CV score: 11813496663823 
Adaptive bandwidth: 41 CV score: Inf 
Adaptive bandwidth: 43 CV score: 11745157444094 
Adaptive bandwidth: 45 CV score: 11813496663823 
Adaptive bandwidth: 44 CV score: 11779189395780 
Adaptive bandwidth: 45 CV score: 11813496663823 
Adaptive bandwidth: 44 CV score: 11779189395780 
Adaptive bandwidth: 44 CV score: 11779189395780 
Adaptive bandwidth: 43 CV score: 11745157444094 </code></pre>
</div>
</div>
</section>
<section id="constructing-the-adaptive-bandwidth-gwr-model" class="level4" data-number="10.2.2">
<h4 data-number="10.2.2" class="anchored" data-anchor-id="constructing-the-adaptive-bandwidth-gwr-model"><span class="header-section-number">10.2.2</span> Constructing the adaptive bandwidth gwr model</h4>
<p>Using the selected neighbor count, the adaptive GWR is calibrated with the same predictors. Outputs include local coefficients, standard errors, fitted values, and diagnostics, which we will convert to spatial features for visualization.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>gwr.adaptive <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> resale_price <span class="sc">~</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    FLOOR_LEVEL <span class="sc">+</span> AGE_2025 <span class="sc">+</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    DIST_CBD_M <span class="sc">+</span> DIST_MRT_M <span class="sc">+</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    DIST_ELDERCARE_M <span class="sc">+</span> DIST_HAWKER_M <span class="sc">+</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    DIST_SUPERMKT_M <span class="sc">+</span> DIST_MALL_M <span class="sc">+</span> DIST_ELITEPRI_M <span class="sc">+</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    CNT_KINDER_350 <span class="sc">+</span> CNT_CHILD_350 <span class="sc">+</span> CNT_BUS_350 <span class="sc">+</span> CNT_PRIMARY_1000,</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_sf,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">bw=</span>bw.adaptive, </span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">'gaussian'</span>, </span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">adaptive=</span><span class="cn">TRUE</span>, </span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="visualising-gwr-output" class="level3" data-number="10.3">
<h3 data-number="10.3" class="anchored" data-anchor-id="visualising-gwr-output"><span class="header-section-number">10.3</span> Visualising GWR Output</h3>
<p>Maps translate tables of local coefficients and fit statistics into patterns that can be interpreted geographically. Here we take the structured output from GWmodel, convert it to simple features in the project CRS, and explore basic summaries to ensure data integrity. Visual checks include range, central tendency, and the presence of missing values. These steps are essential for trustworthy cartography and for avoiding misread patterns due to unit or projection mistakes. The prepared layers serve as inputs to thematic maps of local <span class="math inline">\(R^2\)</span> and coefficients, enabling side by side comparison across bandwidth strategies.</p>
</section>
<section id="converting-sdf-into-sf-data.frame" class="level3" data-number="10.4">
<h3 data-number="10.4" class="anchored" data-anchor-id="converting-sdf-into-sf-data.frame"><span class="header-section-number">10.4</span> Converting SDF into sf data.frame</h3>
<p>GWmodel returns a Spatial Data Frame structure. For consistent handling with the rest of the workflow, we convert the model output into an sf object and enforce EPSG 3414. This conversion preserves attributes such as coefficients, t values, and fitted values while attaching valid geometry. A brief glimpse confirms column names and types. The resulting layer integrates seamlessly with tmap and dplyr, allowing clean joins, selections, and map composition without coercion errors.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>analysis.sf.adaptive <span class="ot">&lt;-</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(gwr.adaptive<span class="sc">$</span>SDF) <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(analysis.sf.adaptive)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,679
Columns: 49
$ Intercept           &lt;dbl&gt; 1372611, 1378403, 1372611, 1220761, 1378403, 12207â€¦
$ FLOOR_LEVEL         &lt;dbl&gt; 5273.715, 5958.302, 5273.715, 7309.421, 5958.302, â€¦
$ AGE_2025            &lt;dbl&gt; -9043.527, -8096.687, -9043.527, -8171.505, -8096.â€¦
$ DIST_CBD_M          &lt;dbl&gt; -32.39158, -54.41816, -32.39158, -46.73114, -54.41â€¦
$ DIST_MRT_M          &lt;dbl&gt; -50.418513, 63.015593, -50.418513, 56.030906, 63.0â€¦
$ DIST_ELDERCARE_M    &lt;dbl&gt; 78.52689, 155.33493, 78.52689, 80.98130, 155.33493â€¦
$ DIST_HAWKER_M       &lt;dbl&gt; 58.60382, 59.75263, 58.60382, 108.04486, 59.75263,â€¦
$ DIST_SUPERMKT_M     &lt;dbl&gt; -13.027782, 113.331892, -13.027782, 45.809992, 113â€¦
$ DIST_MALL_M         &lt;dbl&gt; -18.78535, -87.24034, -18.78535, -15.50219, -87.24â€¦
$ DIST_ELITEPRI_M     &lt;dbl&gt; -49.532805, -50.985132, -49.532805, -3.041654, -50â€¦
$ CNT_KINDER_350      &lt;dbl&gt; 3637.694, 7968.247, 3637.694, 3589.385, 7968.247, â€¦
$ CNT_CHILD_350       &lt;dbl&gt; 3741.448, 2294.173, 3741.448, 3476.573, 2294.173, â€¦
$ CNT_BUS_350         &lt;dbl&gt; -74.14264, 5907.85122, -74.14264, 2819.22534, 5907â€¦
$ CNT_PRIMARY_1000    &lt;dbl&gt; -17636.8619, -2841.3086, -17636.8619, -2005.5695, â€¦
$ y                   &lt;dbl&gt; 582000, 865000, 530000, 560000, 1038000, 542000, 6â€¦
$ yhat                &lt;dbl&gt; 629711.9, 918046.1, 613890.7, 564810.8, 1025295.6,â€¦
$ residual            &lt;dbl&gt; -47711.8643, -53046.1246, -83890.7202, -4810.7857,â€¦
$ CV_Score            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,â€¦
$ Stud_residual       &lt;dbl&gt; -1.427436697, -1.591311112, -2.493182102, -0.14828â€¦
$ Intercept_SE        &lt;dbl&gt; 74733.96, 129383.80, 74733.96, 73607.69, 129383.80â€¦
$ FLOOR_LEVEL_SE      &lt;dbl&gt; 420.2317, 603.3344, 420.2317, 525.1793, 603.3344, â€¦
$ AGE_2025_SE         &lt;dbl&gt; 219.2456, 311.5138, 219.2456, 243.3322, 311.5138, â€¦
$ DIST_CBD_M_SE       &lt;dbl&gt; 6.381174, 13.186455, 6.381174, 8.893479, 13.186455â€¦
$ DIST_MRT_M_SE       &lt;dbl&gt; 14.85487, 18.65581, 14.85487, 14.34552, 18.65581, â€¦
$ DIST_ELDERCARE_M_SE &lt;dbl&gt; 12.26024, 17.87647, 12.26024, 13.77942, 17.87647, â€¦
$ DIST_HAWKER_M_SE    &lt;dbl&gt; 24.53553, 28.62070, 24.53553, 22.05199, 28.62070, â€¦
$ DIST_SUPERMKT_M_SE  &lt;dbl&gt; 23.91858, 37.99138, 23.91858, 24.69231, 37.99138, â€¦
$ DIST_MALL_M_SE      &lt;dbl&gt; 19.08425, 19.43229, 19.08425, 13.89717, 19.43229, â€¦
$ DIST_ELITEPRI_M_SE  &lt;dbl&gt; 8.683238, 10.004832, 8.683238, 7.907303, 10.004832â€¦
$ CNT_KINDER_350_SE   &lt;dbl&gt; 3514.343, 4581.487, 3514.343, 3926.582, 4581.487, â€¦
$ CNT_CHILD_350_SE    &lt;dbl&gt; 2623.825, 3463.613, 2623.825, 2303.139, 3463.613, â€¦
$ CNT_BUS_350_SE      &lt;dbl&gt; 1465.262, 1901.424, 1465.262, 1568.828, 1901.424, â€¦
$ CNT_PRIMARY_1000_SE &lt;dbl&gt; 4239.503, 5250.417, 4239.503, 4230.479, 5250.417, â€¦
$ Intercept_TV        &lt;dbl&gt; 18.36663, 10.65360, 18.36663, 16.58470, 10.65360, â€¦
$ FLOOR_LEVEL_TV      &lt;dbl&gt; 12.549540, 9.875622, 12.549540, 13.917953, 9.87562â€¦
$ AGE_2025_TV         &lt;dbl&gt; -41.24839, -25.99143, -41.24839, -33.58168, -25.99â€¦
$ DIST_CBD_M_TV       &lt;dbl&gt; -5.076116, -4.126822, -5.076116, -5.254540, -4.126â€¦
$ DIST_MRT_M_TV       &lt;dbl&gt; -3.3940724, 3.3777999, -3.3940724, 3.9058127, 3.37â€¦
$ DIST_ELDERCARE_M_TV &lt;dbl&gt; 6.405006, 8.689353, 6.405006, 5.876976, 8.689353, â€¦
$ DIST_HAWKER_M_TV    &lt;dbl&gt; 2.388529, 2.087742, 2.388529, 4.899550, 2.087742, â€¦
$ DIST_SUPERMKT_M_TV  &lt;dbl&gt; -0.5446720, 2.9830947, -0.5446720, 1.8552333, 2.98â€¦
$ DIST_MALL_M_TV      &lt;dbl&gt; -0.9843380, -4.4894518, -0.9843380, -1.1154931, -4â€¦
$ DIST_ELITEPRI_M_TV  &lt;dbl&gt; -5.7044165, -5.0960508, -5.7044165, -0.3846639, -5â€¦
$ CNT_KINDER_350_TV   &lt;dbl&gt; 1.0350992, 1.7392275, 1.0350992, 0.9141244, 1.7392â€¦
$ CNT_CHILD_350_TV    &lt;dbl&gt; 1.4259518, 0.6623643, 1.4259518, 1.5094930, 0.6623â€¦
$ CNT_BUS_350_TV      &lt;dbl&gt; -0.05060027, 3.10706651, -0.05060027, 1.79702637, â€¦
$ CNT_PRIMARY_1000_TV &lt;dbl&gt; -4.1601247, -0.5411587, -4.1601247, -0.4740762, -0â€¦
$ Local_R2            &lt;dbl&gt; 0.9508844, 0.9490104, 0.9508844, 0.9561350, 0.9490â€¦
$ geometry            &lt;POINT [m]&gt; POINT (30036.29 38360.76), POINT (29283.45 3â€¦</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gwr.adaptive<span class="sc">$</span>SDF<span class="sc">$</span>yhat)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 396412  564604  628534  672142  724054 1485595 </code></pre>
</div>
</div>
</section>
<section id="visualising-local-r2" class="level3" data-number="10.5">
<h3 data-number="10.5" class="anchored" data-anchor-id="visualising-local-r2"><span class="header-section-number">10.5</span> Visualising local <span class="math inline">\(R^2\)</span></h3>
<p>How well does the model fit in different neighborhoods Local R2 indicates the share of variance explained by each local regression, revealing zones of strong and weak explanatory power. We render Local R2 on top of the planning subzones, using a clean legend inside the frame and appropriate zoom bounds. Interpreting this map helps diagnose scale misspecification, missing predictors, or unmodeled spatial processes. High values suggest that the chosen predictors capture local dynamics, while low values motivate refinement or alternative spatial structures.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill_alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(analysis.sf.adaptive) <span class="sc">+</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"Local_R2"</span>,</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">border.col =</span> <span class="st">"gray60"</span>,</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">border.lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">14</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_ex03_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="visualising-coefficient-estimates" class="level3" data-number="10.6">
<h3 data-number="10.6" class="anchored" data-anchor-id="visualising-coefficient-estimates"><span class="header-section-number">10.6</span> Visualising coefficient estimates</h3>
<p>Coefficient maps reveal how the marginal effect of each predictor varies across space. By plotting estimates together with their uncertainty metrics when needed, we distinguish robust spatial trends from noise. The goal is not decoration but decision support. Positive and negative zones guide policy interpretation, for example where proximity to transit associates with larger premiums or where park access effects attenuate. Side by side arrangements facilitate comparison across variables and between fixed and adaptive bandwidths, helping to identify consistent patterns and locations where model assumptions warrant further scrutiny.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_mode("plot")</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AREA_SQM_SE &lt;- tm_shape(mpsz)+</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_polygons(alpha = 0.1) +</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tm_shape(analysis.sf.adaptive) +  </span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_dots(col = "AREA_SQM_SE",</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="co">#           border.col = "gray60",</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="co">#           border.lwd = 1) +</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_view(set.zoom.limits = c(11,14))</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="co"># AREA_SQM_TV &lt;- tm_shape(mpsz_svy21)+</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_polygons(alpha = 0.1) +</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a><span class="co"># tm_shape(analysis.sf.adaptive) +  </span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_dots(col = "AREA_SQM_TV",</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a><span class="co">#           border.col = "gray60",</span></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a><span class="co">#           border.lwd = 1) +</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_view(set.zoom.limits = c(11,14))</span></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_arrange(AREA_SQM_SE, AREA_SQM_TV, </span></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a><span class="co">#              asp=1, ncol=2,</span></span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a><span class="co">#              sync = TRUE)</span></span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_mode("plot")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>